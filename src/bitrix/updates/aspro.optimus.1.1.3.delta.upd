BITRIX42   9639|/aspro.optimus/functions.php|56aec0fa<?
CModule::IncludeModule("main");
CModule::IncludeModule("iblock");

set_time_limit(0);

if(!function_exists("ClearAllSitesCacheComponents")){
	function ClearAllSitesCacheComponents($arComponentsNames){
		if($arComponentsNames && is_array($arComponentsNames)){
			global $CACHE_MANAGER;
			$arSites = array();
			$rsSites = CSite::GetList($by = "sort", $order = "desc", array("ACTIVE" => "Y"));
			while($arSite = $rsSites->Fetch()){
			  $arSites[] = $arSite;
			}
			foreach($arComponentsNames as $componentName){
				foreach($arSites as $arSite){
					CBitrixComponent::clearComponentCache($componentName, $arSite["ID"]);
				}
			}
		}
	}
}

if(!function_exists("ClearAllSitesCacheDirs")){
	function ClearAllSitesCacheDirs($arDirs){
		if($arDirs && is_array($arDirs)){
			foreach($arDirs as $dir){
				$obCache = new CPHPCache();
				$obCache->CleanDir("", $dir);
			}
		}
	}
}

if(!function_exists("GetIBlocks")){
	function GetIBlocks(){
		$arRes = array();
		$dbRes = CIBlock::GetList(array(), array("ACTIVE" => "Y"));
		while($item = $dbRes->Fetch()){
			$arRes[$item["LID"]][$item["IBLOCK_TYPE_ID"]][$item["CODE"]][] = $item["ID"];
		}
		return $arRes;
	}
}

if(!function_exists("GetSites")){
	function GetSites(){
		$arRes = array();
		$dbRes = CSite::GetList($by="sort", $order="desc", array("ACTIVE" => "Y"));
		while($item = $dbRes->Fetch()){
			$arRes[$item["LID"]] = $item;
		}
		return $arRes;
	}
}

if(!function_exists("GetCurVersion")){
	function GetCurVersion($versionFile){
		$ver = false;
		if(file_exists($versionFile)){
			$arModuleVersion = array();
			include($versionFile);
			$ver = trim($arModuleVersion["VERSION"]);
		}
		return $ver;
	}
}

if(!function_exists("CreateBakFile")){
	function CreateBakFile($file, $curVersion = CURRENT_VERSION){
		$file = trim($file);
		if(file_exists($file)){
			$arPath = pathinfo($file);
			$backFile = $arPath['dirname'].'/_'.$arPath['basename'].'.back'.$curVersion;
			if(!file_exists($backFile)){
				@copy($file, $backFile);
			}
		}
	}
}

if(!function_exists("RemoveFileFromModuleWizard")){
	function RemoveFileFromModuleWizard($file){
		@unlink($_SERVER['DOCUMENT_ROOT'].'/bitrix/modules/'.MODULE_NAME.'/install/wizards/'.PARTNER_NAME.'/'.MODULE_NAME_SHORT.$file);
		@unlink($_SERVER['DOCUMENT_ROOT'].'/bitrix/wizards/'.PARTNER_NAME.'/'.MODULE_NAME_SHORT.$file);
	}
}

if(!function_exists("RemoveFileFromTemplate")){
	function RemoveFileFromTemplate($file, $bModule = true){
		@unlink($_SERVER['DOCUMENT_ROOT'].TEMPLATE_PATH.$file);
		if($bModule){
			RemoveFileFromModuleWizard('/site/templates/'.TEMPLATE_NAME.$file);
		}
	}
}

if(!function_exists('SearchFilesInPublicRecursive')){
	function SearchFilesInPublicRecursive($dir, $pattern, $flags = 0){
		$arDirExclude = array('bitrix', 'upload');
		$pattern = str_replace('//', '/', str_replace('//', '/', $dir.'/').$pattern);
		$files = glob($pattern, $flags);
		foreach(glob(dirname($pattern).'/*', GLOB_ONLYDIR|GLOB_NOSORT) as $dir){
			if(!in_array(basename($dir), $arDirExclude)){
				$files = array_merge($files, SearchFilesInPublicRecursive($dir, basename($pattern), $flags));
			}
		}
		return $files;
	}
}

if(!function_exists('RemoveOldBakFiles')){
	function RemoveOldBakFiles(){
		$arDirs = $arFiles = array();
		$arDirExclude = array($_SERVER["DOCUMENT_ROOT"].'/bitrix', $_SERVER["DOCUMENT_ROOT"].'/upload');

		if(file_exists($_SERVER["DOCUMENT_ROOT"].'/bitrix/templates/')){
			if($arTemplates = glob($_SERVER["DOCUMENT_ROOT"].'/bitrix/templates/'.PARTNER_NAME.'*', 0)){
				foreach($arTemplates as $templatePath){
					$arDirs[] = str_replace('//', '/', $templatePath.'/');
				}
			}
		}

		if(file_exists($_SERVER["DOCUMENT_ROOT"].'/local/templates/')){
			if($arTemplates = glob($_SERVER["DOCUMENT_ROOT"].'/local/templates/'.PARTNER_NAME.'*', 0)){
				foreach($arTemplates as $templatePath){
					$arDirs[] = str_replace('//', '/', $templatePath.'/');
				}
			}
		}

		if(file_exists($_SERVER["DOCUMENT_ROOT"].'/bitrix/modules/')){
			if($arModules = glob($_SERVER["DOCUMENT_ROOT"].'/bitrix/modules/'.PARTNER_NAME.'*', 0)){
				foreach($arModules as $modulePath){
					$arDirs[] = str_replace('//', '/', $modulePath.'/');
				}
			}
		}

		/*if($arSites = GetSites()){
			foreach($arSites as $siteID => $arSite){
				$arSite['DIR'] = str_replace('//', '/', '/'.$arSite['DIR']);
				if(!strlen($arSite['DOC_ROOT'])){
					$arSite['DOC_ROOT'] = $_SERVER["DOCUMENT_ROOT"];
				}
				$arSite['DOC_ROOT'] = str_replace('//', '/', $arSite['DOC_ROOT'].'/');
				$arDirs[] = str_replace('//', '/', $arSite['DOC_ROOT'].$arSite['DIR']);
			}
		}*/

		$i = 0;

		while($arDirs && ++$i < 10000){
			$dir = array_pop($arDirs);
			$arFiles = array_merge($arFiles, (array)glob($dir.'_*.back*', GLOB_NOSORT));
			foreach((array)glob($dir.'*', GLOB_ONLYDIR|GLOB_NOSORT) as $dir){
				if(strlen($dir) && !in_array($dir, $arDirExclude) && strpos($dir, PARTNER_NAME) !== false){
					$arDirs[] = str_replace('//', '/', $dir.'/');
				}
			}
		}

		if($arFiles){
			foreach($arFiles as $file){
				if(file_exists($file) && !is_dir($file)){
					if(time() - filemtime($file) >= 1209600){ // 14 days
						@unlink($file);
					}
				}
			}
		}
	}
}

if(!function_exists("GetDBcharset")){
	function GetDBcharset(){
		$sql='SHOW VARIABLES LIKE "character_set_database";';
		if(method_exists('\Bitrix\Main\Application', 'getConnection')){
			$db=\Bitrix\Main\Application::getConnection();
			$arResult = $db->query($sql)->fetch();
			return $arResult['Value'];
		}elseif(defined("BX_USE_MYSQLI") && BX_USE_MYSQLI == true){
			if($result = @mysqli_query($sql)){
				$arResult = mysql_fetch_row($result);
				return $arResult[1];
			}
		}elseif($result = @mysql_query($sql)){
			$arResult = mysql_fetch_row($result);
			return $arResult[1];
		}
		return false;
	}
}

if(!function_exists("GetMes")){
	function GetMes($str){
		static $isUTF8;
		if($isUTF8 === NULL){
			$isUTF8 = GetDBcharset() == 'utf8';
		}
		return ($isUTF8 ? iconv('CP1251', 'UTF-8', $str) : $str);
	}
}

if(!function_exists("UpdaterLog")){
	function UpdaterLog($str){
		static $fLOG;
		if($bFirst = !$fLOG){
			$fLOG = $_SERVER['DOCUMENT_ROOT'].'/bitrix/modules/'.MODULE_NAME.'/updaterlog.txt';
		}
		if(is_array($str)){
			$str = print_r($str, 1);
		}
		@file_put_contents($fLOG, ($bFirst ? PHP_EOL : '').date("d.m.Y H:i:s", time()).' '.$str.PHP_EOL, FILE_APPEND);
	}
}

if(!function_exists("InitComposite")){
	function InitComposite($arSites){
		if(class_exists("CHTMLPagesCache")){
			if(method_exists("CHTMLPagesCache", "GetOptions")){
				if($arHTMLCacheOptions = CHTMLPagesCache::GetOptions()){
					if($arHTMLCacheOptions["COMPOSITE"] !== "Y"){
						$arDomains = array();
						if($arSites){
							foreach($arSites as $arSite){
								if(strlen($serverName = trim($arSite["SERVER_NAME"], " \t\n\r"))){
									$arDomains[$serverName] = $serverName;
								}
								if(strlen($arSite["DOMAINS"])){
									foreach(explode("\n", $arSite["DOMAINS"]) as $domain){
										if(strlen($domain = trim($domain, " \t\n\r"))){
											$arDomains[$domain] = $domain;
										}
									}
								}
							}
						}

						if(!$arDomains){
							$arDomains[$_SERVER["SERVER_NAME"]] = $_SERVER["SERVER_NAME"];
						}

						if(!$arHTMLCacheOptions["GROUPS"]){
							$arHTMLCacheOptions["GROUPS"] = array();
						}
						$rsGroups = CGroup::GetList(($by="id"), ($order="asc"), array());
						while($arGroup = $rsGroups->Fetch()){
							if($arGroup["ID"] > 2){
								if(in_array($arGroup["STRING_ID"], array("RATING_VOTE_AUTHORITY", "RATING_VOTE")) && !in_array($arGroup["ID"], $arHTMLCacheOptions["GROUPS"])){
									$arHTMLCacheOptions["GROUPS"][] = $arGroup["ID"];
								}
							}
						}

						$arHTMLCacheOptions["COMPOSITE"] = "Y";
						$arHTMLCacheOptions["DOMAINS"] = array_merge((array)$arHTMLCacheOptions["DOMAINS"], (array)$arDomains);
						CHTMLPagesCache::SetEnabled(true);
						CHTMLPagesCache::SetOptions($arHTMLCacheOptions);
						bx_accelerator_reset();
					}
				}
			}
		}
	}
}

if(!function_exists('IsCompositeEnabled')){
	function IsCompositeEnabled(){
		if(class_exists('CHTMLPagesCache')){
			if(method_exists('CHTMLPagesCache', 'GetOptions')){
				if($arHTMLCacheOptions = CHTMLPagesCache::GetOptions()){
					if(method_exists('CHTMLPagesCache', 'isOn')){
						if (CHTMLPagesCache::isOn()){
							if(isset($arHTMLCacheOptions['AUTO_COMPOSITE']) && $arHTMLCacheOptions['AUTO_COMPOSITE'] === 'Y'){
								return 'AUTO_COMPOSITE';
							}
							else{
								return 'COMPOSITE';
							}
						}
					}
					else{
						if($arHTMLCacheOptions['COMPOSITE'] === 'Y'){
							return 'COMPOSITE';
						}
					}
				}
			}
		}

		return false;
	}
}

if(!function_exists('EnableComposite')){
	function EnableComposite($auto = false){
		if(class_exists('CHTMLPagesCache')){
			if(method_exists('CHTMLPagesCache', 'GetOptions')){
				if($arHTMLCacheOptions = CHTMLPagesCache::GetOptions()){
					$arHTMLCacheOptions['COMPOSITE'] = 'Y';
					$arHTMLCacheOptions['AUTO_UPDATE'] = 'Y'; // standart mode
					$arHTMLCacheOptions['AUTO_UPDATE_TTL'] = '0'; // no ttl delay
					$arHTMLCacheOptions['AUTO_COMPOSITE'] = ($auto ? 'Y' : 'N'); // auto composite mode
					CHTMLPagesCache::SetEnabled(true);
					CHTMLPagesCache::SetOptions($arHTMLCacheOptions);
					bx_accelerator_reset();
				}
			}
		}
	}
}
?>45   7194|/aspro.optimus/updater1.1.3.php|e5e7ad34<?
// aspro.optimus 1.1.3 updater
// changed files

// module:

// components:

// wizard:

// template:
// /js/main.js - update
// /js/main.min.js - update
// /components/bitrix/catalog.section/catalog_table/template.php - update
// /components/bitrix/catalog.section/catalog_block_front/template.php - update
// /components/bitrix/catalog.section/catalog_block_slider/template.php - update
// /components/bitrix/news/main_template/detail.php - update
// /components/bitrix/sale.personal.section/main/template.php - update
// /components/bitrix/sale.personal.section/main/index.php - update
// /components/bitrix/sale.personal.section/main/lang/ru/template.php - update
// /components/bitrix/sale.personal.section/main/lang/ru/index.php - update
// /components/bitrix/sale.personal.section/main/lang/en/template.php - update
// /components/bitrix/sale.personal.section/main/lang/en/index.php - update
// /components/bitrix/system.auth.forgotpasswd/main/template.php - update
// /components/bitrix/system.auth.forgotpasswd/main/lang/ru/template.php - update
// /components/bitrix/system.auth.forgotpasswd/main/lang/en/template.php - update

// public:

require_once __DIR__ .'/functions.php';

define('PARTNER_NAME', 'aspro');
define('MODULE_NAME', 'aspro.optimus');
define('MODULE_NAME_SHORT', 'optimus');
define('TEMPLATE_NAME', 'aspro_optimus');
define('TEMPLATE_PATH', '/bitrix/templates/'.TEMPLATE_NAME);
define('UPDATER_SELF_TEMPLATE_PATH', 'install/wizards/'.PARTNER_NAME.'/'.MODULE_NAME_SHORT.'/site/templates/'.TEMPLATE_NAME);
define('UPDATER_SITE_TEMPLATE_PATH', 'templates/'.TEMPLATE_NAME);
define('CURRENT_VERSION', GetCurVersion($_SERVER['DOCUMENT_ROOT'].'/bitrix/modules/'.MODULE_NAME.'/install/version.php'));
define('NEW_VERSION', GetCurVersion(__DIR__.'/install/version.php'));

UpdaterLog('START UPDATE '.CURRENT_VERSION.' -> '.NEW_VERSION.PHP_EOL);

// remove old bak files
RemoveOldBakFiles();

// create bak files
CreateBakFile($_SERVER['DOCUMENT_ROOT'].TEMPLATE_PATH.'/js/main.js');
CreateBakFile($_SERVER['DOCUMENT_ROOT'].TEMPLATE_PATH.'/js/main.min.js');
CreateBakFile($_SERVER['DOCUMENT_ROOT'].TEMPLATE_PATH.'/components/bitrix/catalog.section/catalog_table/template.php');
CreateBakFile($_SERVER['DOCUMENT_ROOT'].TEMPLATE_PATH.'/components/bitrix/catalog.section/catalog_block_front/template.php');
CreateBakFile($_SERVER['DOCUMENT_ROOT'].TEMPLATE_PATH.'/components/bitrix/catalog.section/catalog_block_slider/template.php');
CreateBakFile($_SERVER['DOCUMENT_ROOT'].TEMPLATE_PATH.'/components/bitrix/news/main_template/detail.php');
CreateBakFile($_SERVER['DOCUMENT_ROOT'].TEMPLATE_PATH.'/components/bitrix/sale.personal.section/main/template.php');
CreateBakFile($_SERVER['DOCUMENT_ROOT'].TEMPLATE_PATH.'/components/bitrix/sale.personal.section/main/index.php');
CreateBakFile($_SERVER['DOCUMENT_ROOT'].TEMPLATE_PATH.'/components/bitrix/sale.personal.section/main/lang/ru/template.php');
CreateBakFile($_SERVER['DOCUMENT_ROOT'].TEMPLATE_PATH.'/components/bitrix/sale.personal.section/main/lang/ru/index.php');
CreateBakFile($_SERVER['DOCUMENT_ROOT'].TEMPLATE_PATH.'/components/bitrix/sale.personal.section/main/lang/en/template.php');
CreateBakFile($_SERVER['DOCUMENT_ROOT'].TEMPLATE_PATH.'/components/bitrix/sale.personal.section/main/lang/en/index.php');
CreateBakFile($_SERVER['DOCUMENT_ROOT'].TEMPLATE_PATH.'/components/bitrix/system.auth.forgotpasswd/main/template.php');
CreateBakFile($_SERVER['DOCUMENT_ROOT'].TEMPLATE_PATH.'/components/bitrix/system.auth.forgotpasswd/main/lang/ru/template.php');
CreateBakFile($_SERVER['DOCUMENT_ROOT'].TEMPLATE_PATH.'/components/bitrix/system.auth.forgotpasswd/main/lang/en/template.php');

// update module
$updater->CopyFiles('install', 'modules/'.MODULE_NAME.'/install');

// update admin section images
//$updater->CopyFiles('install/images', 'images/'.MODULE_NAME);

// update admin section gadget
//$updater->CopyFiles('install/gadgets', 'gadgets');

// update wizard
$updater->CopyFiles('install/wizards', 'wizards');

if(file_exists($_SERVER['DOCUMENT_ROOT'].'/bitrix/components/aspro/')){
	// update components
	//$updater->CopyFiles('install/components', 'components');
}

//update mail templates
if(file_exists($_SERVER['DOCUMENT_ROOT'].'/bitrix/templates/.default/')){
	//$updater->CopyFiles('install/wizards/'.PARTNER_NAME.'/'.MODULE_NAME_SHORT.'/site/templates/.default/components', 'templates/.default/components');
}
if(file_exists($_SERVER['DOCUMENT_ROOT'].'/bitrix/templates/aspro_mail/')){
	//$updater->CopyFiles('install/wizards/'.PARTNER_NAME.'/'.MODULE_NAME_SHORT.'/site/templates/aspro_mail/', 'templates/aspro_mail');
}

if(file_exists($_SERVER['DOCUMENT_ROOT'].'/bitrix/templates/'.TEMPLATE_NAME)){
	// update js
	$updater->CopyFiles(UPDATER_SELF_TEMPLATE_PATH.'/js', UPDATER_SITE_TEMPLATE_PATH.'/js');

	// rewrite css
	// $updater->CopyFiles(UPDATER_SELF_TEMPLATE_PATH.'/css', UPDATER_SITE_TEMPLATE_PATH.'/css');
	// $updater->CopyFiles(UPDATER_SELF_TEMPLATE_PATH.'/ajax', UPDATER_SITE_TEMPLATE_PATH.'/ajax');
	// $updater->CopyFiles(UPDATER_SELF_TEMPLATE_PATH.'/template_styles.css', UPDATER_SITE_TEMPLATE_PATH.'/template_styles.css');
	// $updater->CopyFiles(UPDATER_SELF_TEMPLATE_PATH.'/template_styles.min.css', UPDATER_SITE_TEMPLATE_PATH.'/template_styles.min.css');

	// update images
	// $updater->CopyFiles(UPDATER_SELF_TEMPLATE_PATH.'/images', UPDATER_SITE_TEMPLATE_PATH.'/images');

	// update lang
	// $updater->CopyFiles(UPDATER_SELF_TEMPLATE_PATH.'/lang', UPDATER_SITE_TEMPLATE_PATH.'/lang');

	// update bgcolor
	// $updater->CopyFiles(UPDATER_SELF_TEMPLATE_PATH.'/bg_color', UPDATER_SITE_TEMPLATE_PATH.'/bg_color');

	// rewrite components templates
	$updater->CopyFiles(UPDATER_SELF_TEMPLATE_PATH.'/components', UPDATER_SITE_TEMPLATE_PATH.'/components');

	// rewrite themes
	// $updater->CopyFiles(UPDATER_SELF_TEMPLATE_PATH.'/themes', UPDATER_SITE_TEMPLATE_PATH.'/themes');
}

// current SITEs
// $arSites = GetSites();

// current IBLOCK_IDs
// $arIblocks = GetIBlocks();

// update /include/
if($arSites){
	foreach($arSites as $arSite){
		$arSite['DIR'] = str_replace('//', '/', '/'.$arSite['DIR']);
		if(!strlen($arSite['DOC_ROOT'])){
			$arSite['DOC_ROOT'] = $_SERVER["DOCUMENT_ROOT"];
		}
		$arSite['DOC_ROOT'] = str_replace('//', '/', $arSite['DOC_ROOT'].'/');
		$siteDir = str_replace('//', '/', $arSite['DOC_ROOT'].$arSite['DIR']);
		$fileCheckSolution = str_replace('//', '/', $siteDir.'/ajax/form.php');
		if(file_exists($fileCheckSolution)){
			$content = @file_get_contents($fileCheckSolution);
			if(strpos($content, 'COptimus') !== false){

			}
		}
	}
}

// is composite enabled
$compositeMode = IsCompositeEnabled();

// clear all sites cache in some components and dirs (include composite cache)
ClearAllSitesCacheDirs(array('html_pages'));
ClearAllSitesCacheComponents(
	array(
		"bitrix:catalog.section",
		"bitrix:news",
		"bitrix:news.detail",
		"bitrix:sale.personal.section",
		"bitrix:system.auth.forgotpasswd",
	)
);

if($compositeMode){
	EnableComposite($compositeMode === 'AUTO_COMPOSITE');
}
?>47   103|/aspro.optimus/install/version.php|14e4d40f<?
$arModuleVersion = array(
	"VERSION" => "1.1.3",
	"VERSION_DATE" => "2017-05-22 00:00:00"
);
?>135  6830|/aspro.optimus/install/wizards/aspro/optimus/site/templates/aspro_optimus/components/bitrix/news/main_template/detail.php|93e85307<?if(!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED!==true)die();?>
<?$this->setFrameMode(true);?>
<?if($arParams["USE_RSS"]=="Y"):?>
	<?
		if(method_exists($APPLICATION, 'addheadstring'))
		$APPLICATION->AddHeadString('<link rel="alternate" type="application/rss+xml" title="'.$arResult["FOLDER"].$arResult["URL_TEMPLATES"]["rss"].'" href="'.$arResult["FOLDER"].$arResult["URL_TEMPLATES"]["rss"].'" />');
	?>
	<a href="<?=$arResult["FOLDER"].$arResult["URL_TEMPLATES"]["rss"]?>" title="RSS" class="rss_feed_icon"><?=GetMessage("RSS_TITLE")?></a>
<?endif;?>

<?if ($arParams["SHOW_FAQ_BLOCK"]=="Y"):?>
	<div class="right_side wide">
		<div class="ask_small_block">
			<div class="ask_btn_block">
				<a class="button vbig_btn wides ask_btn"><span><?=GetMessage("ASK_QUESTION")?></span></a>
			</div>
			<div class="description">
				<?$APPLICATION->IncludeFile(SITE_DIR."include/ask_block_description.php", Array(), Array("MODE" => "html", "NAME" => GetMessage("ASK_QUESTION_TEXT"), ));?>
			</div>
		</div>
	</div>
	<div class="left_side wide">
<?endif;?>
<?
if($arResult["VARIABLES"]["ELEMENT_ID"] > 0){
	$arElement = COptimusCache::CIBLockElement_GetList(array('CACHE' => array("MULTI" =>"N", "TAG" => COptimusCache::GetIBlockCacheTag($arParams["IBLOCK_ID"]))), array("IBLOCK_ID" => $arParams["IBLOCK_ID"], "ACTIVE"=>"Y", "ID" => $arResult["VARIABLES"]["ELEMENT_ID"]), false, false, array("ID", "IBLOCK_SECTION_ID", "PREVIEW_TEXT", "PREVIEW_PICTURE", "DETAIL_PICTURE", "ACTIVE_FROM"));
}
elseif(strlen(trim($arResult["VARIABLES"]["ELEMENT_CODE"])) > 0){
	$arElement = COptimusCache::CIBLockElement_GetList(array('CACHE' => array("MULTI" =>"N", "TAG" => COptimusCache::GetIBlockCacheTag($arParams["IBLOCK_ID"]))), array("IBLOCK_ID" => $arParams["IBLOCK_ID"], "ACTIVE"=>"Y", "=CODE" => $arResult["VARIABLES"]["ELEMENT_CODE"]), false, false, array("ID", "IBLOCK_SECTION_ID", "PREVIEW_TEXT", "PREVIEW_PICTURE", "DETAIL_PICTURE", "ACTIVE_FROM"));
}
?>
<?if($arParams["USE_FILTER"]=="Y"){
	if(isset($arResult["VARIABLES"]["YEAR"]))
	{
		if($arElement["ACTIVE_FROM"])
		{
			if($arDateTime = ParseDateTime($arElement['ACTIVE_FROM'], FORMAT_DATETIME))
    		{
		        if($arDateTime['YYYY'] != (int)$arResult["VARIABLES"]["YEAR"])
		        {
		        	echo GetMessage('ELEMENT_NOT_FOUND');
					CHTTP::SetStatus(404);
					return;
		        }
    		}
		}
	}
}?>

<?COptimus::AddMeta(
	array(
		'og:description' => $arElement['PREVIEW_TEXT'],
		'og:image' => (($arElement['PREVIEW_PICTURE'] || $arElement['DETAIL_PICTURE']) ? CFile::GetPath(($arElement['PREVIEW_PICTURE'] ? $arElement['PREVIEW_PICTURE'] : $arElement['DETAIL_PICTURE'])) : false),
	)
);?>
<?$bUseShare = ($arParams["USE_SHARE"] == "Y" && $arElement);?>
<div class="content_wr_float <?=($bUseShare ? 'with-share' : '');?>">
<?$APPLICATION->IncludeComponent(
	"bitrix:news.detail",
	"main_template",
	Array(
		"DISPLAY_DATE" => $arParams["DISPLAY_DATE"],
		"DISPLAY_NAME" => $arParams["DISPLAY_NAME"],
		"DISPLAY_PICTURE" => $arParams["DISPLAY_PICTURE"],
		"DISPLAY_PREVIEW_TEXT" => $arParams["DISPLAY_PREVIEW_TEXT"],
		"SHOW_SERVICES_BLOCK" => $arParams["SHOW_SERVICES_BLOCK"],
		"IBLOCK_TYPE" => $arParams["IBLOCK_TYPE"],
		"IBLOCK_ID" => $arParams["IBLOCK_ID"],
		"FIELD_CODE" => $arParams["DETAIL_FIELD_CODE"],
		"PROPERTY_CODE" => $arParams["DETAIL_PROPERTY_CODE"],
		"DETAIL_URL"	=>	$arResult["FOLDER"].$arResult["URL_TEMPLATES"]["detail"],
		"SECTION_URL"	=>	$arResult["FOLDER"].$arResult["URL_TEMPLATES"]["section"],
		"META_KEYWORDS" => $arParams["META_KEYWORDS"],
		"META_DESCRIPTION" => $arParams["META_DESCRIPTION"],
		"BROWSER_TITLE" => $arParams["BROWSER_TITLE"],
		"DISPLAY_PANEL" => $arParams["DISPLAY_PANEL"],
		"SET_TITLE" => $arParams["SET_TITLE"],
		"SET_STATUS_404" => $arParams["SET_STATUS_404"],
		"SHOW_404" => $arParams["SHOW_404"],
		"MESSAGE_404" => $arParams["MESSAGE_404"],
		"FILE_404" => $arParams["FILE_404"],
		"INCLUDE_IBLOCK_INTO_CHAIN" => $arParams["INCLUDE_IBLOCK_INTO_CHAIN"],
		"ADD_SECTIONS_CHAIN" => $arParams["ADD_SECTIONS_CHAIN"],
		"ADD_ELEMENT_CHAIN" => $arParams["ADD_ELEMENT_CHAIN"],
		"ACTIVE_DATE_FORMAT" => $arParams["DETAIL_ACTIVE_DATE_FORMAT"],
		"CACHE_TYPE" => $arParams["CACHE_TYPE"],
		"CACHE_TIME" => $arParams["CACHE_TIME"],
		"CACHE_GROUPS" => $arParams["CACHE_GROUPS"],
		"USE_PERMISSIONS" => $arParams["USE_PERMISSIONS"],
		"GROUP_PERMISSIONS" => $arParams["GROUP_PERMISSIONS"],
		"DISPLAY_TOP_PAGER" => $arParams["DETAIL_DISPLAY_TOP_PAGER"],
		"DISPLAY_BOTTOM_PAGER" => $arParams["DETAIL_DISPLAY_BOTTOM_PAGER"],
		"PAGER_TITLE" => $arParams["DETAIL_PAGER_TITLE"],
		"PAGER_SHOW_ALWAYS" => "N",
		"PAGER_TEMPLATE" => $arParams["DETAIL_PAGER_TEMPLATE"],
		"PAGER_SHOW_ALL" => $arParams["DETAIL_PAGER_SHOW_ALL"],
		"CHECK_DATES" => $arParams["CHECK_DATES"],
		"ELEMENT_ID" => $arResult["VARIABLES"]["ELEMENT_ID"],
		"ELEMENT_CODE" => $arResult["VARIABLES"]["ELEMENT_CODE"],
		"IBLOCK_URL" => $arResult["FOLDER"].$arResult["URL_TEMPLATES"]["news"],
		"USE_SHARE" 			=> $arParams["USE_SHARE"],
		"SHARE_HIDE" 			=> $arParams["SHARE_HIDE"],
		"SHARE_TEMPLATE" 		=> $arParams["SHARE_TEMPLATE"],
		"SHARE_HANDLERS" 		=> $arParams["SHARE_HANDLERS"],
		"SHARE_SHORTEN_URL_LOGIN"	=> $arParams["SHARE_SHORTEN_URL_LOGIN"],
		"SHARE_SHORTEN_URL_KEY" => $arParams["SHARE_SHORTEN_URL_KEY"],
		"IBLOCK_CATALOG_TYPE" => $arParams["IBLOCK_CATALOG_TYPE"],
		"CATALOG_IBLOCK_ID1" => $arParams["CATALOG_IBLOCK_ID1"],
		"CATALOG_IBLOCK_ID2" => $arParams["CATALOG_IBLOCK_ID2"],
		"CATALOG_IBLOCK_ID3" => $arParams["CATALOG_IBLOCK_ID3"],
		"CATALOG_IBLOCK_ID4" => $arParams["CATALOG_IBLOCK_ID4"],
		"PRODUCT_QUANTITY" => $arParams["USE_PRODUCT_QUANTITY"],
		"SHOW_BUY_BUTTONS" => $arParams["SHOW_BUY_BUTTONS"],
		"USE_PRODUCT_QUANTITY" => $arParams["USE_PRODUCT_QUANTITY"],
		"CATALOG_FILTER_NAME" => $arParams["CATALOG_FILTER_NAME"],
		"SHOW_FAQ_BLOCK" => $arParams["SHOW_FAQ_BLOCK"],
		"SHOW_BACK_LINK" => $arParams["SHOW_BACK_LINK"],
		"DISPLAY_DATE" => $arParams["DISPLAY_DATE"],
		"GALLERY_PROPERTY" => $arParams["GALLERY_PROPERTY"],
		"SHOW_GALLERY" => $arParams["SHOW_GALLERY"],
		"LINKED_PRODUCTS_PROPERTY" => $arParams["LINKED_PRODUCTS_PROPERTY"],
		"SHOW_LINKED_PRODUCTS" => $arParams["SHOW_LINKED_PRODUCTS"],
		"PRICE_PROPERTY" => $arParams["PRICE_PROPERTY"],
		"SHOW_PRICE" => $arParams["SHOW_PRICE"],
		"PERIOD_PROPERTY" => $arParams["PERIOD_PROPERTY"],
		"SHOW_PERIOD" => $arParams["SHOW_PERIOD"],
	),
	$component
);?>
<?if($bUseShare):?>
	<div class="catalog_detail">
		<?$APPLICATION->IncludeFile(SITE_DIR."include/share_buttons.php", Array(), Array("MODE" => "html", "NAME" => 'SOCIAL'));?>
	</div>
<?endif;?>
</div>
<?if ($arParams["SHOW_FAQ_BLOCK"]=="Y"):?></div><?endif;?>148  2791|/aspro.optimus/install/wizards/aspro/optimus/site/templates/aspro_optimus/components/bitrix/system.auth.forgotpasswd/main/template.php|80c8170c<?if (!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED!==true)die();?><?if (!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED!==true)die();?>
<?if(isset($APPLICATION->arAuthResult))
	$arResult['ERROR_MESSAGE'] = $APPLICATION->arAuthResult;?>
<div class="border_block">
	<div class="module-form-block-wr lk-page">
		<?ShowMessage($arResult['ERROR_MESSAGE']);?>
		<div class="form-block">
			<form name="bform" method="post" target="_top" class="bf" action="<?=SITE_DIR?>auth/forgot-password/">
				<?if (strlen($arResult["BACKURL"]) > 0){?><input type="hidden" name="backurl" value="<?=$arResult["BACKURL"]?>" /><?}?>
				<input type="hidden" name="AUTH_FORM" value="Y">
				<input type="hidden" name="TYPE" value="SEND_PWD">
				<?=GetMessage("AUTH_FORGOT_PASSWORD_1")?>
				<br /><br />
				<div class="r form-control">
					<label><?=GetMessage("AUTH_EMAIL")?> <span class="star">*</span></label>
					<input type="email" name="USER_EMAIL"  maxlength="255" required="" />
				</div>
				<?if ($arResult["USE_CAPTCHA"]):?>
					<div class="form-control captcha-row clearfix">
						<label><span><?=GetMessage("FORM_CAPRCHE_TITLE")?>&nbsp;<span class="star">*</span></span></label>
						<div class="captcha_image">
							<img src="/bitrix/tools/captcha.php?captcha_sid=<?=$arResult["CAPTCHA_CODE"]?>" width="180" height="40" alt="CAPTCHA" />
							<input type="hidden" name="captcha_sid" value="<?=$arResult["CAPTCHA_CODE"]?>" />
							<div class="captcha_reload"></div>
						</div>
						<div class="captcha_input">
							<input type="text" class="inputtext captcha" name="captcha_word" size="30" maxlength="50" value="" required />
						</div>
					</div>
				<?endif?>
				<div class="but-r">
					<button class="button vbig_btn wides" type="submit" name="send_account_info" value=""><span><?=GetMessage("RETRIEVE")?></span></button>
					<?/*<div class="prompt"><span class="star">*</span> &mdash;&nbsp; <?=GetMessage("REQUIRED_FIELDS")?></div>
					<div class="clearboth"></div>*/?>
				</div>
			</form>
		</div>
		<script type="text/javascript">document.bform.USER_EMAIL.focus();</script>
	</div>
	<script type="text/javascript">
	$(document).ready(function(){
		$('form[name="bform"]').validate({
			highlight: function( element ){
				$(element).parent().addClass('error');
			},
			unhighlight: function( element ){
				$(element).parent().removeClass('error');
			},
			submitHandler: function( form ){
				if( $('form[name="bform"]').valid() ){
					form.submit();
					setTimeout(function() {
						$(form).find('button[type="submit"]').attr("disabled", "disabled");
					}, 300);
				}
			},
			errorPlacement: function( error, element ){
				error.insertBefore(element);
			}
		});
	});
	</script>
</div>155  952|/aspro.optimus/install/wizards/aspro/optimus/site/templates/aspro_optimus/components/bitrix/system.auth.forgotpasswd/main/lang/ru/template.php|838aeeeb<?
	$MESS ['AUTH_FORGOT_PASSWORD_1'] = "Если вы забыли пароль, введите логин или E-Mail.<br />Контрольная строка для смены пароля, а также ваши регистрационные данные, будут высланы вам по E-Mail.";
	$MESS ['AUTH_GET_CHECK_STRING'] = "Выслать контрольную строку";
	$MESS ['AUTH_SEND'] = "Выслать";
	$MESS ['AUTH_AUTH'] = "Авторизация";
	$MESS ['AUTH_LOGIN'] = "Логин:";
	$MESS ['AUTH_OR'] = "или";
	$MESS ['AUTH_EMAIL'] = "E-Mail:";
	$MESS ['DATA_SENDED'] = "На Ваш E-mail были отправлены данные, необходимые для смены пароля.";
	$MESS ["RETRIEVE"] = "Восстановить";
	$MESS ["REQUIRED_FIELDS"] = "Обязательные поля";
	$MESS ["FORM_CAPRCHE_TITLE"] = "Введите текст с картинки";
?>140  40|/aspro.optimus/install/wizards/aspro/optimus/site/templates/aspro_optimus/components/bitrix/sale.personal.section/main/index.php|ae647681<?
include __DIR__.'/template.php';
?>145  3465|/aspro.optimus/install/wizards/aspro/optimus/site/templates/aspro_optimus/components/bitrix/sale.personal.section/main/template.php|6e584536<?if(!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED!==true)die();

use Bitrix\Main\Localization\Loc;

/*$APPLICATION->SetTitle(Loc::getMessage("SPS_TITLE_MAIN"));
$APPLICATION->AddChainItem(Loc::getMessage("SPS_CHAIN_MAIN"), $arResult['SEF_FOLDER']);

$theme = Bitrix\Main\Config\Option::get("main", "wizard_eshop_bootstrap_theme_id", "blue", SITE_ID);*/

$availablePages = array();

if ($arParams['SHOW_ORDER_PAGE'] === 'Y')
{
	$availablePages[] = array(
		"path" => $arResult['PATH_TO_ORDERS'],
		"name" => Loc::getMessage("SPS_ORDER_PAGE_NAME"),
		"icon" => '<i class="cur_orders"></i>'
	);
}

if ($arParams['SHOW_ACCOUNT_PAGE'] === 'Y')
{
	$availablePages[] = array(
		"path" => $arResult['PATH_TO_ACCOUNT'],
		"name" => Loc::getMessage("SPS_ACCOUNT_PAGE_NAME"),
		"icon" => '<i class="bill"></i>'
	);
}

if ($arParams['SHOW_PRIVATE_PAGE'] === 'Y')
{
	$availablePages[] = array(
		"path" => $arResult['PATH_TO_PRIVATE'],
		"name" => Loc::getMessage("SPS_PERSONAL_PAGE_NAME"),
		"icon" => '<i class="personal"></i>'
	);
}

if ($arParams['SHOW_ORDER_PAGE'] === 'Y')
{

	$delimeter = ($arParams['SEF_MODE'] === 'Y') ? "?" : "&";
	$availablePages[] = array(
		"path" => $arResult['PATH_TO_ORDERS'].$delimeter."filter_history=Y",
		"name" => Loc::getMessage("SPS_ORDER_PAGE_HISTORY"),
		"icon" => '<i class="filter_orders"></i>'
	);
}

if ($arParams['SHOW_PROFILE_PAGE'] === 'Y')
{
	$availablePages[] = array(
		"path" => $arResult['PATH_TO_PROFILE'],
		"name" => Loc::getMessage("SPS_PROFILE_PAGE_NAME"),
		"icon" => '<i class="profile"></i>'
	);
}

if ($arParams['SHOW_BASKET_PAGE'] === 'Y')
{
	$availablePages[] = array(
		"path" => $arParams['PATH_TO_BASKET'],
		"name" => Loc::getMessage("SPS_BASKET_PAGE_NAME"),
		"icon" => '<i class="cart"></i>'
	);
}

if ($arParams['SHOW_SUBSCRIBE_PAGE'] === 'Y')
{
	$availablePages[] = array(
		"path" => $arResult['PATH_TO_SUBSCRIBE'],
		"name" => Loc::getMessage("SPS_SUBSCRIBE_PAGE_NAME"),
		"icon" => '<i class="subscribe"></i>'
	);
}

if ($arParams['SHOW_CONTACT_PAGE'] === 'Y')
{
	$availablePages[] = array(
		"path" => $arParams['PATH_TO_CONTACT'],
		"name" => Loc::getMessage("SPS_CONTACT_PAGE_NAME"),
		"icon" => '<i class="contact"></i>'
	);
}

$customPagesList = json_decode(htmlspecialchars_decode($arParams['CUSTOM_PAGES']));
if ($customPagesList)
{
	foreach ($customPagesList as $page)
	{
		$availablePages[] = array(
			"path" => $page[0],
			"name" => $page[1],
			"icon" => (strlen($page[2])) ? '<i class="fa '.htmlspecialcharsbx($page[2]).'"></i>' : ""
		);
	}
}

if (empty($availablePages))
{
	ShowError(Loc::getMessage("SPS_ERROR_NOT_CHOSEN_ELEMENT"));
}
else
{
	?>

	<div class="personal_wrapper">
		<div class="row sale-personal-section-row-flex">
			<?
			foreach ($availablePages as $blockElement)
			{
				?>
				<div class="col-lg-4 col-md-6 col-sm-12 col-xs-12">
					<div class="sale-personal-section-index-block bx-theme-<?=$theme?>">
						<a class="sale-personal-section-index-block-link" href="<?=htmlspecialcharsbx($blockElement['path'])?>">
						<span class="sale-personal-section-index-block-ico">
							<?=$blockElement['icon']?>
						</span>
							<h2 class="sale-personal-section-index-block-name">
								<?=htmlspecialcharsbx($blockElement['name'])?>
							</h2>
						</a>
					</div>
				</div>
				<?
			}
			?>
		</div>
	</div>
	<?
}
?>
148  40|/aspro.optimus/install/wizards/aspro/optimus/site/templates/aspro_optimus/components/bitrix/sale.personal.section/main/lang/ru/index.php|ae647681<?
include __DIR__.'/template.php';
?>152  712|/aspro.optimus/install/wizards/aspro/optimus/site/templates/aspro_optimus/components/bitrix/sale.personal.section/main/lang/ru/template.php|3f07e06d<?php
$MESS["SPS_ACCOUNT_PAGE_NAME"] = "Личный счет";
$MESS["SPS_PERSONAL_PAGE_NAME"] = "Личные данные";
$MESS["SPS_PROFILE_PAGE_NAME"] = "Профили заказов";
$MESS["SPS_ORDER_PAGE_NAME"] = "Текущие заказы";
$MESS["SPS_ORDER_PAGE_HISTORY"] = "История заказов";
$MESS["SPS_SUBSCRIBE_PAGE_NAME"] = "Подписки";
$MESS["SPS_BASKET_PAGE_NAME"] = "Корзина";
$MESS["SPS_CONTACT_PAGE_NAME"] = "Контакты";
$MESS["SPS_ERROR_NOT_CHOSEN_ELEMENT"] = "Отсутвуют выбранные элементы";
$MESS["SPS_CHAIN_MAIN"] = "Мой кабинет";
$MESS["SPS_TITLE_MAIN"] = "Персональный раздел";


148  40|/aspro.optimus/install/wizards/aspro/optimus/site/templates/aspro_optimus/components/bitrix/sale.personal.section/main/lang/en/index.php|ae647681<?
include __DIR__.'/template.php';
?>152  712|/aspro.optimus/install/wizards/aspro/optimus/site/templates/aspro_optimus/components/bitrix/sale.personal.section/main/lang/en/template.php|3f07e06d<?php
$MESS["SPS_ACCOUNT_PAGE_NAME"] = "Личный счет";
$MESS["SPS_PERSONAL_PAGE_NAME"] = "Личные данные";
$MESS["SPS_PROFILE_PAGE_NAME"] = "Профили заказов";
$MESS["SPS_ORDER_PAGE_NAME"] = "Текущие заказы";
$MESS["SPS_ORDER_PAGE_HISTORY"] = "История заказов";
$MESS["SPS_SUBSCRIBE_PAGE_NAME"] = "Подписки";
$MESS["SPS_BASKET_PAGE_NAME"] = "Корзина";
$MESS["SPS_CONTACT_PAGE_NAME"] = "Контакты";
$MESS["SPS_ERROR_NOT_CHOSEN_ELEMENT"] = "Отсутвуют выбранные элементы";
$MESS["SPS_CHAIN_MAIN"] = "Мой кабинет";
$MESS["SPS_TITLE_MAIN"] = "Персональный раздел";


155  11452|/aspro.optimus/install/wizards/aspro/optimus/site/templates/aspro_optimus/components/bitrix/catalog.section/catalog_block_front/template.php|5b1c8660<?if(!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED!==true)die();?>
<?$this->setFrameMode(true);?>
<?if( count( $arResult["ITEMS"] ) >= 1 ){?>
	<div class="top_wrapper">
		<div class="catalog_block items">
		<?foreach($arResult["ITEMS"] as $arItem){?>
			<?$this->AddEditAction($arItem['ID'], $arItem['EDIT_LINK'], CIBlock::GetArrayByID($arParams["IBLOCK_ID"], "ELEMENT_EDIT"));
			$this->AddDeleteAction($arItem['ID'], $arItem['DELETE_LINK'], CIBlock::GetArrayByID($arParams["IBLOCK_ID"], "ELEMENT_DELETE"), array("CONFIRM" => GetMessage('CT_BCS_ELEMENT_DELETE_CONFIRM')));

			$totalCount = COptimus::GetTotalCount($arItem);
			$arQuantityData = COptimus::GetQuantityArray($totalCount);

			$item_id = $arItem["ID"];
			$strMeasure = '';

			if($arParams["SHOW_MEASURE"] == "Y" && $arItem["CATALOG_MEASURE"]){
				$arMeasure = CCatalogMeasure::getList(array(), array("ID" => $arItem["CATALOG_MEASURE"]), false, false, array())->GetNext();
				$strMeasure = $arMeasure["SYMBOL_RUS"];
			}
			switch ($arParams["LINE_ELEMENT_COUNT"]){
				case '2':
					$col=2;
					break;
				case '3':
					$col=3;
					break;
				default:
					$col=4;
					break;
			}
			?>
			<div class="catalog_item_wrapp col-<?=$col;?> item" data-col="<?=$col;?>">
				<div class="catalog_item item_wrap " id="<?=$this->GetEditAreaId($arItem['ID']);?>">
					<div class="inner_wrap">
						<div class="image_wrapper_block">
							<div class="stickers">
								<?if (is_array($arItem["PROPERTIES"]["HIT"]["VALUE_XML_ID"])):?>
									<?foreach($arItem["PROPERTIES"]["HIT"]["VALUE_XML_ID"] as $key=>$class){?>
										<div><div class="sticker_<?=strtolower($class);?>"><?=$arItem["PROPERTIES"]["HIT"]["VALUE"][$key]?></div></div>
									<?}?>
								<?endif;?>
								<?if($arParams["SALE_STIKER"] && $arItem["PROPERTIES"][$arParams["SALE_STIKER"]]["VALUE"]){?>
									<div><div class="sticker_sale_text"><?=$arItem["PROPERTIES"][$arParams["SALE_STIKER"]]["VALUE"];?></div></div>
								<?}?>
							</div>
							<?if((!$arItem["OFFERS"] && $arParams["DISPLAY_WISH_BUTTONS"] != "N" ) || ($arParams["DISPLAY_COMPARE"] == "Y")):?>
								<div class="like_icons">
									<?if($arParams["DISPLAY_WISH_BUTTONS"] == "Y" && !$arItem["OFFERS"]):?>
										<div class="wish_item_button">
											<span title="<?=GetMessage('CATALOG_WISH')?>" class="wish_item to" data-item="<?=$arItem["ID"]?>" data-iblock="<?=$arItem["IBLOCK_ID"]?>"><i></i></span>
											<span title="<?=GetMessage('CATALOG_WISH_OUT')?>" class="wish_item in added" style="display: none;" data-item="<?=$arItem["ID"]?>" data-iblock="<?=$arItem["IBLOCK_ID"]?>"><i></i></span>
										</div>
									<?endif;?>
									<?if($arParams["DISPLAY_COMPARE"] == "Y"):?>
										<div class="compare_item_button">
											<span title="<?=GetMessage('CATALOG_COMPARE')?>" class="compare_item to" data-iblock="<?=$arParams["IBLOCK_ID"]?>" data-item="<?=$arItem["ID"]?>" ><i></i></span>
											<span title="<?=GetMessage('CATALOG_COMPARE_OUT')?>" class="compare_item in added" style="display: none;" data-iblock="<?=$arParams["IBLOCK_ID"]?>" data-item="<?=$arItem["ID"]?>"><i></i></span>
										</div>
									<?endif;?>
								</div>
							<?endif;?>
							<a href="<?=$arItem["DETAIL_PAGE_URL"]?>" class="thumb">
								<?
								$a_alt=($arItem["IPROPERTY_VALUES"]["ELEMENT_PREVIEW_PICTURE_FILE_ALT"] ? $arItem["IPROPERTY_VALUES"]["ELEMENT_PREVIEW_PICTURE_FILE_ALT"] : $arItem["NAME"] );
								$a_title=($arItem["IPROPERTY_VALUES"]["ELEMENT_PREVIEW_PICTURE_FILE_TITLE"] ? $arItem["IPROPERTY_VALUES"]["ELEMENT_PREVIEW_PICTURE_FILE_TITLE"] : $arItem["NAME"] );
								?>
								<?if( !empty($arItem["PREVIEW_PICTURE"]) ):?>
									<img class="noborder" src="<?=$arItem["PREVIEW_PICTURE"]["SRC"]?>" alt="<?=$a_alt;?>" title="<?=$a_title;?>" />
								<?elseif( !empty($arItem["DETAIL_PICTURE"])):?>
									<?$img = CFile::ResizeImageGet($arItem["DETAIL_PICTURE"], array( "width" => 170, "height" => 170 ), BX_RESIZE_IMAGE_PROPORTIONAL,true );?>
									<img class="noborder" src="<?=$img["src"]?>" alt="<?=$a_alt;?>" title="<?=$a_title;?>" />
								<?else:?>
									<img class="noborder" src="<?=SITE_TEMPLATE_PATH?>/images/no_photo_medium.png" alt="<?=$a_alt;?>" title="<?=$a_title;?>" />
								<?endif;?>
							</a>
						</div>
						<div class="item_info">
							<div class="item-title">
								<a href="<?=$arItem["DETAIL_PAGE_URL"]?>"><span><?=$arItem["NAME"]?></span></a>
							</div>
							<?if($arParams["SHOW_RATING"] == "Y"):?>
								<div class="rating">
									<?$APPLICATION->IncludeComponent(
									   "bitrix:iblock.vote",
									   "element_rating_front",
									   Array(
										  "IBLOCK_TYPE" => $arParams["IBLOCK_TYPE"],
										  "IBLOCK_ID" => $arItem["IBLOCK_ID"],
										  "ELEMENT_ID" =>$arItem["ID"],
										  "MAX_VOTE" => 5,
										  "VOTE_NAMES" => array(),
										  "CACHE_TYPE" => $arParams["CACHE_TYPE"],
										  "CACHE_TIME" => $arParams["CACHE_TIME"],
										  "DISPLAY_AS_RATING" => 'vote_avg'
									   ),
									   $component, array("HIDE_ICONS" =>"Y")
									);?>
								</div>
							<?endif;?>
							<?=$arQuantityData["HTML"];?>
							<div class="cost prices clearfix">
								<?if( $arItem["OFFERS"]){?>
									<?$minPrice = false;
									if (isset($arItem['MIN_PRICE']) || isset($arItem['RATIO_PRICE'])){
										// $minPrice = (isset($arItem['RATIO_PRICE']) ? $arItem['RATIO_PRICE'] : $arItem['MIN_PRICE']);
										$minPrice = $arItem['MIN_PRICE'];
									}
									$offer_id=0;
									if($arParams["TYPE_SKU"]=="N"){
										$offer_id=$minPrice["MIN_ITEM_ID"];
									}
									$min_price_id=$minPrice["MIN_PRICE_ID"];
									if(!$min_price_id)
										$min_price_id=$minPrice["PRICE_ID"];
									if($minPrice["MIN_ITEM_ID"])
										$item_id=$minPrice["MIN_ITEM_ID"];
									$prefix = '';
									if('N' == $arParams['TYPE_SKU'] || $arParams['DISPLAY_TYPE'] !== 'block'){
										$prefix = GetMessage("CATALOG_FROM");
									}
									if($arParams["SHOW_OLD_PRICE"]=="Y"){?>
										<div class="price">
											<?if(strlen($minPrice["PRINT_DISCOUNT_VALUE"])):?>
												<?=$prefix;?> <?=$minPrice["PRINT_DISCOUNT_VALUE"];?><?if (($arParams["SHOW_MEASURE"]=="Y") && $strMeasure):?><span class="price_measure">/<?=$strMeasure?></span><?endif;?>
											<?endif;?>
										</div>
										<?if($arParams["SHOW_OLD_PRICE"]=="Y"):?>
											<div class="price discount">
												<span <?=(!$minPrice["DISCOUNT_DIFF"] ? 'style="display:none;"' : '')?>><?=$minPrice["PRINT_VALUE"];?></span>
											</div>
										<?endif;?>
										<?/*if($arParams["SHOW_DISCOUNT_PERCENT"]=="Y"){?>
											<div class="sale_block" <?=(!$minPrice["DISCOUNT_DIFF"] ? 'style="display:none;"' : '')?>>
												<?$percent=round(($minPrice["DISCOUNT_DIFF"]/$minPrice["VALUE"])*100, 2);?>
												<div class="value">-<?=$percent;?>%</div>
												<div class="text"><?=GetMessage("CATALOG_ECONOMY");?> <span><?=$minPrice["PRINT_DISCOUNT_DIFF"];?></span></div>
												<div class="clearfix"></div>
											</div>
										<?}*/?>
									<?}else{?>
										<div class="price only_price">
											<?if(strlen($minPrice["PRINT_DISCOUNT_VALUE"])):?>
												<?=$prefix;?> <?=$minPrice['PRINT_DISCOUNT_VALUE'];?><?if (($arParams["SHOW_MEASURE"]=="Y") && $strMeasure):?><span class="price_measure">/<?=$strMeasure?></span><?endif;?>
											<?endif;?>
										</div>
									<?}?>
								<?}elseif ( $arItem["PRICES"] ){?>
									<? $arCountPricesCanAccess = 0;
									$min_price_id=0;
									foreach( $arItem["PRICES"] as $key => $arPrice ) { if($arPrice["CAN_ACCESS"]){$arCountPricesCanAccess++;} } ?>
									<?foreach($arItem["PRICES"] as $key => $arPrice){?>
										<?if($arPrice["CAN_ACCESS"]){
											$percent=0;
											if($arPrice["MIN_PRICE"]=="Y"){
												$min_price_id=$arPrice["PRICE_ID"];
											}?>
											<?$price = CPrice::GetByID($arPrice["ID"]);?>
											<?if($arCountPricesCanAccess > 1):?>
												<div class="price_name"><?=$price["CATALOG_GROUP_NAME"];?></div>
											<?endif;?>
											<?if($arPrice["VALUE"] > $arPrice["DISCOUNT_VALUE"] && $arParams["SHOW_OLD_PRICE"]=="Y"){?>
												<div class="price">
													<?if(strlen($arPrice["PRINT_VALUE"])):?>
														<?=$arPrice["PRINT_DISCOUNT_VALUE"];?><?if (($arParams["SHOW_MEASURE"]=="Y") && $strMeasure):?><span class="price_measure">/<?=$strMeasure?></span><?endif;?>
													<?endif;?>
												</div>
												<?if($arParams["SHOW_OLD_PRICE"]=="Y"):?>
													<div class="price discount">
														<span><?=$arPrice["PRINT_VALUE"];?></span>
													</div>
												<?endif;?>
												<?/*if($arParams["SHOW_DISCOUNT_PERCENT"]=="Y"){?>
													<div class="sale_block">
														<?$percent=round(($arPrice["DISCOUNT_DIFF"]/$arPrice["VALUE"])*100, 2);?>
														<?if($percent && $percent<100){?>
															<div class="value">-<?=$percent;?>%</div>
														<?}?>
														<div class="text"><?=GetMessage("CATALOG_ECONOMY");?> <span><?=$arPrice["PRINT_DISCOUNT_DIFF"];?></span></div>
														<div class="clearfix"></div>
													</div>
												<?}*/?>
											<?}else{?>
												<div class="price only_price">
													<?if(strlen($arPrice["PRINT_VALUE"])):?>
														<?=$arPrice["PRINT_VALUE"];?><?if (($arParams["SHOW_MEASURE"]=="Y") && $strMeasure):?><span class="price_measure">/<?=$strMeasure?></span><?endif;?>
													<?endif;?>
												</div>
											<?}?>
										<?}?>
									<?}?>
								<?}?>
							</div>
							<?if($arParams["SHOW_DISCOUNT_TIME"]=="Y"){?>
								<?$arDiscounts = CCatalogDiscount::GetDiscountByProduct( $arItem["ID"], $USER->GetUserGroupArray(), "N", $min_price_id, SITE_ID );
								$arDiscount=array();
								if($arDiscounts)
									$arDiscount=current($arDiscounts);
								if($arDiscount["ACTIVE_TO"]){?>
									<div class="view_sale_block">
										<div class="count_d_block">
											<span class="active_to hidden"><?=$arDiscount["ACTIVE_TO"];?></span>
											<div class="title"><?=GetMessage("UNTIL_AKC");?></div>
											<span class="countdown values"></span>
										</div>
										<div class="quantity_block">
											<div class="title"><?=GetMessage("TITLE_QUANTITY_BLOCK");?></div>
											<div class="values">
												<span class="item">
													<span class="value" <?=( count( $arItem["OFFERS"] ) > 0 ? 'style="opacity:0;"' : '')?>><?=$totalCount;?></span>
													<span class="text"><?=GetMessage("TITLE_QUANTITY");?></span>
												</span>
											</div>
										</div>
									</div>
								<?}?>
							<?}?>
							<div class="footer_button">
								<div class="counter_wrapp">
									<div class="button_block">
										<!--noindex-->
											<a href="<?=$arItem["DETAIL_PAGE_URL"]?>" class="button basket read_more"><?=GetMessage("CATALOG_READ_MORE");?></a>
										<!--/noindex-->
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		<?}?>
		</div>
	</div>
<?}?>
149  15340|/aspro.optimus/install/wizards/aspro/optimus/site/templates/aspro_optimus/components/bitrix/catalog.section/catalog_table/template.php|c6956c90<?if(!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED!==true)die();?>
<?$this->setFrameMode(true);?>
<?if( count( $arResult["ITEMS"] ) >= 1 ){?>
	<?$arParams["BASKET_ITEMS"]=($arParams["BASKET_ITEMS"] ? $arParams["BASKET_ITEMS"] : array());?>
	<?if($arParams["AJAX_REQUEST"]=="N"){?>
	<table class="module_products_list">
		<tbody>
	<?}?>
			<?$arOfferProps = implode(';', $arParams['OFFERS_CART_PROPERTIES']);?>
			<?foreach($arResult["ITEMS"]  as $arItem){
				$this->AddEditAction($arItem['ID'], $arItem['EDIT_LINK'], CIBlock::GetArrayByID($arParams["IBLOCK_ID"], "ELEMENT_EDIT"));
				$this->AddDeleteAction($arItem['ID'], $arItem['DELETE_LINK'], CIBlock::GetArrayByID($arParams["IBLOCK_ID"], "ELEMENT_DELETE"), array("CONFIRM" => GetMessage('CT_BCS_ELEMENT_DELETE_CONFIRM')));
				$totalCount = COptimus::GetTotalCount($arItem);
				$arQuantityData = COptimus::GetQuantityArray($totalCount);

				$strMeasure = '';
				if(!$arItem["OFFERS"] || $arParams['TYPE_SKU'] === 'TYPE_2'){
					if($arParams["SHOW_MEASURE"] == "Y" && $arItem["CATALOG_MEASURE"]){
						$arMeasure = CCatalogMeasure::getList(array(), array("ID" => $arItem["CATALOG_MEASURE"]), false, false, array())->GetNext();
						$strMeasure = $arMeasure["SYMBOL_RUS"];
					}
					$arItem["OFFERS_MORE"]="Y";
				}
				elseif($arItem["OFFERS"]){
					$strMeasure = $arItem["MIN_PRICE"]["CATALOG_MEASURE_NAME"];
					$arItem["OFFERS_MORE"]="Y";
				}
				$elementName = ((isset($arItem['IPROPERTY_VALUES']['ELEMENT_PAGE_TITLE']) && $arItem['IPROPERTY_VALUES']['ELEMENT_PAGE_TITLE']) ? $arItem['IPROPERTY_VALUES']['ELEMENT_PAGE_TITLE'] : $arItem['NAME']);
				?>
				<tr class="item" id="<?=$this->GetEditAreaId($arItem['ID']);?>">
					<td class="foto-cell">
						<div class="image_wrapper_block">
							<?
							$a_alt=($arItem["IPROPERTY_VALUES"]["ELEMENT_PREVIEW_PICTURE_FILE_ALT"] ? $arItem["IPROPERTY_VALUES"]["ELEMENT_PREVIEW_PICTURE_FILE_ALT"] : $arItem["NAME"] );
							$a_title=($arItem["IPROPERTY_VALUES"]["ELEMENT_PREVIEW_PICTURE_FILE_TITLE"] ? $arItem["IPROPERTY_VALUES"]["ELEMENT_PREVIEW_PICTURE_FILE_TITLE"] : $arItem["NAME"] );
							?>
							<?if( !empty($arItem["DETAIL_PICTURE"]) || !empty($arItem["PREVIEW_PICTURE"]) ){?>
								<?
								$picture=($arItem["PREVIEW_PICTURE"] ? $arItem["PREVIEW_PICTURE"] : $arItem["DETAIL_PICTURE"]);
								$img_preview = CFile::ResizeImageGet( $picture, array( "width" => 50, "height" => 50 ), BX_RESIZE_IMAGE_PROPORTIONAL_ALT, true);?>
								<?if ($arParams["LIST_DISPLAY_POPUP_IMAGE"]=="Y"){?>
									<a class="popup_image fancy" href="<?=$arItem["DETAIL_PICTURE"]["SRC"]?>" title="<?=$a_title;?>">
								<?}?>
									<img src="<?=$img_preview["src"]?>" alt="<?=$a_alt;?>" title="<?=$a_title;?>" />
								<?if ($arParams["LIST_DISPLAY_POPUP_IMAGE"]=="Y"){?>
									</a>
								<?}?>
							<?}else{?>
								<img src="<?=SITE_TEMPLATE_PATH?>/images/no_photo_small.png" alt="<?=$a_alt;?>" title="<?=$a_title;?>" />
							<?}?>
						</div>
					</td>
					<td class="item-name-cell">
						<div class="title"><a href="<?=$arItem["DETAIL_PAGE_URL"]?>"><?=$elementName?></a></div>
						<?if($arParams["SHOW_RATING"] == "Y"):?>
							<div class="rating">
								<?$APPLICATION->IncludeComponent(
								   "bitrix:iblock.vote",
								   "element_rating_front",
								   Array(
									  "IBLOCK_TYPE" => $arParams["IBLOCK_TYPE"],
									  "IBLOCK_ID" => $arItem["IBLOCK_ID"],
									  "ELEMENT_ID" =>$arItem["ID"],
									  "MAX_VOTE" => 5,
									  "VOTE_NAMES" => array(),
									  "CACHE_TYPE" => $arParams["CACHE_TYPE"],
									  "CACHE_TIME" => $arParams["CACHE_TIME"],
									  "DISPLAY_AS_RATING" => 'vote_avg'
								   ),
								   $component, array("HIDE_ICONS" =>"Y")
								);?>
							</div>
						<?endif;?>
						<?=$arQuantityData["HTML"];?>
					</td>
					<td class="price-cell">
						<div class="cost prices clearfix">
							<?if( count( $arItem["OFFERS"] ) > 0 ){?>
								<?$minPrice = false;
								if (isset($arItem['MIN_PRICE']) || isset($arItem['RATIO_PRICE']))
									$minPrice = (isset($arItem['RATIO_PRICE']) ? $arItem['RATIO_PRICE'] : $arItem['MIN_PRICE']);
								$prefix='';
								if('N' == $arParams['TYPE_SKU'] || $arParams['DISPLAY_TYPE'] =='table'){
									$prefix=GetMessage("CATALOG_FROM");
								}
								if($minPrice["VALUE"]>$minPrice["DISCOUNT_VALUE"]){?>
									<div class="price">
										<?if(strlen($minPrice["PRINT_DISCOUNT_VALUE"])):?>
											<?=$prefix;?> <?=$minPrice["PRINT_DISCOUNT_VALUE"];?><?if (($arParams["SHOW_MEASURE"]=="Y") && $strMeasure):?><span class="price_measure">/<?=$strMeasure?></span><?endif;?>
										<?endif;?>
									</div>
									<?if($arParams["SHOW_OLD_PRICE"]=="Y"):?>
										<div class="price discount">
											<span><?=$minPrice["PRINT_VALUE"];?></span>
										</div>
									<?endif;?>
								<?}else{?>
									<div class="price">
										<?if(strlen($minPrice["PRINT_DISCOUNT_VALUE"])):?>
											<?=$prefix;?> <?=$minPrice['PRINT_DISCOUNT_VALUE'];?><?if (($arParams["SHOW_MEASURE"]=="Y") && $strMeasure):?><span class="price_measure">/<?=$strMeasure?></span><?endif;?>
										<?endif;?>
									</div>
								<?}?>
							<?}else{?>
								<?
								$arCountPricesCanAccess = 0;
								$min_price_id=0;
								foreach( $arItem["PRICES"] as $key => $arPrice ) { if($arPrice["CAN_ACCESS"]){$arCountPricesCanAccess++;} }
								?>
								<?foreach($arItem["PRICES"] as $key => $arPrice){?>
									<?if($arPrice["CAN_ACCESS"]){
										$percent=0;
										if($arPrice["MIN_PRICE"]=="Y"){
											$min_price_id=$arPrice["PRICE_ID"];
										}?>
										<?$price = CPrice::GetByID($arPrice["ID"]);?>
										<?if($arCountPricesCanAccess > 1):?>
											<div class="price_name"><?=$price["CATALOG_GROUP_NAME"];?></div>
										<?endif;?>
										<?if($arPrice["VALUE"] > $arPrice["DISCOUNT_VALUE"]){?>
											<div class="price">
												<?if(strlen($arPrice["PRINT_DISCOUNT_VALUE"])):?>
													<?=$arPrice["PRINT_DISCOUNT_VALUE"];?><?if (($arParams["SHOW_MEASURE"]=="Y") && $strMeasure):?><span class="price_measure">/<?=$strMeasure?></span><?endif;?>
												<?endif;?>
											</div>
											<?if($arParams["SHOW_OLD_PRICE"]=="Y"):?>
												<div class="price discount">
													<span><?=$arPrice["PRINT_VALUE"];?></span>
												</div>
											<?endif;?>
										<?}else{?>
											<div class="price">
												<?if(strlen($arPrice["PRINT_VALUE"])):?>
													<?=$arPrice["PRINT_VALUE"];?><?if (($arParams["SHOW_MEASURE"]=="Y") && $strMeasure):?><span class="price_measure">/<?=$strMeasure?></span><?endif;?>
												<?endif;?>
											</div>
										<?}?>
									<?}?>
								<?}?>
							<?}?>
						</div>

						<div class="basket_props_block" id="bx_basket_div_<?=$arItem["ID"];?>" style="display: none;">
							<?if (!empty($arItem['PRODUCT_PROPERTIES_FILL'])){
								foreach ($arItem['PRODUCT_PROPERTIES_FILL'] as $propID => $propInfo){?>
									<input type="hidden" name="<? echo $arParams['PRODUCT_PROPS_VARIABLE']; ?>[<? echo $propID; ?>]" value="<? echo htmlspecialcharsbx($propInfo['ID']); ?>">
									<?if (isset($arItem['PRODUCT_PROPERTIES'][$propID]))
										unset($arItem['PRODUCT_PROPERTIES'][$propID]);
								}
							}
							$arItem["EMPTY_PROPS_JS"]="Y";
							$emptyProductProperties = empty($arItem['PRODUCT_PROPERTIES']);
							if (!$emptyProductProperties){
								$arItem["EMPTY_PROPS_JS"]="N";?>
								<div class="wrapper">
									<table>
										<?foreach ($arItem['PRODUCT_PROPERTIES'] as $propID => $propInfo){?>
											<tr>
												<td><? echo $arItem['PROPERTIES'][$propID]['NAME']; ?></td>
												<td>
													<?if('L' == $arItem['PROPERTIES'][$propID]['PROPERTY_TYPE']	&& 'C' == $arItem['PROPERTIES'][$propID]['LIST_TYPE']){
														foreach($propInfo['VALUES'] as $valueID => $value){?>
															<label>
																<input type="radio" name="<? echo $arParams['PRODUCT_PROPS_VARIABLE']; ?>[<? echo $propID; ?>]" value="<? echo $valueID; ?>" <? echo ($valueID == $propInfo['SELECTED'] ? '"checked"' : ''); ?>><? echo $value; ?>
															</label>
														<?}
													}else{?>
														<select name="<? echo $arParams['PRODUCT_PROPS_VARIABLE']; ?>[<? echo $propID; ?>]"><?
															foreach($propInfo['VALUES'] as $valueID => $value){?>
																<option value="<? echo $valueID; ?>" <? echo ($valueID == $propInfo['SELECTED'] ? '"selected"' : ''); ?>><? echo $value; ?></option>
															<?}?>
														</select>
													<?}?>
												</td>
											</tr>
										<?}?>
									</table>
								</div>
								<?
							}?>
						</div>
						<?$arAddToBasketData = COptimus::GetAddToBasketArray($arItem, $totalCount, $arParams["DEFAULT_COUNT"], $arParams["BASKET_URL"], false, array(), 'small', $arParams);?>
						<div class="adaptive_button_buy">
							<!--noindex-->
								<?=$arAddToBasketData["HTML"]?>
							<!--/noindex-->
						</div>
					</td>
					<td class="but-cell item_<?=$arItem["ID"]?>">
						<div class="counter_wrapp">
							<?if($arAddToBasketData["OPTIONS"]["USE_PRODUCT_QUANTITY_LIST"] && !count($arItem["OFFERS"]) && $arAddToBasketData["ACTION"] == "ADD" && $arItem["CAN_BUY"]):?>
								<div class="counter_block" data-item="<?=$arItem["ID"];?>" <?=(in_array($arItem["ID"], $arParams["BASKET_ITEMS"]) ? "style='display: none;'" : "");?>>
									<span class="minus">-</span>
									<input type="text" class="text" name="count_items" value="<?=$arAddToBasketData["MIN_QUANTITY_BUY"]?>" />
									<span class="plus" <?=($arAddToBasketData["MAX_QUANTITY_BUY"] ? "data-max='".$arAddToBasketData["MAX_QUANTITY_BUY"]."'" : "")?>>+</span>
								</div>
							<?endif;?>
							<div class="button_block <?=(in_array($arItem["ID"], $arParams["BASKET_ITEMS"])  || $arAddToBasketData["ACTION"] == "ORDER" || !$arItem["CAN_BUY"] || !$arAddToBasketData["OPTIONS"]["USE_PRODUCT_QUANTITY_LIST"] ? "wide" : "");?>">
								<!--noindex-->
									<?=$arAddToBasketData["HTML"]?>
								<!--/noindex-->
							</div>
						</div>
					</td>
					<?//if((!$arItem["OFFERS"] && $arParams["DISPLAY_WISH_BUTTONS"] != "N" ) || ($arParams["DISPLAY_COMPARE"] == "Y")):?>
						<td class="like_icons <?=(((!$arItem["OFFERS"] && $arParams["DISPLAY_WISH_BUTTONS"] != "N" && $arItem["CAN_BUY"]) && ($arParams["DISPLAY_COMPARE"] == "Y")) ? " full" : "")?>">
							<div class="wrapp_stockers">
								<div class="like_icons">
									<?if($arParams["DISPLAY_WISH_BUTTONS"] != "N"):?>
										<?if(!$arItem["OFFERS"]):?>
											<div class="wish_item_button">
												<span title="<?=GetMessage('CATALOG_WISH')?>" class="wish_item to" data-item="<?=$arItem["ID"]?>" data-iblock="<?=$arItem["IBLOCK_ID"]?>"><i></i></span>
												<span title="<?=GetMessage('CATALOG_WISH_OUT')?>" class="wish_item in added" style="display: none;" data-item="<?=$arItem["ID"]?>" data-iblock="<?=$arItem["IBLOCK_ID"]?>"><i></i></span>
											</div>
										<?elseif($arItem["OFFERS"]):?>
											<?foreach($arItem["OFFERS"] as $arOffer):?>
												<?if($arOffer['CAN_BUY']):?>
													<div class="wish_item_button o_<?=$arOffer["ID"];?>" style="display: none;">
														<span title="<?=GetMessage('CATALOG_WISH')?>" class="wish_item to <?=$arParams["TYPE_SKU"];?>" data-item="<?=$arOffer["ID"]?>" data-iblock="<?=$arItem["IBLOCK_ID"]?>" data-offers="Y" data-props="<?=$arOfferProps?>"><i></i></span>
														<span title="<?=GetMessage('CATALOG_WISH_OUT')?>" class="wish_item in added <?=$arParams["TYPE_SKU"];?>" style="display: none;" data-item="<?=$arOffer["ID"]?>" data-iblock="<?=$arOffer["IBLOCK_ID"]?>"><i></i></span>
													</div>
												<?endif;?>
											<?endforeach;?>
										<?endif;?>
									<?endif;?>
									<?if($arParams["DISPLAY_COMPARE"] == "Y"):?>
										<?if(!$arItem["OFFERS"] || $arParams["TYPE_SKU"] !== 'TYPE_1'):?>
											<div class="compare_item_button">
												<span title="<?=GetMessage('CATALOG_COMPARE')?>" class="compare_item to" data-iblock="<?=$arParams["IBLOCK_ID"]?>" data-item="<?=$arItem["ID"]?>" ><i></i></span>
												<span title="<?=GetMessage('CATALOG_COMPARE_OUT')?>" class="compare_item in added" style="display: none;" data-iblock="<?=$arParams["IBLOCK_ID"]?>" data-item="<?=$arItem["ID"]?>"><i></i></span>
											</div>
										<?elseif($arItem["OFFERS"]):?>
											<?foreach($arItem["OFFERS"] as $arOffer):?>
												<div class="compare_item_button o_<?=$arOffer["ID"];?>" style="display: none;">
													<span title="<?=GetMessage('CATALOG_COMPARE')?>" class="compare_item to <?=$arParams["TYPE_SKU"];?>" data-iblock="<?=$arParams["IBLOCK_ID"]?>" data-item="<?=$arOffer["ID"]?>" ><i></i></span>
													<span title="<?=GetMessage('CATALOG_COMPARE_OUT')?>" class="compare_item in added <?=$arParams["TYPE_SKU"];?>" style="display: none;" data-iblock="<?=$arParams["IBLOCK_ID"]?>" data-item="<?=$arOffer["ID"]?>"><i></i></span>
												</div>
											<?endforeach;?>
										<?endif;?>
									<?endif;?>
								</div>
							</div>
						</td>
					<?//endif;?>
				</tr>
			<?}?>
	<?if($arParams["AJAX_REQUEST"]=="N"){?>
		</tbody>
	</table>
		<script>
			$(document).ready(function(){
				$('.sort_header').fadeIn();
			})
		</script>
	<?}?>
	<?if($arParams["AJAX_REQUEST"]=="Y"){?>
		<div class="wrap_nav">
		<tr <?=($arResult["NavPageCount"]>1 ? "" : "style='display: none;'");?>><td>
	<?}?>

		<div>
		<div class="bottom_nav <?=$arParams["DISPLAY_TYPE"];?>" <?=($arParams["AJAX_REQUEST"]=="Y"  && $arResult["NavPageCount"]<=1 ? "style='display: none; '" : "");?>>
			<?if( $arParams["DISPLAY_BOTTOM_PAGER"] == "Y" ){?><?=$arResult["NAV_STRING"]?><?}?>
		</div>
		</div>

	<?if($arParams["AJAX_REQUEST"]=="Y"){?>
		</td></tr>
		</div>
	<?}?>
	<script type="text/javascript">
		$('.module_products_list').removeClass('errors');
	</script>
<?}else{?>
	<?if($arParams["AJAX_REQUEST"]!="Y"){?>
		<table class="module_products_list errors">
		<tbody>
		<tr><td>
	<?}?>
		<script type="text/javascript">
			$('.module_products_list').addClass('errors');
		</script>
		<div class="module_products_list_b">
			<div class="no_goods">
				<div class="no_products">
					<div class="wrap_text_empty">
						<?if($_REQUEST["set_filter"]){?>
							<?$APPLICATION->IncludeFile(SITE_DIR."include/section_no_products_filter.php", Array(), Array("MODE" => "html",  "NAME" => GetMessage('EMPTY_CATALOG_DESCR')));?>
						<?}else{?>
							<?$APPLICATION->IncludeFile(SITE_DIR."include/section_no_products.php", Array(), Array("MODE" => "html",  "NAME" => GetMessage('EMPTY_CATALOG_DESCR')));?>
						<?}?>
					</div>
				</div>
				<?if($_REQUEST["set_filter"]){?>
					<span class="button wide"><?=GetMessage('RESET_FILTERS');?></span>
				<?}?>
			</div>
		</div>
		<?if($arParams["AJAX_REQUEST"]!="Y"){?>
		</td></tr>
		</tbody>
		</table>
	<?}?>
<?}?>156  20350|/aspro.optimus/install/wizards/aspro/optimus/site/templates/aspro_optimus/components/bitrix/catalog.section/catalog_block_slider/template.php|5a4654ed<?if(!defined("B_PROLOG_INCLUDED") || B_PROLOG_INCLUDED!==true)die();?>
<?$this->setFrameMode(true);?>
<?if( count( $arResult["ITEMS"] ) >= 1 ){
	$injectId = 'sale_gift_product_'.$this->randString();?>
	<ul class="viewed_navigation slider_navigation top_big custom_flex border"></ul>
	<div class="s_<?=$injectId;?> <?=($arParams["SHOW_UNABLE_SKU_PROPS"] != "N" ? "show_un_props" : "unshow_un_props");?>">
		<div class="all_wrapp s_<?=$injectId;?>">
			<div class="content_inner tab">
				<ul class="tabs_slider slides wr">
					<?
					$elementEdit = CIBlock::GetArrayByID($arParams['IBLOCK_ID'], 'ELEMENT_EDIT');
					$elementDelete = CIBlock::GetArrayByID($arParams['IBLOCK_ID'], 'ELEMENT_DELETE');
					$elementDeleteParams = array('CONFIRM' => GetMessage('CVP_TPL_ELEMENT_DELETE_CONFIRM'));
					?>
					<?foreach($arResult['ITEMS'] as $key => $arItem){
						$this->AddEditAction($arItem['ID'], $arItem['EDIT_LINK'], $elementEdit);
						$this->AddDeleteAction($arItem['ID'], $arItem['DELETE_LINK'], $elementDelete, $elementDeleteParams);
						$arItem["strMainID"] = $this->GetEditAreaId($arItem['ID']);
						$arItemIDs=COptimus::GetItemsIDs($arItem);

						$strMeasure = '';
						$totalCount = COptimus::GetTotalCount($arItem);
						$arQuantityData = COptimus::GetQuantityArray($totalCount, $arItemIDs["ALL_ITEM_IDS"]);
						if(!$arItem["OFFERS"]){
							if($arParams["SHOW_MEASURE"] == "Y" && $arItem["CATALOG_MEASURE"]){
								$arMeasure = CCatalogMeasure::getList(array(), array("ID" => $arItem["CATALOG_MEASURE"]), false, false, array())->GetNext();
								$strMeasure = $arMeasure["SYMBOL_RUS"];
							}
							$arAddToBasketData = COptimus::GetAddToBasketArray($arItem, $totalCount, $arParams["DEFAULT_COUNT"], $arParams["BASKET_URL"], false, $arItemIDs["ALL_ITEM_IDS"], 'small', $arParams);
						}
						elseif($arItem["OFFERS"]){
							$strMeasure = $arItem["MIN_PRICE"]["CATALOG_MEASURE_NAME"];
							if(!$arItem['OFFERS_PROP']){

								$arAddToBasketData = COptimus::GetAddToBasketArray($arItem["OFFERS"][0], $totalCount, $arParams["DEFAULT_COUNT"], $arParams["BASKET_URL"], false, $arItemIDs["ALL_ITEM_IDS"], 'small', $arParams);
							}
						}
						?>
						<li class="catalog_item" id="<?=$arItem["strMainID"];?>">
							<div class="image_wrapper_block">
								<div class="stickers">
									<?if (is_array($arItem["PROPERTIES"]["HIT"]["VALUE_XML_ID"])):?>
										<?foreach($arItem["PROPERTIES"]["HIT"]["VALUE_XML_ID"] as $key=>$class){?>
											<div><div class="sticker_<?=strtolower($class);?>"><?=$arItem["PROPERTIES"]["HIT"]["VALUE"][$key]?></div></div>
										<?}?>
									<?endif;?>
									<?if($arParams["SALE_STIKER"] && $arItem["PROPERTIES"][$arParams["SALE_STIKER"]]["VALUE"]){?>
										<div><div class="sticker_sale_text"><?=$arItem["PROPERTIES"][$arParams["SALE_STIKER"]]["VALUE"];?></div></div>
									<?}?>
								</div>
								<?if((!$arItem["OFFERS"] && $arParams["DISPLAY_WISH_BUTTONS"] != "N" ) || ($arParams["DISPLAY_COMPARE"] == "Y")):?>
									<div class="like_icons">
										<?if($arParams["DISPLAY_WISH_BUTTONS"] != "N"):?>
											<?if(!$arItem["OFFERS"]):?>
												<div class="wish_item_button">
													<span title="<?=GetMessage('CATALOG_WISH')?>" class="wish_item to" data-item="<?=$arItem["ID"]?>" data-iblock="<?=$arItem["IBLOCK_ID"]?>"><i></i></span>
													<span title="<?=GetMessage('CATALOG_WISH_OUT')?>" class="wish_item in added" style="display: none;" data-item="<?=$arItem["ID"]?>" data-iblock="<?=$arItem["IBLOCK_ID"]?>"><i></i></span>
												</div>
											<?elseif($arItem["OFFERS"] && !empty($arItem['OFFERS_PROP'])):?>
												<div class="wish_item_button" style="display: none;">
													<span title="<?=GetMessage('CATALOG_WISH')?>" class="wish_item to <?=$arParams["TYPE_SKU"];?>" data-item="" data-iblock="<?=$arItem["IBLOCK_ID"]?>" data-offers="Y" data-props="<?=$arOfferProps?>"><i></i></span>
													<span title="<?=GetMessage('CATALOG_WISH_OUT')?>" class="wish_item in added <?=$arParams["TYPE_SKU"];?>" style="display: none;" data-item="" data-iblock="<?=$arItem["IBLOCK_ID"]?>"><i></i></span>
												</div>
											<?endif;?>
										<?endif;?>
										<?if($arParams["DISPLAY_COMPARE"] == "Y"):?>
											<?if(!$arItem["OFFERS"] || $arParams["TYPE_SKU"] !== 'TYPE_1'):?>
												<div class="compare_item_button">
													<span title="<?=GetMessage('CATALOG_COMPARE')?>" class="compare_item to" data-iblock="<?=$arItem["IBLOCK_ID"]?>" data-item="<?=$arItem["ID"]?>" ><i></i></span>
													<span title="<?=GetMessage('CATALOG_COMPARE_OUT')?>" class="compare_item in added" style="display: none;" data-iblock="<?=$arItem["IBLOCK_ID"]?>" data-item="<?=$arItem["ID"]?>"><i></i></span>
												</div>
											<?elseif($arItem["OFFERS"]):?>
												<div class="compare_item_button">
													<span title="<?=GetMessage('CATALOG_COMPARE')?>" class="compare_item to <?=$arParams["TYPE_SKU"];?>" data-iblock="<?=$arItem["IBLOCK_ID"]?>" data-item="" ><i></i></span>
													<span title="<?=GetMessage('CATALOG_COMPARE_OUT')?>" class="compare_item in added <?=$arParams["TYPE_SKU"];?>" style="display: none;" data-iblock="<?=$arItem["IBLOCK_ID"]?>" data-item=""><i></i></span>
												</div>
											<?endif;?>
										<?endif;?>
									</div>
								<?endif;?>
								<a href="<?=$arItem["DETAIL_PAGE_URL"]?>" class="thumb" id="<? echo $arItemIDs["ALL_ITEM_IDS"]['PICT']; ?>">
									<?
									$a_alt=($arItem["IPROPERTY_VALUES"]["ELEMENT_PREVIEW_PICTURE_FILE_ALT"] ? $arItem["IPROPERTY_VALUES"]["ELEMENT_PREVIEW_PICTURE_FILE_ALT"] : $arItem["NAME"] );
									$a_title=($arItem["IPROPERTY_VALUES"]["ELEMENT_PREVIEW_PICTURE_FILE_TITLE"] ? $arItem["IPROPERTY_VALUES"]["ELEMENT_PREVIEW_PICTURE_FILE_TITLE"] : $arItem["NAME"] );
									?>
									<?if( !empty($arItem["PREVIEW_PICTURE"]) ):?>
										<img src="<?=$arItem["PREVIEW_PICTURE"]["SRC"]?>" alt="<?=$a_alt;?>" title="<?=$a_title;?>" />
									<?elseif( !empty($arItem["DETAIL_PICTURE"])):?>
										<?$img = CFile::ResizeImageGet($arItem["DETAIL_PICTURE"], array( "width" => 170, "height" => 170 ), BX_RESIZE_IMAGE_PROPORTIONAL,true );?>
										<img src="<?=$img["src"]?>" alt="<?=$a_alt;?>" title="<?=$a_title;?>" />
									<?else:?>
										<img src="<?=SITE_TEMPLATE_PATH?>/images/no_photo_medium.png" alt="<?=$a_alt;?>" title="<?=$a_title;?>" />
									<?endif;?>
								</a>
							</div>
							<div class="item_info <?=$arParams["TYPE_SKU"]?>">
								<div class="item-title">
									<a href="<?=$arItem["DETAIL_PAGE_URL"]?>"><span><?=$arItem["NAME"]?></span></a>
								</div>
								<?if($arParams["SHOW_RATING"] == "Y"):?>
									<div class="rating">
										<?$APPLICATION->IncludeComponent(
										   "bitrix:iblock.vote",
										   "element_rating_front",
										   Array(
											  "IBLOCK_TYPE" => $arParams["IBLOCK_TYPE"],
											  "IBLOCK_ID" => $arItem["IBLOCK_ID"],
											  "ELEMENT_ID" =>$arItem["ID"],
											  "MAX_VOTE" => 5,
											  "VOTE_NAMES" => array(),
											  "CACHE_TYPE" => $arParams["CACHE_TYPE"],
											  "CACHE_TIME" => $arParams["CACHE_TIME"],
											  "DISPLAY_AS_RATING" => 'vote_avg'
										   ),
										   $component, array("HIDE_ICONS" =>"Y")
										);?>
									</div>
								<?endif;?>
								<?=$arQuantityData["HTML"];?>
								<div class="cost prices clearfix">
									<?if( $arItem["OFFERS"]){?>
										<?$minPrice = false;
										if (isset($arItem['MIN_PRICE']) || isset($arItem['RATIO_PRICE'])){
											// $minPrice = (isset($arItem['RATIO_PRICE']) ? $arItem['RATIO_PRICE'] : $arItem['MIN_PRICE']);
											$minPrice = $arItem['MIN_PRICE'];
										}
										$offer_id=0;
										if($arParams["TYPE_SKU"]=="N"){
											$offer_id=$minPrice["MIN_ITEM_ID"];
										}
										$min_price_id=$minPrice["MIN_PRICE_ID"];
										if(!$min_price_id)
											$min_price_id=$minPrice["PRICE_ID"];
										if($minPrice["MIN_ITEM_ID"])
											$item_id=$minPrice["MIN_ITEM_ID"];
										$prefix = '';
										if('N' == $arParams['TYPE_SKU'] || $arParams['DISPLAY_TYPE'] !== 'block' || empty($arItem['OFFERS_PROP'])){
											$prefix = GetMessage("CATALOG_FROM");
										}
										if($arParams["SHOW_OLD_PRICE"]=="Y"){?>
											<div class="price" id="<? echo $arItemIDs["ALL_ITEM_IDS"]['PRICE']; ?>">
												<?if(strlen($minPrice["PRINT_DISCOUNT_VALUE"])):?>
													<?=$prefix;?> <?=$minPrice["PRINT_DISCOUNT_VALUE"];?><?if (($arParams["SHOW_MEASURE"]=="Y") && $strMeasure):?><span class="price_measure">/<?=$strMeasure?></span><?endif;?>
												<?endif;?>
											</div>
											<div class="price discount" id="<? echo $arItemIDs["ALL_ITEM_IDS"]['PRICE_OLD']; ?>" <?=(!$minPrice["DISCOUNT_DIFF"] ? 'style="display:none;"' : '')?>>
												<span <?=(!$minPrice["DISCOUNT_DIFF"] ? 'style="display:none;"' : '')?>><?=$minPrice["PRINT_VALUE"];?></span>
											</div>
											<?/*if($arParams["SHOW_DISCOUNT_PERCENT"]=="Y"){?>
												<div class="sale_block" <?=(!$minPrice["DISCOUNT_DIFF"] ? 'style="display:none;"' : '')?>>
													<?$percent=round(($minPrice["DISCOUNT_DIFF"]/$minPrice["VALUE"])*100, 2);?>
													<div class="value">-<?=$percent;?>%</div>
													<div class="text"><?=GetMessage("CATALOG_ECONOMY");?> <span><?=$minPrice["PRINT_DISCOUNT_DIFF"];?></span></div>
													<div class="clearfix"></div>
												</div>
											<?}*/?>
										<?}else{?>
											<div class="price only_price" id="<?=$arItemIDs["ALL_ITEM_IDS"]['PRICE']?>">
												<?if(strlen($minPrice["PRINT_DISCOUNT_VALUE"])):?>
													<?=$prefix;?> <?=$minPrice['PRINT_DISCOUNT_VALUE'];?><?if (($arParams["SHOW_MEASURE"]=="Y") && $strMeasure):?><span class="price_measure">/<?=$strMeasure?></span><?endif;?>
												<?endif;?>
											</div>
										<?}?>
									<?}elseif ( $arItem["PRICES"] ){?>
										<? $arCountPricesCanAccess = 0;
										$min_price_id=0;
										foreach( $arItem["PRICES"] as $key => $arPrice ) { if($arPrice["CAN_ACCESS"]){$arCountPricesCanAccess++;} } ?>
										<?foreach($arItem["PRICES"] as $key => $arPrice){?>
											<?if($arPrice["CAN_ACCESS"]){
												$percent=0;
												if($arPrice["MIN_PRICE"]=="Y"){
													$min_price_id=$arPrice["PRICE_ID"];
												}?>
												<?$price = CPrice::GetByID($arPrice["ID"]);?>
												<?if($arCountPricesCanAccess > 1):?>
													<div class="price_name"><?=$price["CATALOG_GROUP_NAME"];?></div>
												<?endif;?>
												<?if($arPrice["VALUE"] > $arPrice["DISCOUNT_VALUE"] && $arParams["SHOW_OLD_PRICE"]=="Y"){?>
													<div class="price">
														<?if(strlen($arPrice["PRINT_VALUE"])):?>
															<?=$arPrice["PRINT_DISCOUNT_VALUE"];?><?if (($arParams["SHOW_MEASURE"]=="Y") && $strMeasure):?><span class="price_measure">/<?=$strMeasure?></span><?endif;?>
														<?endif;?>
													</div>
													<?if($arParams["SHOW_OLD_PRICE"]=="Y"):?>
														<div class="price discount">
															<span><?=$arPrice["PRINT_VALUE"];?></span>
														</div>
													<?endif;?>
													<?/*if($arParams["SHOW_DISCOUNT_PERCENT"]=="Y"){?>
														<div class="sale_block">
															<?$percent=round(($arPrice["DISCOUNT_DIFF"]/$arPrice["VALUE"])*100, 2);?>
															<?if($percent && $percent<100){?>
																<div class="value">-<?=$percent;?>%</div>
															<?}?>
															<div class="text"><?=GetMessage("CATALOG_ECONOMY");?> <span><?=$arPrice["PRINT_DISCOUNT_DIFF"];?></span></div>
															<div class="clearfix"></div>
														</div>
													<?}*/?>
												<?}else{?>
													<div class="price only_price">
														<?if(strlen($arPrice["PRINT_VALUE"])):?>
															<?=$arPrice["PRINT_VALUE"];?><?if (($arParams["SHOW_MEASURE"]=="Y") && $strMeasure):?><span class="price_measure">/<?=$strMeasure?></span><?endif;?>
														<?endif;?>
													</div>
												<?}?>
											<?}?>
										<?}?>
									<?}?>
								</div>
								<?if($arParams["SHOW_DISCOUNT_TIME"]=="Y"){?>
									<?$arDiscounts = CCatalogDiscount::GetDiscountByProduct( $arItem["ID"], $USER->GetUserGroupArray(), "N", $min_price_id, SITE_ID );
									$arDiscount=array();
									if($arDiscounts)
										$arDiscount=current($arDiscounts);
									if($arDiscount["ACTIVE_TO"]){?>
										<div class="view_sale_block">
											<div class="count_d_block">
												<span class="active_to hidden"><?=$arDiscount["ACTIVE_TO"];?></span>
												<div class="title"><?=GetMessage("UNTIL_AKC");?></div>
												<span class="countdown values"></span>
											</div>
											<div class="quantity_block">
												<div class="title"><?=GetMessage("TITLE_QUANTITY_BLOCK");?></div>
												<div class="values">
													<span class="item">
														<span class="value" <?=((count( $arItem["OFFERS"] ) > 0 && $arParams["TYPE_SKU"] == 'TYPE_1') ? 'style="opacity:0;"' : '')?>><?=$totalCount;?></span>
														<span class="text"><?=GetMessage("TITLE_QUANTITY");?></span>
													</span>
												</div>
											</div>
										</div>
									<?}?>
								<?}?>
							</div>
							<div class="buttons_block">
								<?if($arItem["OFFERS"]){?>
										<?if(!empty($arItem['OFFERS_PROP'])){?>
											<div class="sku_props">
												<div class="bx_catalog_item_scu wrapper_sku" id="<? echo $arItemIDs["ALL_ITEM_IDS"]['PROP_DIV']; ?>">
													<?$arSkuTemplate = array();?>
													<?$arSkuTemplate=COptimus::GetSKUPropsArray($arItem['OFFERS_PROPS_JS'], $arResult["SKU_IBLOCK_ID"], $arParams["DISPLAY_TYPE"], $arParams["OFFER_HIDE_NAME_PROPS"]);?>
													<?foreach ($arSkuTemplate as $code => $strTemplate){
														if (!isset($arItem['OFFERS_PROP'][$code]))
															continue;
														echo '<div>', str_replace('#ITEM#_prop_', $arItemIDs["ALL_ITEM_IDS"]['PROP'], $strTemplate), '</div>';
													}?>
												</div>
												<?$arItemJSParams=COptimus::GetSKUJSParams($arResult, $arParams, $arItem);?>

												<script type="text/javascript">
													var <? echo $arItemIDs["strObName"]; ?> = new JCCatalogSection(<? echo CUtil::PhpToJSObject($arItemJSParams, false, true); ?>);
												</script>
											</div>
										<?}?>
									<?}?>
								<?if(!$arItem["OFFERS"] || ($arItem["OFFERS"] && !$arItem['OFFERS_PROP'])):?>
									<div class="counter_wrapp <?=($arItem["OFFERS"] && $arParams["TYPE_SKU"] == "TYPE_1" ? 'woffers' : '')?>">
										<?if(($arAddToBasketData["OPTIONS"]["USE_PRODUCT_QUANTITY_LIST"] && $arAddToBasketData["ACTION"] == "ADD") && $arItem["CAN_BUY"]):?>
											<div class="counter_block" data-offers="<?=($arItem["OFFERS"] ? "Y" : "N");?>" data-item="<?=$arItem["ID"];?>">
												<span class="minus" id="<? echo $arItemIDs["ALL_ITEM_IDS"]['QUANTITY_DOWN']; ?>">-</span>
												<input type="text" class="text" id="<? echo $arItemIDs["ALL_ITEM_IDS"]['QUANTITY']; ?>" name="<? echo $arParams["PRODUCT_QUANTITY_VARIABLE"]; ?>" value="<?=$arAddToBasketData["MIN_QUANTITY_BUY"]?>" />
												<span class="plus" id="<? echo $arItemIDs["ALL_ITEM_IDS"]['QUANTITY_UP']; ?>" <?=($arAddToBasketData["MAX_QUANTITY_BUY"] ? "data-max='".$arAddToBasketData["MAX_QUANTITY_BUY"]."'" : "")?>>+</span>
											</div>
										<?endif;?>
										<div id="<?=$arItemIDs["ALL_ITEM_IDS"]['BASKET_ACTIONS']; ?>" class="button_block <?=(($arAddToBasketData["ACTION"] == "ORDER"/*&& !$arItem["CAN_BUY"]*/)  || !$arItem["CAN_BUY"] || !$arAddToBasketData["OPTIONS"]["USE_PRODUCT_QUANTITY_LIST"] || $arAddToBasketData["ACTION"] == "SUBSCRIBE" ? "wide" : "");?>">
											<!--noindex-->
												<?=$arAddToBasketData["HTML"]?>
											<!--/noindex-->
										</div>
									</div>
								<?elseif($arItem["OFFERS"]):?>
									<?if(empty($arItem['OFFERS_PROP'])){?>
										<div class="offer_buy_block buys_wrapp woffers">
											<?
											$arItem["OFFERS_MORE"] = "Y";
											$arAddToBasketData = COptimus::GetAddToBasketArray($arItem, $totalCount, $arParams["DEFAULT_COUNT"], $arParams["BASKET_URL"], false, $arItemIDs["ALL_ITEM_IDS"], 'small read_more1', $arParams);?>
											<!--noindex-->
												<?=$arAddToBasketData["HTML"]?>
											<!--/noindex-->
										</div>
									<?}else{?>
										<div class="offer_buy_block buys_wrapp woffers" style="display:none;">
											<div class="counter_wrapp"></div>
										</div>
									<?}?>
								<?endif;?>
							</div>
						</li>
					<?}?>
				</ul>
			</div>
		</div>
	</div>
<?}else{?>
	<script>
		$(document).ready(function(){
			if($('.bx_item_list_you_looked_horizontal').length){
				$('.bx_item_list_you_looked_horizontal').remove();
			}
		})
	</script>
<?}?>

<script>
		$(document).ready(function(){
			var flexsliderItemWidth = 220;
			var flexsliderItemMargin = 12;
			$('.s_<?=$injectId;?> .content_inner').flexslider({
				animation: 'slide',
				selector: '.slides > li',
				slideshow: false,
				animationSpeed: 600,
				directionNav: true,
				controlNav: false,
				pauseOnHover: true,
				animationLoop: true,
				itemWidth: flexsliderItemWidth,
				itemMargin: flexsliderItemMargin,
				//minItems: flexsliderMinItems,
				controlsContainer: '.viewed_navigation',
				start: function(slider){
					slider.find('li').css('opacity', 1);
				}
			});

			var itemsButtons = $('.s_<?=$injectId;?> .wr > li .buttons_block'),
				itemsButtonsHeight = itemsButtons.getMaxHeights();
			$('.s_<?=$injectId;?> .wr .buttons_block').hide();

			var tabsContentUnhover = ($('.s_<?=$injectId;?> .all_wrapp').height() * 1)+20;
			var tabsContentHover = tabsContentUnhover + itemsButtonsHeight+50;

			$('.s_<?=$injectId;?> .slides').equalize({children: '.item-title'});
			$('.s_<?=$injectId;?> .slides').equalize({children: '.item_info'});
			$('.s_<?=$injectId;?> .slides').equalize({children: '.catalog_item'});

			$('.s_<?=$injectId;?> .all_wrapp .content_inner').attr('data-unhover', tabsContentUnhover);
			$('.s_<?=$injectId;?> .all_wrapp .content_inner').attr('data-hover', tabsContentHover);
			$('.s_<?=$injectId;?> .all_wrapp').height(tabsContentUnhover);
			$('.s_<?=$injectId;?> .all_wrapp .content_inner').addClass('absolute');

			$('.s_<?=$injectId;?> .wr > li').hover(
				function(){
					var tabsContentHover = $(this).closest('.content_inner').attr('data-hover') * 1;
					$(this).closest('.content_inner').fadeTo(100, 1);
					$(this).closest('.content_inner').stop().css({'height': tabsContentHover});
					$(this).find('.buttons_block').fadeIn(450, 'easeOutCirc');
				},
				function(){
					var tabsContentUnhoverHover = $(this).closest('.content_inner').attr('data-unhover') * 1;
					$(this).closest('.content_inner').stop().animate({'height': tabsContentUnhoverHover}, 100);
					$(this).find('.buttons_block').stop().fadeOut(233);
				}
			);
		})
	</script>

<script>
	$(document).ready(function(){
		$('.catalog_block .catalog_item_wrapp .catalog_item .item-title').sliceHeight();
		$('.catalog_block .catalog_item_wrapp .catalog_item .cost').sliceHeight();
		$('.catalog_block .catalog_item_wrapp .item_info').sliceHeight({classNull: '.footer_button'});
		$('.catalog_block .catalog_item_wrapp').sliceHeight({classNull: '.footer_button'});
	});

	BX.message({
		QUANTITY_AVAILIABLE: '<? echo COption::GetOptionString("aspro.optimus", "EXPRESSION_FOR_EXISTS", GetMessage("EXPRESSION_FOR_EXISTS_DEFAULT"), SITE_ID); ?>',
		QUANTITY_NOT_AVAILIABLE: '<? echo COption::GetOptionString("aspro.optimus", "EXPRESSION_FOR_NOTEXISTS", GetMessage("EXPRESSION_FOR_NOTEXISTS"), SITE_ID); ?>',
		ADD_ERROR_BASKET: '<? echo GetMessage("ADD_ERROR_BASKET"); ?>',
		ADD_ERROR_COMPARE: '<? echo GetMessage("ADD_ERROR_COMPARE"); ?>',
	})
</script>103  85236|/aspro.optimus/install/wizards/aspro/optimus/site/templates/aspro_optimus/js/main.min.js|16e1d68afunction setLocationSKU(e){var t=parseUrlQuery(),a=0,i="",o="",n="";if("oid"in t&&parseInt(t.oid)>0){t.oid=e;for(var s in t)parseInt(a)>0&&(i="&"),o=o+i+s+"="+t[s],a++;o&&(n=location.pathname+"?"+o);try{return void history.pushState(null,null,n)}catch(r){}location.hash="#"+n.substr(1)}}function clearViewedProduct(){try{var e=arOptimusOptions.SITE_ID,t="OPTIMUS_VIEWED_ITEMS_"+e,a={path:"/",expires:30};"undefined"!=typeof BX.localStorage&&BX.localStorage.set(t,{},0),$.removeCookie(t,a)}catch(i){console.error(i)}}function setViewedProduct(e,t){try{var a=$.cookie.json;$.cookie.json=!0;var i=arOptimusOptions.SITE_ID,o="OPTIMUS_VIEWED_ITEMS_"+i,n={path:"/",expires:30};if("undefined"!=typeof BX.localStorage&&"undefined"!=typeof e&&"undefined"!=typeof t){var s="undefined"!=typeof t.PRODUCT_ID?t.PRODUCT_ID:e,r=BX.localStorage.get(o)?BX.localStorage.get(o):{},l=$.cookie(o)?$.cookie(o):{},d=0;for(var c in r)r[c].IS_LAST=!1,"undefined"==typeof l[c]&&delete r[c];for(var c in l)"undefined"==typeof r[c]&&delete l[c];for(var c in l)d++;"undefined"!=typeof r[s]&&r[s].ID!=e&&(delete r[s],delete l[s]),delete r[2243],delete l[2243];var u=(new Date).getTime();t.ID=e,t.ACTIVE_FROM=u,t.IS_LAST=!0,r[s]=t,l[s]=[u.toString(),t.PICTURE_ID],$.cookie(o,l,n),BX.localStorage.set(o,r,2592e3)}}catch(p){console.error(p)}finally{$.cookie.json=a}}function initSelects(e){var t=navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?!0:!1;if(!t&&!$("#bx-soa-order").length){$(e).find(".wrapper select:visible").ikSelect({syntax:'<div class="ik_select_link"> 						<span class="ik_select_link_text"></span> 						<div class="trigger"></div> 					</div> 					<div class="ik_select_dropdown"> 						<div class="ik_select_list"> 						</div> 					</div>',dynamicWidth:!0,ddMaxHeight:112,customClass:"common_select",onShow:function(e){e.$dropdown.css("top",parseFloat(e.$dropdown.css("top"))-5+"px"),e.$dropdown.outerWidth()<e.$link.outerWidth()&&e.$dropdown.css("width",e.$link.outerWidth()),e.$dropdown.outerWidth()>e.$link.outerWidth()&&e.$dropdown.css("width",e.$link.outerWidth());var t=0,a=0;e.$dropdown.css("left",e.$link.offset().left),$(e.$listInnerUl).find("li").each(function(){$(this).hasClass("ik_select_option_disabled")||(++t,a+=$(this).outerHeight())}),112>a?e.$listInner.css("height","auto"):e.$listInner.css("height","112px"),e.$link.addClass("opened"),e.$listInner.addClass("scroller")},onHide:function(e){e.$link.removeClass("opened")}});var a;$(window).on("resize",function(){clearTimeout(a),a=setTimeout(function(){var e="";(e=$(".common_select-link.opened + select").ikSelect().data("plugin_ikSelect"))&&e.$dropdown.css("left",e.$link.offset().left+"px")},20)})}}function initHoverBlock(e){$(e).find(".catalog_item.item_wrap").on("mouseenter",function(){$(this).addClass("hover")}),$(e).find(".catalog_item.item_wrap").on("mouseleave",function(){$(this).removeClass("hover")})}function setStatusButton(){$.ajax({url:arOptimusOptions.SITE_DIR+"ajax/getAjaxBasket.php",type:"POST",success:function(e){if(e.BASKET)for(var t in e.BASKET)$(".to-cart[data-item="+e.BASKET[t]+"]").hide(),$(".counter_block[data-item="+e.BASKET[t]+"]").hide(),$(".in-cart[data-item="+e.BASKET[t]+"]").show(),$(".in-cart[data-item="+e.BASKET[t]+"]").closest(".button_block").addClass("wide");if(e.DELAY)for(var t in e.DELAY)$(".wish_item.to[data-item="+e.DELAY[t]+"]").hide(),$(".wish_item.in[data-item="+e.DELAY[t]+"]").show(),$(".wish_item[data-item="+e.DELAY[t]+"]").find(".value.added").length&&($(".wish_item[data-item="+e.DELAY[t]+"]").addClass("added"),$(".wish_item[data-item="+e.DELAY[t]+"]").find(".value").hide(),$(".wish_item[data-item="+e.DELAY[t]+"]").find(".value.added").show());if(e.SUBSCRIBE)for(var t in e.SUBSCRIBE)$(".to-subscribe[data-item="+e.SUBSCRIBE[t]+"]").hide(),$(".in-subscribe[data-item="+e.SUBSCRIBE[t]+"]").show();if(e.COMPARE)for(var t in e.COMPARE)$(".compare_item.to[data-item="+e.COMPARE[t]+"]").hide(),$(".compare_item.in[data-item="+e.COMPARE[t]+"]").show(),$(".compare_item[data-item="+e.COMPARE[t]+"]").find(".value.added").length&&($(".compare_item[data-item="+e.COMPARE[t]+"]").find(".value").hide(),$(".compare_item[data-item="+e.COMPARE[t]+"]").find(".value.added").show())}})}function scroll_block(e){var t=e.offset().top;$("header").outerHeight(!0,!0);if($(".stores_tab").length)$(".stores_tab").addClass("current").siblings().removeClass("current");else if($(".prices_tab").addClass("current").siblings().removeClass("current"),$(".prices_tab .opener").length&&!$(".prices_tab .opener .opened").length){var a=$(".prices_tab .opener").first();a.find(".opener_icon").addClass("opened"),a.parents("tr").addClass("nb"),a.parents("tr").next(".offer_stores").find(".stores_block_wrap").slideDown(200)}$("html,body").animate({scrollTop:t-30},150)}function replaceBasketPopup(e){"undefined"!=typeof e&&(e.w.hide(),e.o.hide())}function waitLayer(e,t){"undefined"!=typeof dataLayer?"function"==typeof t&&t():setTimeout(function(){waitLayer(e,t)},e)}function checkCounters(e){return"undefined"!=typeof e?"google"==e&&"Y"==arOptimusOptions.COUNTERS.GOOGLE_ECOMERCE&&arOptimusOptions.COUNTERS.GOOGLE_COUNTER>0?!0:"yandex"==e&&"Y"==arOptimusOptions.COUNTERS.USE_YA_COUNTER&&"Y"==arOptimusOptions.COUNTERS.YANDEX_ECOMERCE&&arOptimusOptions.COUNTERS.YANDEX_COUNTER>0?!0:!1:"Y"==arOptimusOptions.COUNTERS.USE_YA_COUNTER&&"Y"==arOptimusOptions.COUNTERS.YANDEX_ECOMERCE&&arOptimusOptions.COUNTERS.YANDEX_COUNTER>0||"Y"==arOptimusOptions.COUNTERS.GOOGLE_ECOMERCE&&arOptimusOptions.COUNTERS.GOOGLE_COUNTER>0?!0:!1}function addBasketCounter(e){if("N"!==arOptimusOptions.COUNTERS.USE_BASKET_GOALS){var t={goal:"goal_basket_add",params:{id:e}};BX.onCustomEvent("onCounterGoals",[t])}checkCounters()&&$.ajax({url:arOptimusOptions.SITE_DIR+"ajax/goals.php",dataType:"json",type:"POST",data:{ID:e},success:function(e){e&&e.ID&&waitLayer(100,function(){dataLayer.push({event:arOptimusOptions.COUNTERS.GOOGLE_EVENTS.ADD2BASKET,ecommerce:{currencyCode:e.CURRENCY,add:{products:[{id:e.ID,name:e.NAME,price:e.PRICE,brand:e.BRAND,category:e.CATEGORY,quantity:e.QUANTITY}]}}})})}})}function purchaseCounter(e,t,a){checkCounters()?$.ajax({url:arOptimusOptions.SITE_DIR+"ajax/goals.php",dataType:"json",type:"POST",data:{ORDER_ID:e,TYPE:t},success:function(e){var i=[];if(e.ITEMS)for(var o in e.ITEMS)i.push({id:e.ITEMS[o].ID,sku:e.ITEMS[o].ID,name:e.ITEMS[o].NAME,price:e.ITEMS[o].PRICE,brand:e.ITEMS[o].BRAND,category:e.ITEMS[o].CATEGORY,quantity:e.ITEMS[o].QUANTITY});e.ID?waitLayer(100,function(){dataLayer.push({ecommerce:d={purchase:{actionField:{id:e.ACCOUNT_NUMBER,shipping:e.PRICE_DELIVERY,tax:e.TAX_VALUE,list:t,revenue:e.PRICE},products:i}}}),"undefined"!=typeof a&&a(d)}):"undefined"!=typeof a&&a(!1)},error:function(){"undefined"!=typeof a&&a(!1)}}):"undefined"!=typeof a&&a(!1)}function viewItemCounter(e,t){checkCounters()&&$.ajax({url:arOptimusOptions.SITE_DIR+"ajax/goals.php",dataType:"json",type:"POST",data:{PRODUCT_ID:e,PRICE_ID:t},success:function(e){e.ID&&waitLayer(100,function(){dataLayer.push({ecommerce:{detail:{products:[{id:e.ID,name:e.NAME,price:e.PRICE,brand:e.BRAND,category:e.CATEGORY}]}}})})}})}function checkoutCounter(e,t,a){checkCounters("google")&&$.ajax({url:arOptimusOptions.SITE_DIR+"ajax/goals.php",dataType:"json",type:"POST",data:{BASKET:"Y"},success:function(a){var i=[];if(a.ITEMS)for(var o in a.ITEMS)i.push({id:a.ITEMS[o].ID,name:a.ITEMS[o].NAME,price:a.ITEMS[o].PRICE,brand:a.ITEMS[o].BRAND,category:a.ITEMS[o].CATEGORY,quantity:a.ITEMS[o].QUANTITY});i&&waitLayer(100,function(){dataLayer.push({event:arOptimusOptions.COUNTERS.GOOGLE_EVENTS.CHECKOUT_ORDER,ecommerce:{actionField:{step:e,option:t},products:i}})})}})}function delFromBasketCounter(e,t){checkCounters()&&$.ajax({url:arOptimusOptions.SITE_DIR+"ajax/goals.php",dataType:"json",type:"POST",data:{ID:e},success:function(e){e.ID&&waitLayer(100,function(){dataLayer.push({event:arOptimusOptions.COUNTERS.GOOGLE_EVENTS.REMOVE_BASKET,ecommerce:{remove:{products:[{id:e.ID,name:e.NAME,category:e.CATEGORY}]}}}),"function"==typeof t&&t()})}})}function setHeightCompany(){$(".md-50.img").height($(".md-50.big").outerHeight()-35)}function initSly(){var e=$(document).find(".frame"),t=(e.children("ul").eq(0),e.parent());arOptimusOptions.PAGES.CATALOG_PAGE&&(e.sly({horizontal:1,itemNav:"basic",smart:1,mouseDragging:0,touchDragging:0,releaseSwing:0,startAt:0,scrollBar:t.find(".scrollbar"),scrollBy:1,speed:300,elasticBounds:0,easing:"swing",dragHandle:1,dynamicHandle:1,clickBar:1,forward:t.find(".forward"),backward:t.find(".backward")}),e.sly("reload"))}function createTableCompare(e,t,a){try{var i=e.clone().removeAttr("id").addClass("clone");a.length?(a.remove(),t.html(""),t.html(i)):t.append(i)}catch(o){}finally{}}function isRealValue(e){return e&&"null"!==e&&"undefined"!==e}function rightScroll(e,t){var a=BX("prop_"+e+"_"+t);if(a){var i=parseInt(a.style.marginLeft);i>=0&&(a.style.marginLeft=i-20+"%")}}function leftScroll(e,t){var a=BX("prop_"+e+"_"+t);if(a){var i=parseInt(a.style.marginLeft);0>i&&(a.style.marginLeft=i+20+"%")}}function touchMenu(e){$(window).outerWidth()>600?$(e).each(function(){var e=$(this);e.on("touchend",function(t){e.find(".child").length&&!e.hasClass("hover")&&(t.preventDefault(),t.stopPropagation(),e.siblings().removeClass("hover"),e.addClass("hover"),$(".menu .child").css({display:"none"}),e.find(".child").css({display:"block"}))})}):$(e).off()}function touchItemBlock(e){$(e).each(function(){var e=$(this),t=e.closest(".catalog_item");e.on("touchend",function(a){if(!t.hasClass("hover")){a.preventDefault(),a.stopPropagation(),t.siblings().removeClass("hover"),t.siblings().blur(),t.closest(".catalog_block").find(".catalog_item").removeClass("hover"),t.addClass("hover"),t.addClass("touch");var i=1*e.closest(".tab").attr("data-hover"),o=1*e.closest(".tab").attr("data-unhover");e.closest(".tab").stop().animate({height:o},100),e.closest(".catalog_item").siblings().find(".buttons_block").stop().fadeOut(233),e.closest(".tab").fadeTo(100,1),e.closest(".tab").stop().css({height:i}),e.closest(".catalog_item").find(".buttons_block").fadeIn(450,"easeOutCirc")}})})}function touchBasket(e){"N"!==arOptimusOptions.THEME.SHOW_BASKET_ONADDTOCART&&($(window).outerWidth()>600?$(document).find(e).on("touchend",function(e){$(this).parent().find(".basket_popup_wrapp").length&&!$(this).hasClass("hover")&&(e.preventDefault(),e.stopPropagation(),$(this).addClass("hover"),$(this).parent().find(".basket_popup_wrapp").slideDown())}):$(e).off())}function initFull(){initSelects(document),initHoverBlock(document),touchItemBlock(".catalog_item a"),InitOrderCustom(),$("html.print").length?window.print():checkStickyFooter(),basketActions(),orderActions()}var basketTimeoutSlide,resizeEventTimer,funcDefined=function(e){try{return"function"==typeof e?!0:"function"==typeof window[e]}catch(t){return!1}};if(!funcDefined("setLocationSKU"),!funcDefined("trimPrice"))var trimPrice=function(e){return e=e.split(" ").join(""),e=e.split("&nbsp;").join("")};if(!funcDefined("markProductRemoveBasket"))var markProductRemoveBasket=function(e){$(".in-cart[data-item="+e+"]").hide(),$(".to-cart[data-item="+e+"]").show(),$(".to-cart[data-item="+e+"]").closest(".button_block").removeClass("wide"),$(".to-cart[data-item="+e+"]").closest(".counter_wrapp").find(".counter_block").show(),$(".counter_block[data-item="+e+"]").show(),$(".in-subscribe[data-item="+e+"]").hide(),$(".to-subscribe[data-item="+e+"]").show(),$(".wish_item[data-item="+e+"]").removeClass("added"),$(".wish_item[data-item="+e+"] .value:not(.added)").show(),$(".wish_item[data-item="+e+"] .value.added").hide()};if(!funcDefined("markProductAddBasket"))var markProductAddBasket=function(e){$(".to-cart[data-item="+e+"]").hide(),$(".to-cart[data-item="+e+"]").closest(".counter_wrapp").find(".counter_block").hide(),$(".to-cart[data-item="+e+"]").closest(".button_block").addClass("wide"),$(".in-cart[data-item="+e+"]").show(),$(".wish_item[data-item="+e+"]").removeClass("added"),$(".wish_item[data-item="+e+"] .value:not(.added)").show(),$(".wish_item[data-item="+e+"] .value.added").hide()};if(!funcDefined("markProductDelay"))var markProductDelay=function(e){$(".in-cart[data-item="+e+"]").hide(),$(".to-cart[data-item="+e+"]").show(),$(".to-cart[data-item="+e+"]").closest(".counter_wrapp").find(".counter_block").show(),$(".to-cart[data-item="+e+"]").closest(".button_block").removeClass("wide"),$(".wish_item[data-item="+e+"]").addClass("added"),$(".wish_item[data-item="+e+"] .value:not(.added)").hide(),$(".wish_item[data-item="+e+"] .value.added").css("display","block")};if(!funcDefined("markProductSubscribe"))var markProductSubscribe=function(e){$(".to-subscribe[data-item="+e+"]").hide(),$(".in-subscribe[data-item="+e+"]").css("display","block")};if(!funcDefined("basketFly"))var basketFly=function(e){$.post(arOptimusOptions.SITE_DIR+"ajax/basket_fly.php","PARAMS="+$("#basket_form").find("input#fly_basket_params").val(),$.proxy(function(t){var a=$(".opener .basket_count").hasClass("small");$(t).find(".basket_count").find(".items div").text();$("#basket_line .basket_fly").addClass("loaded").html(t),"refresh"==e&&$("li[data-type=AnDelCanBuy]").trigger("click"),window.matchMedia("(min-width: 769px)").matches&&("open"==e?a?"N"!==arOptimusOptions.THEME.SHOW_BASKET_ONADDTOCART&&$(".opener .basket_count").click():($(".opener .basket_count").removeClass("small"),$('.tabs_content.basket li[item-section="AnDelCanBuy"]').addClass("cur"),$('#basket_line ul.tabs li[item-section="AnDelCanBuy"]').addClass("cur")):"wish"==e?a?"N"!==arOptimusOptions.THEME.SHOW_BASKET_ONADDTOCART&&$(".opener .wish_count").click():($(".opener .wish_count").removeClass("small"),$('.tabs_content.basket li[item-section="DelDelCanBuy"]').addClass("cur"),$('#basket_line ul.tabs li[item-section="DelDelCanBuy"]').addClass("cur")):"N"!==arOptimusOptions.THEME.SHOW_BASKET_ONADDTOCART&&$(".opener .basket_count").click())}))};if(!funcDefined("clearViewedProduct"),!funcDefined("setViewedProduct"),!funcDefined("initSelects"),funcDefined("CheckTopMenuFullCatalogSubmenu")||(CheckTopMenuFullCatalogSubmenu=function(){var e=$(".menu_top_block"),t=e.parents(".wrap_menu"),a=t.actual("outerWidth"),i=t.offset().left,o=i+a,n=e.hasClass("catalogfirst"),s=$(".menu_top_block:visible li.full"),r=e.actual("outerWidth");$(".catalog_block.menu_top_block").length&&$(".catalog_block.menu_top_block").is(":visible")&&(s=$(".menu_top_block.catalog_block li.full")),s.each(function(){var e=$(this),t=e.find(">.dropdown");t.length&&(n?t.css({left:r+"px",width:a-r+"px","padding-left":"0px","padding-right":"0px"}):t.css({left:-1*e.offset().left+"px",width:$(window).width()-1+"px","padding-left":i+"px","padding-right":$(window).width()-o+"px"}),!isOnceInited&&n&&"top"==arOptimusOptions.THEME.MENU_POSITION&&e.on("mouseenter",function(){t.css("min-height",e.closest(".dropdown").actual("outerHeight")+"px")}))})}),$.fn.getMaxHeights=function(e,t,a){for(var i=this.map(function(t,a){var i=0;return $(a).css("height",""),i=1==e?$(a).actual("outerHeight"):$(a).actual("height")}).get(),o=0,n=i.length;n>o;++o)i[o]%2&&--i[o];return Math.max.apply(this,i)},$.fn.equalizeHeights=function(e,t,a){for(var i=this.map(function(i,o){var n=0,s=0;return t!==!1&&(n=parseInt($(o).find(t).actual("outerHeight"))),n&&(n+=12),$(o).css("height",""),s=1==e?$(o).actual("outerHeight")-n:$(o).actual("height")-n,a!==!1&&(a>s&&(s+=a-s),window.matchMedia("(max-width: 520px)").matches&&(s=300),window.matchMedia("(max-width: 400px)").matches&&(s=200)),s}).get(),o=0,n=i.length;n>o;++o)i[o]%2&&--i[o];return this.height(Math.max.apply(this,i))},$.fn.getFloatWidth=function(){var e=0;if($(this).length){var t=$(this)[0].getBoundingClientRect();(e=t.width)||(e=t.right-t.left)}return e},$.fn.sliceHeight=function(e){function t(t){if(t.each(function(){$(this).css("line-height",""),$(this).css("height","")}),"undefined"==typeof e.autoslicecount||e.autoslicecount!==!1){var a="undefined"!=typeof e.row&&e.row.length?t.first().parents(e.row).getFloatWidth():t.first().parents(".items").getFloatWidth(),i="undefined"!=typeof e.item&&e.item.length?$(e.item).first().getFloatWidth():t.first().hasClass("item")?t.first().getFloatWidth():t.first().parents(".item").getFloatWidth();a||(a=t.first().parents(".row").getFloatWidth()),a&&i&&(e.slice=Math.floor(a/i))}if(e.slice)for(var o=0;o<t.length;o+=e.slice)$(t.slice(o,o+e.slice)).equalizeHeights(e.outer,e.classNull,e.minHeight);if(e.lineheight){var n=parseInt(e.lineheight);isNaN(n)&&(n=0),t.each(function(){$(this).css("line-height",$(this).actual("height")+n+"px")})}}var e=$.extend({slice:null,outer:!1,lineheight:!1,autoslicecount:!0,classNull:!1,minHeight:!1,options:!1,resize:!0,row:!1,item:!1},e),a=$(this);t(a),e.resize&&BX.addCustomEvent("onWindowResize",function(e){ignoreResize.push(!0),t(a),ignoreResize.pop()})},$.fn.sliceHeightNoResize=function(e){function t(t){if(t.each(function(){$(this).css("line-height",""),$(this).css("height","")}),"undefined"==typeof e.autoslicecount||e.autoslicecount!==!1){var a=t.first().hasClass("item")?t.first().getFloatWidth():t.first().parents(".item").getFloatWidth(),i=t.first().parents(".items").getFloatWidth();i||(i=t.first().parents(".row").getFloatWidth()),i&&a&&(e.slice=Math.floor(i/a))}if(e.slice)for(var o=0;o<t.length;o+=e.slice)$(t.slice(o,o+e.slice)).equalizeHeights(e.outer,e.classNull,e.minHeight);if(e.lineheight){var n=parseInt(e.lineheight);isNaN(n)&&(n=0),t.each(function(){$(this).css("line-height",$(this).actual("height")+n+"px")})}}var e=$.extend({slice:null,outer:!1,lineheight:!1,autoslicecount:!0,classNull:!1,minHeight:!1,options:!1,resize:!0},e),a=$(this);t(a)},!funcDefined("initHoverBlock"),!funcDefined("setStatusButton"),!funcDefined("onLoadjqm"))var onLoadjqm=function(e,t,a,i,o,n,s){t.w.addClass("show").css({"margin-left":$(window).width()>t.w.outerWidth()?"-"+t.w.outerWidth()/2+"px":"-"+$(window).width()/2+"px",top:$(document).scrollTop()+($(window).height()>t.w.outerHeight()?($(window).height()-t.w.outerHeight())/2:10)+"px",opacity:1}),"undefined"==typeof a&&(a=""),"undefined"==typeof i&&(i=!1);var r=$("."+e+"_frame").width();$("."+e+"_frame").css("margin-left","-"+r/2+"px"),"order-popup-call"==e||("order-button"==e?$(".order-button_frame").find("div[product_name]").find("input").val(t.t.title).attr("readonly","readonly").css({overflow:"hidden","text-overflow":"ellipsis"}):"to-order"==e&&i?($(".to-order_frame").find('[data-sid="PRODUCT_NAME"]').val($(i).data("name")).attr("readonly","readonly").css({overflow:"hidden","text-overflow":"ellipsis"}),$(".to-order_frame").find('[data-sid="PRODUCT_ID"]').val($(i).attr("data-item"))):"services"==e&&i?$(".services_frame").find('[data-sid="SERVICE"]').val($(i).attr("data-title")):"resume"==e&&i?$(i).attr("data-jobs")&&$(".resume_frame").find('[data-sid="POST"]').attr("readonly","readonly").val($(i).attr("data-jobs")):"basket_error"==e?($(".basket_error_frame .pop-up-title").text(o),$(".basket_error_frame .ajax_text").html(a),initSelects(document),"Y"==n&&s&&$("<div class='popup_button_basket_wr'><span class='popup_button_basket big_btn button' data-item="+s.data("item")+"><span>"+BX.message("ERROR_BASKET_BUTTON")+"</span></span></div>").insertAfter($(".basket_error_frame .ajax_text"))):"one_click_buy"==e?($("#one_click_buy_form_button").on("click",function(){console.log("click"),$(this).hasClass("clicked")||$("#one_click_buy_form").valid()&&($(this).addClass("clicked"),$("#one_click_buy_form").submit())}),$("#one_click_buy_form").submit(function(){if($("#one_click_buy_form").valid()){if($("."+e+"_frame form input.error").length||$("."+e+"_frame form textarea.error").length)return!1;$.ajax({url:$(this).attr("action"),data:$(this).serialize(),type:"POST",dataType:"json",error:function(e){alert("Error connecting server")},success:function(e){if("Y"==e.result){if("N"!==arOptimusOptions.COUNTERS.USE_1CLICK_GOALS){var t={goal:"goal_1click_success"};BX.onCustomEvent("onCounterGoals",[t])}$(".one_click_buy_result").show(),$(".one_click_buy_result_success").show(),purchaseCounter(e.message,arOptimusOptions.COUNTERS.TYPE.ONE_CLICK)}else $(".one_click_buy_result").show(),$(".one_click_buy_result_fail").show(),"err"in e&&e.err&&(e.message=e.message+" \n"+e.err),$(".one_click_buy_result_text").html(e.message);$(".one_click_buy_modules_button",self).removeClass("disabled"),$("#one_click_buy_form").hide(),$("#one_click_buy_form_result").show()}})}return!1})):"one_click_buy_basket"==e&&($("#one_click_buy_form_button").on("click",function(){$(this).hasClass("clicked")||$("#one_click_buy_form").valid()&&($(this).addClass("clicked"),$("#one_click_buy_form").submit())}),$("#one_click_buy_form").on("submit",function(){if($("#one_click_buy_form").valid()){if($("."+e+"_frame form input.error").length||$("."+e+"_frame form textarea.error").length)return!1;$.ajax({url:$(this).attr("action"),data:$(this).serialize(),type:"POST",dataType:"json",error:function(e){window.console&&console.log(e)},success:function(e){if("Y"==e.result){if("N"!==arOptimusOptions.COUNTERS.USE_FASTORDER_GOALS){var t={goal:"goal_fastorder_success"};BX.onCustomEvent("onCounterGoals",[t])}$(".one_click_buy_result").show(),$(".one_click_buy_result_success").show(),purchaseCounter(e.message,arOptimusOptions.COUNTERS.TYPE.QUICK_ORDER)}else $(".one_click_buy_result").show(),$(".one_click_buy_result_fail").show(),"err"in e&&e.err&&(e.message=e.message+" \n"+e.err),$(".one_click_buy_result_text").text(e.message);$(".one_click_buy_modules_button",self).removeClass("disabled"),$("#one_click_buy_form").hide(),$("#one_click_buy_form_result").show()}})}return!1}))),$("."+e+"_frame").show()};if(!funcDefined("onHidejqm"))var onHidejqm=function(e,t){t.w.find(".one_click_buy_result_success").is(":visible")&&"one_click_buy_basket"==e&&(window.location.href=window.location.href),t.w.css("opacity",0).hide(),t.w.empty(),t.o.remove(),t.w.removeClass("show")};if(!funcDefined("oneClickBuy"))var oneClickBuy=function(e,t,a){var i="one_click_buy",o=1,n=!1,s=$(a).closest(".buy_block").find(".to-cart"),r=$(a).closest("tr").find(".to-cart");"undefined"!=typeof a&&(o=$(a).attr("data-quantity"),n=$(a).attr("data-props")),0>o&&(o=1);var l=s.data("props"),d=r.data("props"),c="",u="",p="N",f={},m=s.data("iblockid"),_=s.attr("data-item");l?c=l.split(";"):d&&(c=d.split(";")),s.data("part_props")&&(u=s.data("part_props")),s.data("add_props")&&(p=s.data("add_props")),f=fillBasketPropsExt(s,"prop",s.data("bakset_div")),f.iblockID=m,f.part_props=u,f.add_props=p,f.props=JSON.stringify(c),f.item=_,f.ocb_item="Y",$("body").find("."+i+"_frame").remove(),$("body").find("."+i+"_trigger").remove(),$("body").append('<div class="'+i+'_frame popup"></div>'),$("body").append('<div class="'+i+'_trigger"></div>'),$("."+i+"_frame").jqm({trigger:"."+i+"_trigger",onHide:function(e){onHidejqm(i,e)},toTop:!1,onLoad:function(e){onLoadjqm(i,e)},ajax:arOptimusOptions.SITE_DIR+"ajax/one_click_buy.php?ELEMENT_ID="+e+"&IBLOCK_ID="+t+"&ELEMENT_QUANTITY="+o+"&OFFER_PROPS="+f.props}),$("."+i+"_trigger").click()};if(!funcDefined("oneClickBuyBasket"))var oneClickBuyBasket=function(){name="one_click_buy_basket",$("body").find("."+name+"_frame").remove(),$("body").find("."+name+"_trigger").remove(),$("body").append('<div class="'+name+'_frame popup"></div>'),$("body").append('<div class="'+name+'_trigger"></div>'),$("."+name+"_frame").jqm({trigger:"."+name+"_trigger",onHide:function(e){onHidejqm(name,e)},onLoad:function(e){onLoadjqm(name,e)},ajax:arOptimusOptions.SITE_DIR+"ajax/one_click_buy_basket.php"}),$("."+name+"_trigger").click()};if(!funcDefined("scroll_block"),!funcDefined("jqmEd"))var jqmEd=function(e,t,a,i,o,n,s,r){return"undefined"==typeof i&&(i=""),"undefined"==typeof o&&(o=!1),$("body").find("."+e+"_frame").remove(),$("body").append('<div class="'+e+'_frame popup"></div>'),"undefined"==typeof a?$("."+e+"_frame").jqm({trigger:"."+e+"_frame.popup",onHide:function(t){onHidejqm(e,t)},onLoad:function(t){onLoadjqm(e,t,i,o)},ajax:arOptimusOptions.SITE_DIR+"ajax/form.php?form_id="+t+(i.length?"&"+i:"")}):("enter"==e?$("."+e+"_frame").jqm({trigger:a,onHide:function(t){onHidejqm(e,t)},onLoad:function(t){onLoadjqm(e,t,i,o)},ajax:arOptimusOptions.SITE_DIR+"ajax/auth.php"}):"basket_error"==e?$("."+e+"_frame").jqm({trigger:a,onHide:function(t){onHidejqm(e,t)},onLoad:function(t){onLoadjqm(e,t,i,o,n,s,r)},ajax:arOptimusOptions.SITE_DIR+"ajax/basket_error.php"}):$("."+e+"_frame").jqm({trigger:a,onHide:function(t){onHidejqm(e,t)},onLoad:function(t){onLoadjqm(e,t,i,o)},ajax:arOptimusOptions.SITE_DIR+"ajax/form.php?form_id="+t+(i.length?"&"+i:"")}),$(a).dblclick(function(){return!1})),!0};if(!funcDefined("replaceBasketPopup"),!funcDefined("waitLayer"),funcDefined("waitCounter")||(waitCounter=function(e,t,a){var i=window["yaCounter"+e];"object"==typeof i?"function"==typeof a&&a():setTimeout(function(){waitCounter(e,t,a)},t)}),funcDefined("InitTopestMenuGummi")||(InitTopestMenuGummi=function(){function e(){var e=a.find(">li:not(.more)"),t=e.length;if(t)for(var i=0,o=0;t>o;++o){var r=e.eq(o),l=r.actual("outerWidth",{includeMargin:!0});s[o]=(i+=l)+(o!==t-1?n:0)}}function t(){var e=a.actual("innerWidth"),t=a.find(">li:not(.more),li.more>.dropdown>li"),n=t.length;if(n){for(var r=!1,l=n-1;l>=0;--l){var d=t.eq(l),c=d.parents(".more").length>0;if(!c&&s[l]>e){r||(r=!0,i.removeClass("hidden"));var u=d.clone();u.find(">a").addClass("dark_font"),u.prependTo(o),d.addClass("cloned")}}for(var l=0;n>l;++l){var d=t.eq(l),c=d.parents(".more").length>0;if(c&&s[l]<=e){l===n-1&&(r=!1,i.addClass("hidden"));var u=d.clone();u.find(">a").removeClass("dark_font"),u.insertBefore(i),d.addClass("cloned")}}a.find("li.cloned").remove()}}if(!isOnceInited){var a=$(".menu.topest"),i=a.find(">.more"),o=i.find(">.dropdown"),n=i.actual("outerWidth",{includeMargin:!0}),s=[];ignoreResize.push(!0),e(),t(),ignoreResize.pop(),$(window).resize(function(){ignoreResize.push(!0),t(),ignoreResize.pop()})}}),funcDefined("InitTopMenuGummi")||(InitTopMenuGummi=function(){function e(){var e=a.closest(".wrap_menu").find(".inc_menu .menu_top_block >li:not(.more)"),t=e.length;if(t)for(var i=0,o=0;t>o;++o){var n=e.eq(o),l=n.actual("outerWidth");r[o]=(i+=l)+(o!==t-1?s:0)}}function t(){var e=i.actual("innerWidth")-o.actual("innerWidth"),t=a.find(">li:not(.more):not(.catalog),li.more>.dropdown>li"),s=t.length;if(s){for(var d=!1,u=s-1;u>=0;--u){var p=t.eq(u),f=p.parents(".more").length>0;if(!f&&r[u]>e){d||(d=!0,n.removeClass("hidden"));var m=p.clone();m.find(">.dropdown").removeAttr("style").removeClass("toleft"),m.find(">a").addClass("dark_font").removeAttr("style"),m.prependTo(l),p.addClass("cloned")}}for(var u=0;s>u;++u){var p=t.eq(u),f=p.parents(".more").length>0;if(f&&r[u]<=e){u===s-1&&(d=!1,n.addClass("hidden"));var m=p.clone();m.find(">a").removeClass("dark_font"),m.insertBefore(n),p.addClass("cloned")}}a.find("li.cloned").remove();var _=a.find(">li:not(.more):not(.catalog)").length,h=e-r[_-1],b=Math.floor(h/(_+(n.hasClass("hidden")?0:1))),k=c+b,v=Math.floor(k/2),g=k-v;a.find(">li:not(.catalog):visible>a").each(function(){$(this).css({"padding-left":v+"px"}),$(this).css({"padding-right":g+"px"})});var w=k+h-(_+(n.is(":visible")?1:0))*b,C=Math.floor(w/2),E=w-C;a.find(">li:visible").last().find(">a").css({"padding-left":C+"px"}),a.find(">li:visible").last().find(">a").css({"padding-right":E+"px"}),CheckTopMenuFullCatalogSubmenu()}}var a=$(".menu_top_block"),i=a.parents(".wrap_menu"),o=i.find(".catalog_menu_ext"),n=a.find(">.more"),s=n.actual("outerWidth",{includeMargin:!0});n.addClass("hidden");var r=[],l=n.find(">.dropdown"),d=2*parseInt(n.find(">a").css("padding-left")),c=d;ignoreResize.push(!0),e(),t(),ignoreResize.pop(),$(window).resize(function(){ignoreResize.push(!0),t(),ignoreResize.pop()})}),!funcDefined("checkCounters"),!funcDefined("addBasketCounter"),!funcDefined("purchaseCounter"),!funcDefined("viewItemCounter"),!funcDefined("checkoutCounter"),!funcDefined("delFromBasketCounter"),!funcDefined("setHeightCompany"),!funcDefined("initSly"),!funcDefined("createTableCompare"),funcDefined("fillBasketPropsExt")||(fillBasketPropsExt=function(e,t,a){var i=0,o=null,n=!1,s={},r=null;if(r=BX(a)){if(o=r.getElementsByTagName("select"),o&&o.length)for(i=0;i<o.length;i++)if(!o[i].disabled)switch(o[i].type.toLowerCase()){case"select-one":s[o[i].name]=o[i].value,n=!0}if(o=r.getElementsByTagName("input"),o&&o.length)for(i=0;i<o.length;i++)if(!o[i].disabled)switch(o[i].type.toLowerCase()){case"hidden":s[o[i].name]=o[i].value,n=!0;break;case"radio":o[i].checked&&(s[o[i].name]=o[i].value,n=!0)}}return n||(s[t]=[],s[t][0]=0),s}),funcDefined("showBasketError")||(showBasketError=function(e,t,a,i){var o=t?t:BX.message("ERROR_BASKET_TITLE"),n="N",s="";void 0!==typeof a&&(n="Y"),void 0!==typeof i&&(s=i),$("body").append("<span class='add-error-bakset' style='display:none;'></span>"),jqmEd("basket_error","error-bakset",".add-error-bakset",e,this,o,n,s),$("body .add-error-bakset").click(),$("body .add-error-bakset").remove()}),!funcDefined("isRealValue"),!funcDefined("rightScroll"),!funcDefined("leftScroll"),funcDefined("InitOrderCustom")||(InitOrderCustom=function(){$(".ps_logo img").wrap('<div class="image"></div>'),$("#bx-soa-order .radio-inline").each(function(){"checked"==$(this).find("input").attr("checked")&&$(this).addClass("checked")}),$("#bx-soa-order .checkbox input[type=checkbox]").each(function(){"checked"==$(this).attr("checked")&&$(this).parent().addClass("checked")}),$("#bx-soa-order .bx-authform-starrequired").each(function(){var e=$(this).html();$(this).closest("label").append('<span class="bx-authform-starrequired"> '+e+"</span>"),$(this).detach()}),$(".bx_ordercart_coupon").each(function(){$(this).find(".bad").length?$(this).addClass("bad"):$(this).find(".good").length&&$(this).addClass("good")})}),funcDefined("InitLabelAnimation")||(InitLabelAnimation=function(e){$(e).length&&($(e).find(".form-group").each(function(){$(this).find("input[type=text], textarea").length&&!$(this).find(".dropdown-block").length&&""!=$(this).find("input[type=text], textarea").val()&&$(this).addClass("value_y")}),$(document).on("click",e+" .form-group:not(.bx-soa-pp-field) label",function(){$(this).parent().find("input, textarea").focus()}),$(document).on("focusout",e+" .form-group:not(.bx-soa-pp-field) input, "+e+" .form-group:not(.bx-soa-pp-field) textarea",function(){var e=$(this).val();""==e||$(this).closest(".form-group").find(".dropdown-block").length||$(this).closest(".form-group").find("#profile_change").length?$(this).closest(".form-group").removeClass("value_y"):$(this).closest(".form-group").addClass("value_y")}),$(document).on("focus",e+" .form-group:not(.bx-soa-pp-field) input, "+e+" .form-group:not(.bx-soa-pp-field) textarea",function(){$(this).closest(".form-group").find(".dropdown-block").length||$(this).closest(".form-group").find("#profile_change").length||$(this).closest(".form-group").find("[name=PERSON_TYPE_OLD]").length||$(this).closest(".form-group").addClass("value_y")}))}),checkPopupWidth=function(){$(".popup.show").each(function(){var e=$(this).actual("width");$(this).css({"margin-left":$(window).width()>e?"-"+e/2+"px":"-"+$(window).width()/2+"px"})})},checkCaptchaWidth=function(){$(".captcha-row").each(function(){var e=$(this).actual("width");$(this).hasClass("b")?e>320&&$(this).removeClass("b"):320>=e&&$(this).addClass("b")})},checkFormWidth=function(){$(".form .form_left").each(function(){var e=$(this).parents(".form"),t=e.actual("width");e.hasClass("b")?t>417&&e.removeClass("b"):417>=t&&e.addClass("b")})},checkFormControlWidth=function(){$(".form-control").each(function(){var e=$(this).actual("width"),t=$(this).find("label:not(.error) > span").actual("width"),a=$(this).find("label.error").actual("width");a>0?$(this).hasClass("h")?e>t+a+5&&$(this).removeClass("h"):t+a+5>=e&&$(this).addClass("h"):$(this).removeClass("h")})},scrollToTop=function(){if("NONE"!==arOptimusOptions.THEME.SCROLLTOTOP_TYPE){var e=!1;$("body").append($("<a />").addClass("scroll-to-top "+arOptimusOptions.THEME.SCROLLTOTOP_TYPE+" "+arOptimusOptions.THEME.SCROLLTOTOP_POSITION).attr({
href:"#",id:"scrollToTop"})),$("#scrollToTop").click(function(e){return e.preventDefault(),$("body, html").animate({scrollTop:0},500),!1}),$(window).scroll(function(){e||(e=!0,$(window).scrollTop()>150?($("#scrollToTop").stop(!0,!0).addClass("visible"),e=!1):($("#scrollToTop").stop(!0,!0).removeClass("visible"),e=!1),checkScrollToTop())})}},checkScrollToTop=function(){var e=55,t=$(window).scrollTop(),a=$(window).height(),i=$("footer").offset().top+70;"CONTENT"==arOptimusOptions.THEME.SCROLLTOTOP_POSITION&&(warpperWidth=$("body > .wrapper > .wrapper_inner").width(),$("#scrollToTop").css("margin-left",Math.ceil(warpperWidth/2)+23)),t+a>i?$("#scrollToTop").css("bottom",e+t+a-i-0):parseInt($("#scrollToTop").css("bottom"))>e&&$("#scrollToTop").css("bottom",e)},CheckObjectsSizes=function(){$(".container iframe,.container object,.container video").each(function(){var e=$(this).attr("height"),t=$(this).attr("width");e&&t&&$(this).css("height",$(this).outerWidth()*e/t)})},!funcDefined("reloadTopBasket"))var reloadTopBasket=function(e,t,a,i,o,n){var s={PARAMS:$("#top_basket_params").val(),ACTION:e};"undefined"!=typeof n&&(s.delete_top_item="Y",s.delete_top_item_id=n.data("id")),$.post(arOptimusOptions.SITE_DIR+"ajax/show_basket_popup.php",s,$.proxy(function(e){$(t).html(e),getActualBasket(),"N"!==arOptimusOptions.THEME.SHOW_BASKET_ONADDTOCART&&$(window).outerWidth()>520&&("Y"==o&&$(t).find(".basket_popup_wrapp").stop(!0,!0).slideDown(a),clearTimeout(basketTimeoutSlide),basketTimeoutSlide=setTimeout(function(){var e=$("#basket_line").find(".basket_popup_wrapp");e.is(":hover")?e.show():$("#basket_line").find(".basket_popup_wrapp").slideUp(a)},i))}))};if(!funcDefined("initCountdown"))var initCountdown=function(){$(".view_sale_block").size()&&$(".view_sale_block").each(function(){var e=$(this).find(".active_to").text(),t=new Date(e.replace(/(\d+)\.(\d+)\.(\d+)/,"$3/$2/$1"));$(this).find(".countdown").countdown({until:t,format:"dHMS",padZeroes:!0,layout:'{d<}<span class="days item">{dnn}<div class="text">{dl}</div></span>{d>} <span class="hours item">{hnn}<div class="text">{hl}</div></span> <span class="minutes item">{mnn}<div class="text">{ml}</div></span> <span class="sec item">{snn}<div class="text">{sl}</div></span>'},$.countdown.regionalOptions.ru)})};var isOnceInited=insertFilter=!1,animationTime=200,delayTime=200,topMenuEnterTimer=!1,isMobile=jQuery.browser.mobile;if(isMobile&&(document.documentElement.className+=" mobile"),!funcDefined("checkVerticalMobileFilter"))var checkVerticalMobileFilter=function(){if($(".right_block1.catalog.vertical").length){if("undefined"!=typeof window.trackBarOptions){window.trackBarValues={};for(key in window.trackBarOptions)window.trackBarValues[key]={leftPercent:window["trackBar"+key].leftPercent,leftValue:window["trackBar"+key].minInput.value,rightPercent:window["trackBar"+key].rightPercent,rightValue:window["trackBar"+key].maxInput.value}}if(window.matchMedia("(max-width: 950px)").matches?insertFilter||($(".js_filter .bx_filter.bx_filter_vertical").html($(".left_block .bx_filter.bx_filter_vertical").html()),$(".left_block .bx_filter.bx_filter_vertical .bx_filter_section").remove(),insertFilter=!0):insertFilter&&($(".left_block .bx_filter.bx_filter_vertical").html($(".js_filter .bx_filter.bx_filter_vertical").html()),$(".js_filter .bx_filter.bx_filter_vertical .bx_filter_section").remove(),insertFilter=!1),"undefined"!=typeof window.trackBarOptions)for(key in window.trackBarOptions)window.trackBarOptions[key].leftPercent=window.trackBarValues[key].leftPercent,window.trackBarOptions[key].rightPercent=window.trackBarValues[key].rightPercent,window.trackBarOptions[key].curMinPrice=window.trackBarValues[key].leftValue,window.trackBarOptions[key].curMaxPrice=window.trackBarValues[key].rightValue,window["trackBar"+key]=new BX.Iblock.SmartFilter(window.trackBarOptions[key]),window["trackBar"+key].minInput.value=window.trackBarValues[key].leftValue,window["trackBar"+key].maxInput.value=window.trackBarValues[key].rightValue}};$(document).on("click",".menu_top_block>li .more a",function(){$this=$(this),$this.parents(".dropdown").first().find(">.hidden").removeClass("hidden"),$this.parent().addClass("hidden"),setTimeout(function(){$this.parent().remove()},500)}),$(document).on("mouseenter",".menu_top_block.catalogfirst>li>.dropdown>li.full",function(){var e=$(this).find(">.dropdown");e.length&&topMenuEnterTimer&&(clearTimeout(topMenuEnterTimer),topMenuEnterTimer=!1)}),$(document).on("mouseenter",".menu_top_block>li:not(.full)",function(){var e=$(this).find(">.dropdown");if(e.length&&!e.hasClass("visible")){var t=$(this).parents(".menu"),a=t.parents(".wrap_menu"),i=a.actual("outerWidth"),o=a.offset().left,n=o+i,s=n-($(this).offset().left+e.actual("outerWidth"));if(window.matchMedia("(min-width: 951px)").matches&&$(this).hasClass("catalog")&&($(".banner_auto").hasClass("catalog_page")||$(".banner_auto").hasClass("front_page")))return;0>s&&e.css({left:s+"px"}),e.stop().slideDown(animationTime,function(){e.css({height:"",overflow:"visible"})}),$(this).on("mouseleave",function(){var t=setTimeout(function(){e.stop().slideUp(animationTime,function(){e.css({left:""})})},delayTime);$(this).on("mouseenter",function(){t&&(clearTimeout(t),t=!1)})})}}),$(document).on("mouseenter",".menu_top_block>li .dropdown>li",function(){var e=$(this),t=e.find(">.dropdown");if(t.length&&(!e.parents(".full").length&&!e.hasClass("full")||e.parents(".more").length)){var a=e.parents(".menu"),o=a.parents(".wrap_menu"),n=[];topMenuEnterTimer=setTimeout(function(){var a=o.actual("outerWidth"),i=o.offset().left,s=i+a,r=e.parent(),l=r.hasClass("toleft")?!0:!1;l=l?e.offset().left+e.actual("outerWidth")-t.actual("outerWidth")<i:e.offset().left+e.actual("outerWidth")+t.actual("outerWidth")>s,l?e.find(">.dropdown").addClass("toleft").show():e.find(">.dropdown").removeClass("toleft").show();var d=t.offset().left,c=d+t.actual("outerWidth");e.parents(".dropdown").each(function(){var e=$(this),t=e.offset().left,a=t+e.actual("outerWidth");(t>=d&&c-1>t||a>d+1&&c>=a)&&(n.push(e),e.find(">li>a").css({opacity:"0.1"}))})},delayTime),e.unbind("mouseleave"),e.on("mouseleave",function(){var t=setTimeout(function(){if(e.find(".dropdown").removeClass("toleft").hide(),n.length)for(i in n)n[i].find(">li>a").css({opacity:""})},delayTime);e.unbind("mouseenter"),e.on("mouseenter",function(){t&&(clearTimeout(t),t=!1)})})}}),getGridSize=function(e){var t=1;return window.matchMedia("(min-width: 1200px)").matches&&(t=e[0]),window.matchMedia("(max-width: 1200px)").matches&&(t=e[1]),window.matchMedia("(max-width: 992px)").matches&&(t=e[2]),e[3]&&window.matchMedia("(max-width: 600px)").matches&&(t=e[3]),e[4]&&window.matchMedia("(max-width: 400px)").matches&&(t=e[4]),t},CheckFlexSlider=function(){$(".flexslider:not(.thmb)").each(function(){var e=$(this);e.resize();var t=e.data("flexslider").vars.counts;if("undefined"!=typeof t){var a=getGridSize(t),i=a!=e.data("flexslider").vars.minItems||a!=e.data("flexslider").vars.maxItems||a!=e.data("flexslider").vars.move;i&&(e.data("flexslider").vars.minItems=a,e.data("flexslider").vars.maxItems=a,e.data("flexslider").vars.move=a,e.flexslider(0),e.resize(),e.resize())}})},InitFlexSlider=function(){$(".flexslider:not(.thmb):not(.flexslider-init)").each(function(){var e,t=$(this),a={animationLoop:!1,controlNav:!1,directionNav:!0,animation:"slide"},i=$.extend({},a,e,t.data("plugin-options"));t.parent().hasClass("top_slider_wrapp")||("undefined"!=typeof i.counts&&"vertical"!==i.direction&&(i.maxItems=getGridSize(i.counts),i.minItems=getGridSize(i.counts),i.move=getGridSize(i.counts),i.itemWidth=200),i.after=i.start=function(e){var t={slider:e};BX.onCustomEvent("onSlide",[t])},i.end=function(e){var t={slider:e};BX.onCustomEvent("onSlideEnd",[t])},t.flexslider(i).addClass("flexslider-init"),i.controlNav&&t.addClass("flexslider-control-nav"),i.directionNav&&t.addClass("flexslider-direction-nav"))})},InitZoomPict=function(){if($(".zoom_picture").length){var e,t=($(".zoom_picture").closest(".slides"),$(".zoom_picture")),a={zoomWidth:200,zoomHeight:200,adaptive:!1,title:!0,Xoffset:15},i=$.extend({},a,e,t.data("plugin-options"));t.xzoom(i)}};var arBasketAsproCounters={};SetActualBasketFlyCounters=function(){1==arBasketAsproCounters.DEFAULT?$.ajax({url:arOptimusOptions.SITE_DIR+"ajax/basket_fly.php",type:"post",success:function(e){$("#basket_line .basket_fly").addClass("loaded").html(e)}}):($("#header .basket_fly .opener .basket_count .count").attr("class","count"+(arBasketAsproCounters.READY.COUNT>0?"":" empty_items")).find(".items span").text(arBasketAsproCounters.READY.COUNT),$("#header .basket_fly .opener .basket_count + a").attr("href",arBasketAsproCounters.READY.HREF),$("#header .basket_fly .opener .basket_count").attr("title",arBasketAsproCounters.READY.TITLE).attr("class","basket_count small clicked"+(arBasketAsproCounters.READY.COUNT>0?"":" empty")),$("#header .basket_fly .opener .wish_count .count").attr("class","count"+(arBasketAsproCounters.DELAY.COUNT>0?"":" empty_items")).find(".items span").text(arBasketAsproCounters.DELAY.COUNT),$("#header .basket_fly .opener .wish_count + a").attr("href",arBasketAsproCounters.DELAY.HREF),$("#header .basket_fly .opener .wish_count").attr("title",arBasketAsproCounters.DELAY.TITLE).attr("class","wish_count small clicked"+(arBasketAsproCounters.DELAY.COUNT>0?"":" empty")),$("#header .basket_fly .opener .compare_count .count").attr("class","count"+(arBasketAsproCounters.COMPARE.COUNT>0?"":" empty_items")).find(".items span").text(arBasketAsproCounters.COMPARE.COUNT),$("#header .basket_fly .opener .compare_count + a").attr("href",arBasketAsproCounters.COMPARE.HREF),$("#header .basket_fly .opener .user_block").attr("title",arBasketAsproCounters.PERSONAL.TITLE).find("+ a").attr("href",arBasketAsproCounters.PERSONAL.HREF),$("#header .basket_fly .opener .user_block .wraps_icon_block").attr("class","wraps_icon_block"+(arBasketAsproCounters.PERSONAL.ID>0?" user_auth":" user_reg")+(arBasketAsproCounters.PERSONAL.SRC?" w_img":" no_img")).attr("style",arBasketAsproCounters.PERSONAL.SRC?'background:url("'+arBasketAsproCounters.PERSONAL.SRC+'") center center no-repeat;':""))},$(document).ready(function(){if(arOptimusOptions.PAGES.ORDER_PAGE){var e=parseUrlQuery();if("ORDER_ID"in e){var t=e.ORDER_ID;if("N"!==arOptimusOptions.COUNTERS.USE_FULLORDER_GOALS){var a={goal:"goal_order_success",result:t};BX.onCustomEvent("onCounterGoals",[a])}if(checkCounters()&&"undefined"!=typeof BX.localStorage){var i=BX.localStorage.get("gtm_e_"+t);"object"==typeof i&&dataLayer.push({ecommerce:i}),"undefined"!=typeof localStorage&&localStorage.removeItem("gtm_e_"+t)}}}"Y"===arOptimusOptions.COUNTERS.USE_DEBUG_GOALS?$.cookie("_ym_debug",1,{path:"/"}):$.cookie("_ym_debug",null,{path:"/"}),scrollToTop(),checkVerticalMobileFilter(),checkFormWidth(),setTimeout(function(){InitTopestMenuGummi(),InitTopMenuGummi(),isOnceInited=!0,InitFlexSlider();try{$("header .wrap_menu").css({overflow:"visible"}),$(".visible_on_ready").removeClass("visible_on_ready")}catch(e){console.error(e)}},100),InitZoomPict(),$("body").on("click",".captcha_reload",function(e){var t=$(this).parents(".captcha-row");e.preventDefault(),$.ajax({url:arOptimusOptions.SITE_DIR+"ajax/captcha.php"}).done(function(e){t.find("input[name=captcha_sid]").val(e),t.find("img").attr("src","/bitrix/tools/captcha.php?captcha_sid="+e),t.find("input[name=captcha_word]").val("").removeClass("error"),t.find(".captcha_input").removeClass("error").find(".error").remove()})}),setTimeout(function(){$(".bg_image_site").css({opacity:1})},200),window.matchMedia("(min-width: 768px)").matches&&$(".wrapper_middle_menu.wrap_menu").removeClass("mobile"),window.matchMedia("(max-width: 767px)").matches&&$(".wrapper_middle_menu.wrap_menu").addClass("mobile"),setTimeout(function(){$(window).scroll()},400),$(".show_props").live("click",function(){$(this).prev(".props_list_wrapp").stop().slideToggle(333),$(this).find(".char_title").toggleClass("opened")}),$(".see_more").live("click",function(e){e.preventDefault();var t=$(this).is(".see_more")?$(this):$(this).parents(".see_more").first(),a=t.find("> a").length?t.find("> a"):t,i=t.parent().find("> .d");return t.hasClass("open")?(a.text(BX.message("CATALOG_VIEW_MORE")),t.removeClass("open"),i.hide()):(a.text(BX.message("CATALOG_VIEW_LESS")),t.addClass("open"),i.show()),!1}),$(".button.faq_button").click(function(e){e.preventDefault(),$(this).toggleClass("opened"),$(".faq_ask .form").slideToggle()}),$(".staff.list .staff_section .staff_section_title a").click(function(e){e.preventDefault(),$(this).parents(".staff_section").toggleClass("opened"),$(this).parents(".staff_section").find(".staff_section_items").stop().slideToggle(600),$(this).parents(".staff_section_title").find(".opener_icon").toggleClass("opened")}),$(".jobs_wrapp .item .name").click(function(e){$(this).closest(".item").toggleClass("opened"),$(this).closest(".item").find(".description_wrapp").stop().slideToggle(600),$(this).closest(".item").find(".opener_icon").toggleClass("opened")}),$(".faq.list .item .q a").live("click",function(e){e.preventDefault(),$(this).parents(".item").toggleClass("opened"),$(this).parents(".item").find(".a").stop().slideToggle(),$(this).parents(".item").find(".q .opener_icon").toggleClass("opened")}),$(".opener_icon").click(function(e){e.preventDefault(),$(this).parent().find("a").trigger("click")}),$(".to-order").live("click",function(e){e.preventDefault(),$("body").append("<span class='evb-toorder' style='display:none;'></span>"),jqmEd("to-order",arOptimusOptions.FORM.TOORDER_FORM_ID,".evb-toorder","",this),$("body .evb-toorder").click(),$("body .evb-toorder").remove()}),$(".dotdot").dotdotdot(),$(".more_block span").live("click",function(){var e=$(".catalog_detail .tabs_section").offset();$("html, body").animate({scrollTop:e.top-23},400)}),$(".counter_block:not(.basket) .plus").live("click",function(){if(!$(this).parents(".basket_wrapp").length&&"Y"!=$(this).parent().data("offers")){var e=$(this).parents(".counter_block_wr").length;input=$(this).parents(".counter_block").find("input[type=text]"),tmp_ratio=e?$(this).parents("tr").first().find("td.buy .to-cart").data("ratio"):$(this).parents(".counter_wrapp").find(".to-cart").data("ratio"),isDblQuantity=e?$(this).parents("tr").first().find("td.buy .to-cart").data("float_ratio"):$(this).parents(".counter_wrapp").find(".to-cart").data("float_ratio"),ratio=isDblQuantity?parseFloat(tmp_ratio):parseInt(tmp_ratio,10),max_value="",currentValue=input.val(),isDblQuantity&&(ratio=Math.round(ratio*arOptimusOptions.JS_ITEM_CLICK.precisionFactor)/arOptimusOptions.JS_ITEM_CLICK.precisionFactor),curValue=isDblQuantity?parseFloat(currentValue):parseInt(currentValue,10),curValue+=ratio,isDblQuantity&&(curValue=Math.round(curValue*arOptimusOptions.JS_ITEM_CLICK.precisionFactor)/arOptimusOptions.JS_ITEM_CLICK.precisionFactor),parseFloat($(this).data("max"))>0?input.val()<$(this).data("max")&&(curValue>$(this).data("max")?input.val($(this).data("max")):input.val(curValue),input.change()):(input.val(curValue),input.change())}}),$(".counter_block:not(.basket) .minus").live("click",function(){if(!$(this).parents(".basket_wrapp").length&&"Y"!=$(this).parent().data("offers")){var e=$(this).parents(".counter_block_wr").length;input=$(this).parents(".counter_block").find("input[type=text]"),tmp_ratio=e?$(this).parents("tr").first().find("td.buy .to-cart").data("ratio"):$(this).parents(".counter_wrapp").find(".to-cart").data("ratio"),isDblQuantity=e?$(this).parents("tr").first().find("td.buy .to-cart").data("float_ratio"):$(this).parents(".counter_wrapp").find(".to-cart").data("float_ratio"),ratio=isDblQuantity?parseFloat(tmp_ratio):parseInt(tmp_ratio,10),max_value="",currentValue=input.val(),isDblQuantity&&(ratio=Math.round(ratio*arOptimusOptions.JS_ITEM_CLICK.precisionFactor)/arOptimusOptions.JS_ITEM_CLICK.precisionFactor),curValue=isDblQuantity?parseFloat(currentValue):parseInt(currentValue,10),curValue-=ratio,isDblQuantity&&(curValue=Math.round(curValue*arOptimusOptions.JS_ITEM_CLICK.precisionFactor)/arOptimusOptions.JS_ITEM_CLICK.precisionFactor),parseFloat($(this).parents(".counter_block").find(".plus").data("max"))>0?currentValue>ratio&&(curValue<ratio?input.val(ratio):input.val(curValue),input.change()):(curValue>ratio?input.val(curValue):ratio?input.val(ratio):currentValue>1&&input.val(curValue),input.change())}}),$(".counter_block input[type=text]").numeric({allow:"."}),$(".counter_block input[type=text]").live("focus",function(){$(this).addClass("focus")}),$(".counter_block input[type=text]").live("blur",function(){$(this).removeClass("focus")}),$(".counter_block input[type=text]").live("change",function(e){if(!$(this).parents(".basket_wrapp").length){var t=$(this).val(),a=$(this).parents(".counter_wrapp").find(".to-cart").data("ratio")?$(this).parents(".counter_wrapp").find(".to-cart").data("ratio"):$(this).parents("tr").first().find("td.buy .to-cart").data("ratio"),i=$(this).parents(".counter_wrapp").find(".to-cart").data("float_ratio")?$(this).parents(".counter_wrapp").find(".to-cart").data("float_ratio"):$(this).parents("tr").first().find("td.buy .to-cart").data("float_ratio"),o=i?parseFloat(a):parseInt(a,10);i&&(o=Math.round(o*arOptimusOptions.JS_ITEM_CLICK.precisionFactor)/arOptimusOptions.JS_ITEM_CLICK.precisionFactor),$(this).hasClass("focus")&&(t-=t%o),parseFloat($(this).parents(".counter_block").find(".plus").data("max"))>0&&t>parseFloat($(this).parents(".counter_block").find(".plus").data("max"))&&(t=parseFloat($(this).parents(".counter_block").find(".plus").data("max")),t-=t%o),o>t?t=o:parseFloat(t)||(t=1),$(this).parents(".counter_block").parent().parent().find(".to-cart").attr("data-quantity",t),$(this).parents(".counter_block").parent().parent().find(".one_click").attr("data-quantity",t),$(this).val(t)}}),$(document).on("mouseenter","#basket_line .basket_normal:not(.empty_cart):not(.bcart) .basket_block ",function(){$(this).closest(".basket_normal").find(".popup").addClass("block"),$(this).closest(".basket_normal").find(".basket_popup_wrapp").stop(!0,!0).slideDown(150)}),$(document).on("mouseleave","#basket_line .basket_normal .basket_block ",function(){var e=$(this);$(this).closest(".basket_normal").find(".basket_popup_wrapp").stop(!0,!0).slideUp(150,function(){e.closest(".basket_normal").find(".popup").removeClass("block")})}),$(document).on("click",".popup_button_basket",function(){var e=$(".to-cart[data-item="+$(this).data("item")+"]"),t=e.attr("data-quantity");t||($val=1);var a=e.data("props"),i="",o="",n="N",s={},r=e.data("iblockid"),l=e.data("offers"),d="",c="",u=e.attr("data-item");"Y"!=l?l="N":c=e.closest(".prices_tab").find(".bx_sku_props input").val(),a&&(i=a.split(";")),e.data("part_props")&&(o=e.data("part_props")),e.data("add_props")&&(n=e.data("add_props")),$(".rid_item").length?d=$(".rid_item").data("rid"):e.data("rid")&&(d=e.data("rid")),s=fillBasketPropsExt(e,"prop","bx_ajax_text"),s.quantity=t,s.add_item="Y",s.rid=d,s.offers=l,s.iblockID=r,s.part_props=o,s.add_props=n,s.props=JSON.stringify(i),s.item=u,s.basket_props=c,$.ajax({type:"POST",url:arOptimusOptions.SITE_DIR+"ajax/item.php",data:s,dataType:"json",success:function(t){$(".basket_error_frame").jqmHide(),"STATUS"in t?(getActualBasket(s.iblockID),"OK"===t.STATUS?(e.hide(),e.closest(".counter_wrapp").find(".counter_block").hide(),e.parents("tr").find(".counter_block_wr .counter_block").hide(),e.closest(".button_block").addClass("wide"),e.parent().find(".in-cart").show(),addBasketCounter(u),$(".wish_item[data-item="+u+"]").removeClass("added"),$(".wish_item[data-item="+u+"]").find(".value").show(),$(".wish_item[data-item="+u+"]").find(".value.added").hide(),$("#basket_line .cart").length?($("#basket_line .cart").is(".empty_cart")&&($("#basket_line .cart").removeClass("empty_cart").find(".cart_wrapp a.basket_link").removeAttr("href").addClass("cart-call"),$("#basket_line .cart").removeClass("ecart"),touchBasket(".cart:not(.empty_cart) .basket_block .link")),reloadTopBasket("add",$("#basket_line"),200,5e3,"Y")):$("#basket_line .basket_fly").length&&basketFly($(window).outerWidth()>768?"open":"refresh")):showBasketError(BX.message(t.MESSAGE))):showBasketError(BX.message("CATALOG_PARTIAL_BASKET_PROPERTIES_ERROR"))}})}),$(document).on("click",".to-cart:not(.read_more)",function(e){e.preventDefault();var t=$(this),a=$(this).attr("data-quantity");a||($val=1);var i=$(this).data("props"),o="",n="",s="N",r={},l=$(this).data("iblockid"),d=$(this).data("offers"),c="",u="",p=$(this).attr("data-item");"Y"!=d?d="N":u=$(this).closest(".prices_tab").find(".bx_sku_props input").val(),i&&(o=i.split(";")),$(this).data("part_props")&&(n=$(this).data("part_props")),$(this).data("add_props")&&(s=$(this).data("add_props")),$(".rid_item").length?c=$(".rid_item").data("rid"):$(this).data("rid")&&(c=$(this).data("rid")),r=fillBasketPropsExt(t,"prop",t.data("bakset_div")),r.quantity=a,r.add_item="Y",r.rid=c,r.offers=d,r.iblockID=l,r.part_props=n,r.add_props=s,r.props=JSON.stringify(o),r.item=p,r.basket_props=u,"N"==t.data("empty_props")?showBasketError($("#"+t.data("bakset_div")).html(),BX.message("ERROR_BASKET_PROP_TITLE"),"Y",t):$.ajax({type:"POST",url:arOptimusOptions.SITE_DIR+"ajax/item.php",data:r,dataType:"json",success:function(e){getActualBasket(r.iblockID),null!==e?"STATUS"in e?(null===e.MESSAGE_EXT&&(e.MESSAGE_EXT=""),"OK"===e.STATUS?(t.hide(),t.closest(".counter_wrapp").find(".counter_block").hide(),t.parents("tr").find(".counter_block_wr .counter_block").hide(),t.closest(".button_block").addClass("wide"),t.parent().find(".in-cart").show(),addBasketCounter(p),$(".wish_item[data-item="+p+"]").removeClass("added"),$(".wish_item[data-item="+p+"]").find(".value").show(),$(".wish_item[data-item="+p+"]").find(".value.added").hide(),$("#basket_line .cart").length?($("#basket_line .cart").is(".empty_cart")&&($("#basket_line .cart").removeClass("empty_cart").find(".cart_wrapp a.basket_link").removeAttr("href").addClass("cart-call"),$("#basket_line .cart").removeClass("ecart"),touchBasket(".cart:not(.empty_cart) .basket_block .link")),reloadTopBasket("add",$("#basket_line"),200,5e3,"Y")):$("#basket_line .basket_fly").length&&basketFly($(window).outerWidth()>768?"open":"refresh")):showBasketError(BX.message(e.MESSAGE)+" <br/>"+e.MESSAGE_EXT)):showBasketError(BX.message("CATALOG_PARTIAL_BASKET_PROPERTIES_ERROR")):(t.hide(),t.closest(".counter_wrapp").find(".counter_block").hide(),t.parents("tr").find(".counter_block_wr .counter_block").hide(),t.closest(".button_block").addClass("wide"),t.parent().find(".in-cart").show(),addBasketCounter(p),$(".wish_item[data-item="+p+"]").removeClass("added"),$(".wish_item[data-item="+p+"]").find(".value").show(),$(".wish_item[data-item="+p+"]").find(".value.added").hide(),$("#basket_line .cart").length?($("#basket_line .cart").is(".empty_cart")&&($("#basket_line .cart").removeClass("empty_cart").find(".cart_wrapp a.basket_link").removeAttr("href").addClass("cart-call"),$("#basket_line .cart").removeClass("ecart"),touchBasket(".cart:not(.empty_cart) .basket_block .link")),reloadTopBasket("add",$("#basket_line"),200,5e3,"Y")):$("#basket_line .basket_fly").length&&$(window).outerWidth()>768&&basketFly("open"))}})}),$(document).on("click",".to-subscribe",function(e){if(e.preventDefault(),$(this).is(".auth"))location.href=arOptimusOptions.SITE_DIR+"auth/?backurl="+location.pathname;else{var t=$(this).attr("data-item"),a=$(this).attr("data-iblockid");$(this).hide(),$(this).parent().find(".in-subscribe").show(),$.get(arOptimusOptions.SITE_DIR+"ajax/item.php?item="+t+"&subscribe_item=Y",$.proxy(function(e){$(".wish_item[data-item="+t+"]").removeClass("added"),getActualBasket(a)}))}}),$(document).on("click",".in-subscribe",function(e){e.preventDefault();var t=$(this).attr("data-item"),a=$(this).attr("data-iblockid");$(this).hide(),$(this).parent().find(".to-subscribe").show(),$.get(arOptimusOptions.SITE_DIR+"ajax/item.php?item="+t+"&subscribe_item=Y",$.proxy(function(e){getActualBasket(a)}))}),$(document).on("click",".wish_item",function(e){e.preventDefault();var t=$(this).attr("data-quantity"),a=$(this).data("offers"),i=$(this).data("iblock"),o=$(this).data("props"),n="",s=$(this).data("item");item2=$(this).attr("data-item"),t||($val=1),"Y"!=a&&(a="N"),o&&(n=o.split(";")),$(this).hasClass("text")?$(this).hasClass("added")?($(".wish_item[data-item="+s+"]").removeClass("added"),$(".wish_item[data-item="+s+"]").find(".value").show(),$(".wish_item[data-item="+s+"]").find(".value.added").hide(),$(".like_icons").each(function(){$(this).find(".wish_item_button").length&&($(this).find(".wish_item_button").find('.wish_item[data-item="'+s+'"]').removeClass("added"),$(this).find(".wish_item_button").find('.wish_item[data-item="'+s+'"]').find(".value").show(),$(this).find(".wish_item_button").find('.wish_item[data-item="'+s+'"]').find(".value.added").hide())})):($(".wish_item[data-item="+s+"]").addClass("added"),$(".wish_item[data-item="+s+"]").find(".value").hide(),$(".wish_item[data-item="+s+"]").find(".value.added").css("display","block"),$(".like_icons").each(function(){$(this).find(".wish_item_button").length&&($(this).find(".wish_item_button").find('.wish_item[data-item="'+s+'"]').addClass("added"),$(this).find(".wish_item_button").find('.wish_item[data-item="'+s+'"]').find(".value").hide(),$(this).find(".wish_item_button").find('.wish_item[data-item="'+s+'"]').find(".value.added").show())})):$(this).hasClass("added")?($(this).hide(),$(this).closest(".wish_item_button").find(".to").show(),$(".like_icons").each(function(){$(this).find('.wish_item.text[data-item="'+s+'"]').length&&($(this).find('.wish_item.text[data-item="'+s+'"]').removeClass("added"),$(this).find('.wish_item.text[data-item="'+s+'"]').find(".value").show(),$(this).find('.wish_item.text[data-item="'+s+'"]').find(".value.added").hide()),$(this).find(".wish_item_button").length&&($(this).find(".wish_item_button").find('.wish_item[data-item="'+s+'"]').removeClass("added"),$(this).find(".wish_item_button").find('.wish_item[data-item="'+s+'"]').find(".value").show(),$(this).find(".wish_item_button").find('.wish_item[data-item="'+s+'"]').find(".value.added").hide())})):($(this).hide(),$(this).closest(".wish_item_button").find(".in").addClass("added").show(),$(".like_icons").each(function(){$(this).find('.wish_item.text[data-item="'+s+'"]').length&&($(this).find('.wish_item.text[data-item="'+s+'"]').addClass("added"),$(this).find('.wish_item.text[data-item="'+s+'"]').find(".value").hide(),$(this).find('.wish_item.text[data-item="'+s+'"]').find(".value.added").css({display:"block"})),$(this).find(".wish_item_button").length&&($(this).find(".wish_item_button").find('.wish_item[data-item="'+s+'"]').addClass("added"),$(this).find(".wish_item_button").find('.wish_item[data-item="'+s+'"]').find(".value").hide(),$(this).find(".wish_item_button").find('.wish_item[data-item="'+s+'"]').find(".value.added").show())})),$(".in-cart[data-item="+s+"]").hide(),$(".to-cart[data-item="+s+"]").parent().removeClass("wide"),$(".to-cart[data-item="+s+"]").show(),$(".counter_block[data-item="+s+"]").show(),$(this).closest(".module-cart").size()||$.ajax({type:"GET",url:arOptimusOptions.SITE_DIR+"ajax/item.php",data:"item="+item2+"&quantity="+t+"&wish_item=Y&offers="+a+"&iblockID="+i+"&props="+JSON.stringify(n),dataType:"json",success:function(e){if(getActualBasket(i),null!==e)if(null===e.MESSAGE_EXT&&(e.MESSAGE_EXT=""),"STATUS"in e)if("OK"===e.STATUS){if("N"!==arOptimusOptions.COUNTERS.USE_BASKET_GOALS){var t={goal:"goal_wish_add",params:{id:item2}};BX.onCustomEvent("onCounterGoals",[t])}$("#basket_line .cart").size()?reloadTopBasket("wish",$("#basket_line"),200,5e3,"N"):basketFly("wish")}else showBasketError(BX.message(e.MESSAGE)+" <br/>"+e.MESSAGE_EXT,BX.message("ERROR_ADD_DELAY_ITEM"));else showBasketError(BX.message(e.MESSAGE)+" <br/>"+e.MESSAGE_EXT,BX.message("ERROR_ADD_DELAY_ITEM"));else $("#basket_line .cart").size()?reloadTopBasket("wish",$("#basket_line"),200,5e3,"N"):basketFly("wish")}})}),$(document).on("click",".compare_item",function(e){e.preventDefault();var t=$(this).attr("data-item"),a=$(this).attr("data-iblock");$(this).hasClass("text")?$(this).hasClass("added")?($(".compare_item[data-item="+t+"]").removeClass("added"),$(".compare_item[data-item="+t+"]").find(".value").show(),$(".compare_item[data-item="+t+"]").find(".value.added").hide(),$(".like_icons").each(function(){$(this).find(".compare_item_button").length&&($(this).find(".compare_item_button").find('.compare_item[data-item="'+t+'"]').removeClass("added"),$(this).find(".compare_item_button").find('.compare_item[data-item="'+t+'"]').find(".value").show(),$(this).find(".compare_item_button").find('.compare_item[data-item="'+t+'"]').find(".value.added").hide())})):($(".compare_item[data-item="+t+"]").addClass("added"),$(".compare_item[data-item="+t+"]").find(".value").hide(),$(".compare_item[data-item="+t+"]").find(".value.added").css("display","block"),$(".like_icons").each(function(){$(this).find(".compare_item_button").length&&($(this).find(".compare_item_button").find('.compare_item[data-item="'+t+'"]').addClass("added"),$(this).find(".compare_item_button").find('.compare_item[data-item="'+t+'"]').find(".value.added").show(),$(this).find(".compare_item_button").find('.compare_item[data-item="'+t+'"]').find(".value").hide())})):$(this).hasClass("added")?($(this).hide(),$(this).closest(".compare_item_button").find(".to").show(),$(".like_icons").each(function(){$(this).find('.compare_item.text[data-item="'+t+'"]').length&&($(this).find('.compare_item.text[data-item="'+t+'"]').removeClass("added"),$(this).find('.compare_item.text[data-item="'+t+'"]').find(".value").show(),$(this).find('.compare_item.text[data-item="'+t+'"]').find(".value.added").hide()),$(this).find(".compare_item_button").length&&($(this).find(".compare_item_button").find('.compare_item[data-item="'+t+'"]').removeClass("added"),$(this).find(".compare_item_button").find('.compare_item[data-item="'+t+'"]').find(".value").show(),$(this).find(".compare_item_button").find('.compare_item[data-item="'+t+'"]').find(".value.added").hide())})):($(this).hide(),$(this).closest(".compare_item_button").find(".in").show(),$(".like_icons").each(function(){$(this).find('.compare_item.text[data-item="'+t+'"]').length&&($(this).find('.compare_item.text[data-item="'+t+'"]').addClass("added"),$(this).find('.compare_item.text[data-item="'+t+'"]').find(".value").hide(),$(this).find('.compare_item.text[data-item="'+t+'"]').find(".value.added").css({display:"block"})),$(this).find(".compare_item_button").length&&($(this).find(".compare_item_button").find('.compare_item[data-item="'+t+'"]').addClass("added"),$(this).find(".compare_item_button").find('.compare_item[data-item="'+t+'"]').find(".value.added").show(),$(this).find(".compare_item_button").find('.compare_item[data-item="'+t+'"]').find(".value").hide())})),$.get(arOptimusOptions.SITE_DIR+"ajax/item.php?item="+t+"&compare_item=Y&iblock_id="+a,$.proxy(function(e){getActualBasket(a),jsAjaxUtil.InsertDataToNode(arOptimusOptions.SITE_DIR+"ajax/show_compare_preview_top.php","compare_line",!1),$("#compare_fly").length&&jsAjaxUtil.InsertDataToNode(arOptimusOptions.SITE_DIR+"ajax/show_compare_preview_fly.php","compare_fly",!1)}))}),$(".fancy").fancybox({openEffect:"fade",closeEffect:"fade",nextEffect:"fade",prevEffect:"fade",tpl:{closeBtn:'<a title="'+BX.message("FANCY_CLOSE")+'" class="fancybox-item fancybox-close" href="javascript:;"></a>',next:'<a title="'+BX.message("FANCY_NEXT")+'" class="fancybox-nav fancybox-next" href="javascript:;"><span></span></a>',prev:'<a title="'+BX.message("FANCY_PREV")+'" class="fancybox-nav fancybox-prev" href="javascript:;"><span></span></a>'}}),$(".tabs>li").on("click",function(){if(!$(this).hasClass("active")){var e=$(this).index(),t=$(this).closest(".top_blocks").find(".slider_navigation").find(">li:eq("+e+")"),a=$(this).closest(".top_blocks").siblings(".tabs_content").find(">li:eq("+e+")");
$(this).addClass("active").addClass("cur").siblings().removeClass("active").removeClass("cur"),a.addClass("cur").siblings().removeClass("cur"),t.addClass("cur").siblings().removeClass("cur"),a.find(".catalog_block .catalog_item_wrapp .catalog_item .item_info:visible .item-title").sliceHeight({item:".catalog_item:visible"}),a.find(".catalog_block .catalog_item_wrapp .catalog_item .item_info:visible").sliceHeight({classNull:".footer_button",item:".catalog_item:visible"}),a.find(".catalog_block .catalog_item_wrapp .catalog_item:visible").sliceHeight({classNull:".footer_button",item:".catalog_item:visible"})}}),$(".search_block .icon").on("click",function(){var e=$(this);$(this).hasClass("open")?($(this).closest(".center_block").find(".search_middle_block").removeClass("active"),$(this).removeClass("open"),$(this).closest(".center_block").find(".search_middle_block").find(".noborder").hide()):(setTimeout(function(){e.closest(".center_block").find(".search_middle_block").find(".noborder").show()},100),$(this).closest(".center_block").find(".search_middle_block").addClass("active"),$(this).addClass("open"))}),$(document).on("mouseenter",".display_list .item_wrap",function(){$(this).prev().addClass("prev")}),$(document).on("mouseleave",".display_list .item_wrap",function(){$(this).prev().removeClass("prev")}),$(document).on("mouseenter",".catalog_block .item_wrap",function(){$(this).addClass("shadow_delay")}),$(document).on("mouseleave",".catalog_block .item_wrap",function(){$(this).removeClass("shadow_delay")}),$(document).on("click",".no_goods .button",function(){$(".bx_filter .smartfilter .bx_filter_search_reset").trigger("click")}),$(document).on("click",".ajax_load_btn",function(){var e=$(this).closest(".right_block").find(".module-pagination .flex-direction-nav .flex-next").attr("href"),t=$(this).find(".more_text_ajax");t.addClass("loading"),$.ajax({url:e,data:{ajax_get:"Y"},success:function(e){$.parseHTML(e);t.removeClass("loading"),$(".display_list").length?$(".display_list").append(e):$(".block_list").length?($(".block_list").append(e),touchItemBlock(".catalog_item a")):$(".module_products_list").length&&$(".module_products_list > tbody").append(e),setStatusButton(),initCountdown(),BX.onCustomEvent("onAjaxSuccess"),$(".bottom_nav").html($(e).find(".bottom_nav").html())}})}),$(document).on("click",".bx_compare .tabs-head li",function(){var e=$(this).find(".sortbutton").data("href");BX.showWait(BX("bx_catalog_compare_block")),$.ajax({url:e,data:{ajax_action:"Y"},success:function(t){history.pushState(null,null,e),$("#bx_catalog_compare_block").html(t),BX.closeWait()}})});var o;$(document).on({mouseover:function(e){var t=$(this),a=t.closest("tbody").index()+1,i=t.index()+1;o=$(e.delegateTarget).find(".data_table_props").children(":nth-child("+a+")").children(":nth-child("+i+")").addClass("hovered")},mouseleave:function(e){o&&o.removeClass("hovered")}},".bx_compare .data_table_props tbody>tr"),$(document).on("click",".fancy_offer",function(e){e.preventDefault();var t=[];$(".sliders .slides_block li").each(function(){var e={};e={title:$(this).find("img").attr("alt"),href:$(this).data("big")},$(this).hasClass("current")?t.unshift(e):t.push(e)}),console.log(t),$.fancybox(t,{openEffect:"fade",closeEffect:"fade",nextEffect:"fade",prevEffect:"fade",type:"image",tpl:{closeBtn:'<a title="'+BX.message("FANCY_CLOSE")+'" class="fancybox-item fancybox-close" href="javascript:;"></a>',next:'<a title="'+BX.message("FANCY_NEXT")+'" class="fancybox-nav fancybox-next" href="javascript:;"><span></span></a>',prev:'<a title="'+BX.message("FANCY_PREV")+'" class="fancybox-nav fancybox-prev" href="javascript:;"><span></span></a>'}})}),$(".tabs_section .tabs-head li").live("click",function(){$(this).is(".current")||($(".tabs_section .tabs-head li").removeClass("current"),$(this).addClass("current"),$(".tabs_section ul.tabs_content li").removeClass("current"),"product_reviews_tab"==$(this).attr("id")?($(".shadow.common").hide(),$("#reviews_content").show()):($(".shadow.common").show(),$("#reviews_content").hide(),$(".tabs_section ul.tabs_content > li:eq("+$(this).index()+")").addClass("current")))}),setTimeout(function(){$(".jobs_wrapp .item:first .name tr").trigger("click")},300),$(".buy_block .slide_offer").on("click",function(){scroll_block($(".tabs_section"))}),$(".share_wrapp .text").on("click",function(){$(this).parent().find(".shares").fadeToggle()}),$("html, body").live("mousedown",function(e){e.stopPropagation(),$(".shares").fadeOut(),$(".search_middle_block").removeClass("active_wide")}),$(".share_wrapp").find("*").live("mousedown",function(e){e.stopPropagation()}),$(document).on("click",".reviews-collapse-link",function(){$(".reviews-reply-form").slideToggle()}),initCountdown(),$(".menu.adaptive").on("click",function(){$(this).toggleClass("opened"),$(this).hasClass("opened")?$(".mobile_menu").toggleClass("opened").slideDown():$(".mobile_menu").toggleClass("opened").slideUp()}),$(".mobile_menu .has-child >a").on("click",function(e){var t=$(this).parent();e.preventDefault(),t.toggleClass("opened"),t.find(".dropdown").slideToggle()}),$(".mobile_menu .search-input-div input").live("keyup",function(e){var t=$(this).val();$(".center_block .stitle_form input").val(t),13==e.keyCode&&$(".center_block .stitle_form form").submit()}),$(".center_block .stitle_form input").live("keyup",function(e){var t=$(this).val();$(".mobile_menu .search-input-div input").val(t),13==e.keyCode&&$(".center_block .stitle_form form").submit()}),$(".mobile_menu .search-button-div button").live("click",function(e){e.preventDefault();var t=$(this).parents().find("input").val();$(".center_block .stitle_form input").val(t),$(".center_block .stitle_form form").submit()}),$(".btn.btn-add").on("click",function(){$.ajax({type:"GET",url:arOptimusOptions.SITE_DIR+"ajax/clearBasket.php",success:function(e){}})}),$(".sale-order-detail-payment-options-methods-info-change-link").on("click",function(){$(this).closest(".sale-order-detail-payment-options-methods-info").addClass("opened").siblings().addClass("opened")}),$(document).on("click",".expand_block",function(){togglePropBlock($(this))}),document.addEventListener("touchend",function(e){if($(e.target).closest(".menu_item_l1").length||($(".menu .menu_item_l1 .child").css({display:"none"}),$(".menu_item_l1").removeClass("hover")),$(e.target).closest(".basket_block").length||($(".basket_block .link").removeClass("hover"),$(".basket_block .basket_popup_wrapp").slideUp()),!$(e.target).closest(".catalog_item").length){var t=1*$(".tab:visible").attr("data-unhover");$(".tab:visible").stop().animate({height:t},100),$(".tab:visible").find(".catalog_item").removeClass("hover"),$(".tab:visible").find(".catalog_item .buttons_block").stop().fadeOut(233),$(".catalog_block").length&&$(".catalog_block").find(".catalog_item").removeClass("hover")}},!1),$(document).on("keyup",".coupon .input_coupon input",function(){$(this).val().length?($(this).removeClass("error"),$(this).closest(".input_coupon").find(".error").remove()):($(this).addClass("error"),$("<label class='error'>"+BX.message("INPUT_COUPON")+"</label>").insertBefore($(this)))}),BX.addCustomEvent(window,"onAjaxSuccess",function(){initSelects(document),InitOrderCustom(),$(".catalog_detail").length&&($(".bx_filter").remove(),InitFlexSlider()),arOptimusOptions.PAGES.ORDER_PAGE&&orderActions()}),BX.addCustomEvent(window,"onFrameDataRequestFail",function(e){console.log(e)})}),funcDefined("togglePropBlock")||(togglePropBlock=function(e){var t=e.closest(".bx_filter_parameters_box_container").find(".hidden_values");t.length&&(e.hasClass("inner_text")||e.hasClass("expand_block"))&&(t.is(":visible")?(e.text(BX.message("FILTER_EXPAND_VALUES")),t.hide()):(e.text(BX.message("FILTER_HIDE_VALUES")),t.show()))}),funcDefined("showPhoneMask")||(showPhoneMask=function(e){$(e).inputmask("mask",{mask:arOptimusOptions.THEME.PHONE_MASK,showMaskOnHover:!1})}),funcDefined("parseUrlQuery")||(parseUrlQuery=function(){var e={};if(location.search)for(var t=location.search.substr(1).split("&"),a=0;a<t.length;a++){var i=t[a].split("=");e[i[0]]=i[1]}return e}),funcDefined("getActualBasket")||(getActualBasket=function(e){var t="";"undefined"!=typeof e&&(t={iblockID:e}),$.ajax({type:"GET",url:arOptimusOptions.SITE_DIR+"ajax/actualBasket.php",data:t,success:function(e){$(".js_ajax").length||$("body").append('<div class="js_ajax"></div>'),$(".js_ajax").html(e)}})}),funcDefined("orderActions")||(orderActions=function(){if(arOptimusOptions.PAGES.ORDER_PAGE&&$(".bx-soa-cart-total").length){if($(".change_basket").length||$(".bx-soa-cart-total").prepend('<div class="change_basket">'+BX.message("BASKET_CHANGE_TITLE")+'<a href="'+arOptimusOptions.SITE_DIR+'basket/" class="change_link">'+BX.message("BASKET_CHANGE_LINK")+"</a></div>"),"object"==typeof BX.Sale.OrderAjaxComponent){if("N"!==arOptimusOptions.COUNTERS.USE_FULLORDER_GOALS&&"undefined"==typeof BX.Sale.OrderAjaxComponent.reachgoalbegin){BX.Sale.OrderAjaxComponent.reachgoalbegin=!0;var e={goal:"goal_order_begin"};BX.onCustomEvent("onCounterGoals",[e])}$(".bx-soa-cart-total-line-total").length&&!$(".bx-soa-cart-total .licence_block").length&&"Y"==arOptimusOptions.THEME.SHOW_LICENCE&&($('<div class="form"><div class="licence_block filter label_block"><label data-for="licenses_order" class="hidden error">'+BX.message("JS_REQUIRED_LICENSES")+'</label><input type="checkbox" name="licenses_order" required value="Y"><label data-for="licenses_order" class="license">'+BX.message("LICENSES_TEXT")+"</label></div></div>").insertAfter($("#bx-soa-total .bx-soa-cart-total-line-total")),$("#bx-soa-orderSave, .bx-soa-cart-total-button-container").addClass("lic_condition"),"undefined"==typeof BX.Sale.OrderAjaxComponent.oldClickOrderSaveAction&&"undefined"!=typeof BX.Sale.OrderAjaxComponent.clickOrderSaveAction&&(BX.Sale.OrderAjaxComponent.oldClickOrderSaveAction=BX.Sale.OrderAjaxComponent.clickOrderSaveAction,BX.Sale.OrderAjaxComponent.clickOrderSaveAction=function(e){$('input[name="licenses_order"]').prop("checked")?($(".bx-soa-cart-total .licence_block label.error").addClass("hidden"),BX.Sale.OrderAjaxComponent.oldClickOrderSaveAction(e)):$(".bx-soa-cart-total .licence_block label.error").removeClass("hidden")},BX.unbindAll(BX.Sale.OrderAjaxComponent.totalInfoBlockNode.querySelector("a.btn-order-save")),BX.unbindAll(BX.Sale.OrderAjaxComponent.mobileTotalBlockNode.querySelector("a.btn-order-save")),BX.unbindAll(BX.Sale.OrderAjaxComponent.orderSaveBlockNode.querySelector("a")),BX.bind(BX.Sale.OrderAjaxComponent.totalInfoBlockNode.querySelector("a.btn-order-save"),"click",BX.proxy(BX.Sale.OrderAjaxComponent.clickOrderSaveAction,BX.Sale.OrderAjaxComponent)),BX.bind(BX.Sale.OrderAjaxComponent.mobileTotalBlockNode.querySelector("a.btn-order-save"),"click",BX.proxy(BX.Sale.OrderAjaxComponent.clickOrderSaveAction,BX.Sale.OrderAjaxComponent)),BX.bind(BX.Sale.OrderAjaxComponent.orderSaveBlockNode.querySelector("a"),"click",BX.proxy(BX.Sale.OrderAjaxComponent.clickOrderSaveAction,BX.Sale.OrderAjaxComponent))),$(".bx-soa-cart-total .licence_block label.license").on("click",function(){var e=$(this).data("for");$(".bx-soa-cart-total .licence_block label.error").addClass("hidden"),$("input[name="+e+"]").prop("checked")?$("input[name="+e+"]").prop("checked",""):$("input[name="+e+"]").prop("checked","checked")})),BX.Sale.OrderAjaxComponent.hasOwnProperty("params")&&($(".bx-soa-cart-total .change_link").attr("href",BX.Sale.OrderAjaxComponent.params.PATH_TO_BASKET),arOptimusOptions.PRICES.MIN_PRICE&&arOptimusOptions.PRICES.MIN_PRICE>Number(BX.Sale.OrderAjaxComponent.result.TOTAL.ORDER_PRICE)&&($('<div class="fademask_ext"></div>').appendTo($("body")),location.href=BX.Sale.OrderAjaxComponent.params.PATH_TO_BASKET)),checkCounters()&&"undefined"==typeof BX.Sale.OrderAjaxComponent.oldSaveOrder&&"undefined"!=typeof BX.Sale.OrderAjaxComponent.saveOrder&&(BX.Sale.OrderAjaxComponent.oldSaveOrder=BX.Sale.OrderAjaxComponent.saveOrder,BX.Sale.OrderAjaxComponent.saveOrder=function(e){var t=BX.parseJSON(e);t&&t.order?t.order.SHOW_AUTH?BX.Sale.OrderAjaxComponent.oldSaveOrder(e):t.order.REDIRECT_URL&&t.order.REDIRECT_URL.length&&(!t.order.ERROR||BX.util.object_keys(t.order.ERROR).length<1)&&(arMatch=t.order.REDIRECT_URL.match(/ORDER_ID\=[^&=]*/g))&&arMatch.length&&(_id=arMatch[0].replace(/ORDER_ID\=/g,"",arMatch[0]))?$.ajax({url:arOptimusOptions.SITE_DIR+"ajax/check_order.php",dataType:"json",type:"POST",data:{ID:_id},success:function(t){parseInt(t)?purchaseCounter(parseInt(t),BX.message("FULL_ORDER"),function(t){"object"==typeof t&&"undefined"!=typeof BX.localStorage&&BX.localStorage.set("gtm_e_"+_id,t,60),BX.Sale.OrderAjaxComponent.oldSaveOrder(e)}):BX.Sale.OrderAjaxComponent.oldSaveOrder(e)},error:function(){BX.Sale.OrderAjaxComponent.oldSaveOrder(e)}}):BX.Sale.OrderAjaxComponent.oldSaveOrder(e):BX.Sale.OrderAjaxComponent.oldSaveOrder(e)})}$(".bx-ui-sls-quick-locations.quick-locations").on("click",function(){$(this).siblings().removeClass("active"),$(this).addClass("active")})}}),funcDefined("basketActions")||(basketActions=function(){if(arOptimusOptions.PAGES.BASKET_PAGE){if(checkMinPrice(),location.hash){var e=location.hash.substring(1);$("#basket_toolbar_button_"+e).length&&$("#basket_toolbar_button_"+e).trigger("click")}$(".bx_sort_container").append('<div class="top_control basket_sort"><span class="delete_all button grey_br transparent remove_all_basket">'+BX.message("BASKET_CLEAR_ALL_BUTTON")+"</span></div>"),"Y"==arOptimusOptions.THEME.SHOW_BASKET_PRINT&&$(".bx_sort_container .top_control").prepend('<span class="basket_print button grey_br transparent">'+BX.message("BASKET_PRINT_BUTTON")+"</span>"),$(".bx_sort_container .top_control .delete_all").data("type",$(".bx_sort_container a.current").index()),$(".bx_ordercart .bx_ordercart_coupon #coupon").wrap('<div class="input"></div>'),$(".bx_sort_container > a").on("click",function(){$(".bx_sort_container .top_control .delete_all").data("type",$(this).index())}),$(".basket_print").on("click",function(){window.print()}),$(".delete_all").on("click",function(){if("N"!==arOptimusOptions.COUNTERS.USE_BASKET_GOALS){var e={goal:"goal_basket_clear",params:{type:$(this).data("type")}};BX.onCustomEvent("onCounterGoals",[e])}$.post(arOptimusOptions.SITE_DIR+"ajax/action_basket.php","TYPE="+$(this).data("type")+"&CLEAR_ALL=Y",$.proxy(function(e){location.reload()}))}),$(".bx_item_list_section .bx_catalog_item").sliceHeight({row:".bx_item_list_slide",item:".bx_catalog_item"}),BX.addCustomEvent("onAjaxSuccess",function(){checkMinPrice();var e=$.trim($("#warning_message").text());$("#basket_items_list .error_text").detach(),""!=e&&($("#warning_message").hide().text(""),$("#basket_items_list").prepend('<div class="error_text">'+e+"</div>"))})}}),funcDefined("checkMinPrice")||(checkMinPrice=function(){if(arOptimusOptions.PAGES.BASKET_PAGE){var e=$("#allSum_FORMATED").text().replace(/[^0-9\.]/g,""),t=parseFloat(e);$(".catalog_back").length||$(".bx_ordercart_order_pay_center").prepend('<a href="/catalog/" class="catalog_back button transparent big_btn grey_br">'+BX.message("BASKET_CONTINUE_BUTTON")+"</a>"),arOptimusOptions.PRICES.MIN_PRICE?arOptimusOptions.PRICES.MIN_PRICE>t?($(".icon_error_wrapper").length||$(".bx_ordercart_order_pay_center").prepend('<div class="icon_error_wrapper"><div class="icon_error_block">'+BX.message("MIN_ORDER_PRICE_TEXT").replace("#PRICE#",jsPriceFormat(arOptimusOptions.PRICES.MIN_PRICE))+"</div></div>"),$(".oneclickbuy.fast_order").length&&$(".oneclickbuy.fast_order").remove(),$(".bx_ordercart_order_pay .checkout").length&&$(".bx_ordercart_order_pay .checkout").remove()):($(".icon_error_wrapper").length&&$(".icon_error_wrapper").remove(),$(".bx_ordercart_order_pay .checkout").length?$(".bx_ordercart .bx_ordercart_order_pay .checkout").css("opacity","1"):$(".bx_ordercart_order_pay_center").append('<a href="javascript:void(0)" onclick="checkOut();" class="checkout" style="opacity: 1;">'+BX.message("BASKET_ORDER_BUTTON")+"</a>"),$(".oneclickbuy.fast_order").length||"Y"!=arOptimusOptions.THEME.SHOW_ONECLICKBUY_ON_BASKET_PAGE||$(".bx_ordercart_order_pay_center").append('<span class="oneclickbuy button big_btn fast_order" onclick="oneClickBuyBasket()">'+BX.message("BASKET_QUICK_ORDER_BUTTON")+"</span>")):($(".bx_ordercart .bx_ordercart_order_pay .checkout").css("opacity","1"),$(".oneclickbuy.fast_order").length||"Y"!=arOptimusOptions.THEME.SHOW_ONECLICKBUY_ON_BASKET_PAGE||$(".bx_ordercart_order_pay_center").append('<span class="oneclickbuy button big_btn fast_order" onclick="oneClickBuyBasket()">'+BX.message("BASKET_QUICK_ORDER_BUTTON")+"</span>"))}});var isFrameDataReceived=!1;"undefined"!=typeof window.frameCacheVars?BX.addCustomEvent("onFrameDataReceived",function(e){initFull(),isFrameDataReceived=!0}):$(document).ready(initFull),funcDefined("setHeightBlockSlider")||(setHeightBlockSlider=function(){$(document).find(".specials.tab_slider_wrapp").outerWidth();$(document).find(".specials.tab_slider_wrapp .tabs_content > li.cur").css("height",""),$(document).find(".specials.tab_slider_wrapp .tabs_content .tab.cur .tabs_slider .buttons_block").hide(),$(document).find(".specials.tab_slider_wrapp .tabs_content > li.cur").equalize({children:".item-title"}),$(document).find(".specials.tab_slider_wrapp .tabs_content > li.cur").equalize({children:".item_info"}),$(document).find(".specials.tab_slider_wrapp .tabs_content > li.cur").equalize({children:".catalog_item"});var e=$(document).find(".specials.tab_slider_wrapp .tabs_content .tab.cur .tabs_slider li .buttons_block").height(),t=1*$(document).find(".specials.tab_slider_wrapp .tabs_content .tab.cur").height(),a=t+e+50;$(document).find(".specials.tab_slider_wrapp .tabs_content .tab.cur").attr("data-unhover",t),$(document).find(".specials.tab_slider_wrapp .tabs_content .tab.cur").attr("data-hover",a),$(document).find(".specials.tab_slider_wrapp .tabs_content").height(t)}),funcDefined("checkStickyFooter")||(checkStickyFooter=function(){try{ignoreResize.push(!0),$("#content").css("min-height","");var e=$("#content").offset().top,t=e+$("#content").outerHeight(),a=$("footer").offset().top;$("#content").css("min-height",$(window).height()-e-(a-t)-$("footer").outerHeight()+"px"),ignoreResize.pop()}catch(i){console.error(i)}});var timerResize=!1,ignoreResize=[];$(window).resize(function(){$("html.print").length||checkStickyFooter(),ignoreResize.length||(timerResize&&(clearTimeout(timerResize),timerResize=!1),timerResize=setTimeout(function(){BX.onCustomEvent("onWindowResize",!1)},50))});var timerScroll=!1,ignoreScroll=[],documentScrollTopLast=$(document).scrollTop();$(window).scroll(function(){documentScrollTopLast=$(document).scrollTop(),ignoreScroll.length||(timerScroll&&(clearTimeout(timerScroll),timerScroll=!1),timerScroll=setTimeout(function(){BX.onCustomEvent("onWindowScroll",!1)},50))}),BX.addCustomEvent("onWindowResize",function(e){try{if(ignoreResize.push(!0),checkScrollToTop(),checkPopupWidth(),checkCaptchaWidth(),checkFormWidth(),checkFormControlWidth(),touchMenu("ul.menu:not(.opened) > li.menu_item_l1"),touchBasket(".cart:not(.empty_cart) .basket_block .link"),CheckObjectsSizes(),CheckFlexSlider(),initSly(),checkVerticalMobileFilter(),window.matchMedia("(max-width: 768px)").matches&&$(".group_description_block.top").length){var t=$(".adaptive_filter").position().top;$(".bx_filter.bx_filter_vertical").css({top:t+20})}window.matchMedia("(min-width: 767px)").matches&&$(".wrapper_middle_menu.wrap_menu").removeClass("mobile"),window.matchMedia("(max-width: 767px)").matches&&$(".wrapper_middle_menu.wrap_menu").addClass("mobile"),$(window).outerWidth()>600?($("#header ul.menu").removeClass("opened").css("display",""),$(".authorization-cols").length&&($(".authorization-cols").equalize({children:".col .auth-title",reset:!0}),$(".authorization-cols").equalize({children:".col .form-block",reset:!0}))):($(".authorization-cols .auth-title").css("height",""),$(".authorization-cols .form-block").css("height","")),$("#basket_form").length&&$(window).outerWidth()<=600&&$("#basket_form .tabs_content.basket > li.cur td").each(function(){$(this).css("width","")}),$(".front_slider_wrapp").length&&$(".extended_pagination li i").each(function(){$(this).css({borderBottomWidth:$(this).parent("li").outerHeight()/2,borderTopWidth:$(this).parent("li").outerHeight()/2})}),setHeightCompany(),$(".bx_filter_section .bx_filter_select_container").each(function(){var e=$(this).closest(".bx_filter_parameters_box").attr("property_id");$("#smartFilterDropDown"+e).length&&$("#smartFilterDropDown"+e).css("max-width",$(this).width())})}catch(a){}finally{ignoreResize.pop()}}),BX.addCustomEvent("onWindowScroll",function(e){try{ignoreScroll.push(!0)}catch(t){}finally{ignoreScroll.pop()}}),BX.addCustomEvent("onCounterGoals",function(e){if("Y"===arOptimusOptions.COUNTERS.USE_YA_COUNTER){var t=arOptimusOptions.COUNTERS.YA_COUNTER_ID;if(t=parseInt(t),"object"!=typeof e&&(e={goal:"undefined"}),"string"!=typeof e.goal&&(e.goal="undefined"),t)try{waitCounter(t,50,function(){var a=window["yaCounter"+t];"object"==typeof a&&a.reachGoal(e.goal)})}catch(a){console.error(a)}else console.info("Bad counter id!",t)}});100  124609|/aspro.optimus/install/wizards/aspro/optimus/site/templates/aspro_optimus/js/main.js|b06795ebvar basketTimeoutSlide;
var resizeEventTimer;

var funcDefined = function(func){
	try {
		if (typeof func == 'function') {
			return true;
		} else {
			return typeof window[func] === "function";
		}
	} catch (e) {
		return false;
	}
}

if(!funcDefined('setLocationSKU')){
	function setLocationSKU(ID){
		var objUrl = parseUrlQuery(),
			j = 0,
			prefix = '',
			query_string = '',
			url = '';
		if('oid' in objUrl)
		{
			if(parseInt(objUrl.oid)>0)
			{
				objUrl.oid = ID;
				for(var i in objUrl)
				{
					if(parseInt(j)>0)
						prefix = '&';
					query_string = query_string + prefix + i + '='+ objUrl[i];
					j++;
				}
				if(query_string)
				{
					url = location.pathname+'?'+query_string;
				}
				try {
					history.pushState(null, null, url);
					return;
				} catch(e) {}
				location.hash = '#' + url.substr(1)
			}
		}
	}
}

if(!funcDefined('trimPrice')){
	var trimPrice = function trimPrice(s){
		s=s.split(" ").join("");
		s=s.split("&nbsp;").join("");
		return s;
	}
}

if(!funcDefined('markProductRemoveBasket')){
	var markProductRemoveBasket = function markProductRemoveBasket(id){
		$('.in-cart[data-item='+id+']').hide();
		$('.to-cart[data-item='+id+']').show();
		$('.to-cart[data-item='+id+']').closest('.button_block').removeClass('wide');
		$('.to-cart[data-item='+id+']').closest('.counter_wrapp').find('.counter_block').show();
		$('.counter_block[data-item='+id+']').show();
		$('.in-subscribe[data-item='+id+']').hide();
		$('.to-subscribe[data-item='+id+']').show();
		$('.wish_item[data-item='+id+']').removeClass("added");
		$('.wish_item[data-item='+id+'] .value:not(.added)').show();
		$('.wish_item[data-item='+id+'] .value.added').hide();
	}
}

if(!funcDefined('markProductAddBasket')){
	var markProductAddBasket = function markProductAddBasket(id){
		$('.to-cart[data-item='+id+']').hide();
		$('.to-cart[data-item='+id+']').closest('.counter_wrapp').find('.counter_block').hide();
		$('.to-cart[data-item='+id+']').closest('.button_block').addClass('wide');
		$('.in-cart[data-item='+id+']').show();
		$('.wish_item[data-item='+id+']').removeClass("added");
		$('.wish_item[data-item='+id+'] .value:not(.added)').show();
		$('.wish_item[data-item='+id+'] .value.added').hide();
	}
}

if(!funcDefined('markProductDelay')){
	var markProductDelay = function markProductDelay(id){
		$('.in-cart[data-item='+id+']').hide();
		$('.to-cart[data-item='+id+']').show();
		$('.to-cart[data-item='+id+']').closest('.counter_wrapp').find('.counter_block').show();
		$('.to-cart[data-item='+id+']').closest('.button_block').removeClass('wide');
		$('.wish_item[data-item='+id+']').addClass("added");
		$('.wish_item[data-item='+id+'] .value:not(.added)').hide();
		// $('.wish_item[data-item='+id+'] .value.added').show();
		$('.wish_item[data-item='+id+'] .value.added').css('display','block');
	}
}

if(!funcDefined('markProductSubscribe')){
	var markProductSubscribe = function markProductSubscribe(id){
		$('.to-subscribe[data-item='+id+']').hide();
		$('.in-subscribe[data-item='+id+']').css('display','block');
	}
}

if(!funcDefined('basketFly')){
	var basketFly = function basketFly(action){
		$.post( arOptimusOptions['SITE_DIR']+"ajax/basket_fly.php", "PARAMS="+$("#basket_form").find("input#fly_basket_params").val(), $.proxy(function( data ){
			var small=$('.opener .basket_count').hasClass('small'),
				basket_count=$(data).find('.basket_count').find('.items div').text();
			$('#basket_line .basket_fly').addClass('loaded').html(data);

			if(action=="refresh"){
				$('li[data-type=AnDelCanBuy]').trigger('click');
			}

			if(window.matchMedia('(min-width: 769px)').matches){
				if (action=='open') {
					if(small){
						if(arOptimusOptions['THEME']['SHOW_BASKET_ONADDTOCART'] !== 'N'){
							$('.opener .basket_count').click();
						}
					}else{
						$('.opener .basket_count').removeClass('small')
						$('.tabs_content.basket li[item-section="AnDelCanBuy"]').addClass('cur');
						$('#basket_line ul.tabs li[item-section="AnDelCanBuy"]').addClass('cur');
					}
				} else if (action=='wish') {
					if(small){
						if(arOptimusOptions['THEME']['SHOW_BASKET_ONADDTOCART'] !== 'N'){
							$('.opener .wish_count').click();
						}
					}else{
						$('.opener .wish_count').removeClass('small')
						$('.tabs_content.basket li[item-section="DelDelCanBuy"]').addClass('cur');
						$('#basket_line ul.tabs li[item-section="DelDelCanBuy"]').addClass('cur');
					}
				} else {
					if(arOptimusOptions['THEME']['SHOW_BASKET_ONADDTOCART'] !== 'N'){
						$('.opener .basket_count').click();
					}
				}
			}
		}));
	}
}

if(!funcDefined("clearViewedProduct")){
	function clearViewedProduct(){
		try{
			var siteID = arOptimusOptions.SITE_ID;
			var localKey = 'OPTIMUS_VIEWED_ITEMS_' + siteID;
			var cookieParams = {path: '/', expires: 30};
			if(typeof BX.localStorage !== 'undefined'){
				// remove local storage
				BX.localStorage.set(localKey, {}, 0);
			}
			// remove cookie
			$.removeCookie(localKey, cookieParams);
		}
		catch(e){
			console.error(e);
		}
	}
}

if(!funcDefined("setViewedProduct")){
	function setViewedProduct(id, arData){
		try{

			// save $.cookie option
			var bCookieJson = $.cookie.json;
			$.cookie.json = true;

			var siteID = arOptimusOptions.SITE_ID;
			var localKey = 'OPTIMUS_VIEWED_ITEMS_' + siteID;
			var cookieParams = {path: '/', expires: 30};

			if((typeof BX.localStorage !== 'undefined') && (typeof id !== 'undefined') && (typeof arData !== 'undefined')){
				var PRODUCT_ID = (typeof arData.PRODUCT_ID !== 'undefined') ? arData.PRODUCT_ID : id;
				var arViewedLocal = BX.localStorage.get(localKey) ? BX.localStorage.get(localKey) : {};
				var arViewedCookie = $.cookie(localKey) ? $.cookie(localKey) : {};
				var count = 0;

				// delete some items (sync cookie & local storage)
				for(var _id in arViewedLocal){
					arViewedLocal[_id].IS_LAST = false;
					if(typeof arViewedCookie[_id] === 'undefined'){
						delete arViewedLocal[_id];
					}
				}
				for(var _id in arViewedCookie){
					if(typeof arViewedLocal[_id] === 'undefined'){
						delete arViewedCookie[_id];
					}
				}

				for(var _id in arViewedCookie){
					count++;
				}

				// delete item if other item (offer) of that PRODUCT_ID is exists
				if(typeof arViewedLocal[PRODUCT_ID] !== 'undefined'){
					if(arViewedLocal[PRODUCT_ID].ID != id){
						delete arViewedLocal[PRODUCT_ID];
						delete arViewedCookie[PRODUCT_ID];
					}
				}

				delete arViewedLocal[2243];
				delete arViewedCookie[2243];

				var time = new Date().getTime();
				arData.ID = id;
				arData.ACTIVE_FROM = time;
				arData.IS_LAST = true;
				arViewedLocal[PRODUCT_ID] = arData;
				arViewedCookie[PRODUCT_ID] = [time.toString(), arData.PICTURE_ID];

				$.cookie(localKey, arViewedCookie, cookieParams);
				BX.localStorage.set(localKey, arViewedLocal, 2592000);  // 30 days
			}
		}
		catch(e){
			console.error(e);
		}
		finally{
			// restore $.cookie option
			$.cookie.json = bCookieJson;
		}
	}
}



if(!funcDefined('initSelects')){
	function initSelects(target){
		var iOS = ( navigator.userAgent.match(/(iPad|iPhone|iPod)/g) ? true : false );
		if ( iOS ) return;
		if($("#bx-soa-order").length)
			return;
		// SELECT STYLING
		$(target).find('.wrapper select:visible').ikSelect({
			syntax: '<div class="ik_select_link"> \
						<span class="ik_select_link_text"></span> \
						<div class="trigger"></div> \
					</div> \
					<div class="ik_select_dropdown"> \
						<div class="ik_select_list"> \
						</div> \
					</div>',
			dynamicWidth: true,
			ddMaxHeight: 112,
			customClass: 'common_select',
			//equalWidths: true,
			onShow: function(inst){
				inst.$dropdown.css('top', (parseFloat(inst.$dropdown.css('top'))-5)+'px');
				if ( inst.$dropdown.outerWidth() < inst.$link.outerWidth() ){
					inst.$dropdown.css('width', inst.$link.outerWidth());
				}
				if ( inst.$dropdown.outerWidth() > inst.$link.outerWidth() ){
					inst.$dropdown.css('width', inst.$link.outerWidth());
				}
				var count=0,
					client_height=0;
				inst.$dropdown.css('left', inst.$link.offset().left);
				$(inst.$listInnerUl).find('li').each(function(){
					if(!$(this).hasClass('ik_select_option_disabled')){
						++count;
						client_height+=$(this).outerHeight();
					}
				})
				if(client_height<112){
					inst.$listInner.css('height', 'auto');
				}else{
					inst.$listInner.css('height', '112px');
				}
				inst.$link.addClass('opened');
				inst.$listInner.addClass('scroller');
			},
			onHide: function(inst){
				inst.$link.removeClass('opened');
			}
		});
		// END OF SELECT STYLING

		var timeout;
		$(window).on('resize', function(){
			clearTimeout(timeout);
			timeout = setTimeout(function(){
				//$('select:visible').ikSelect('redraw');
				var inst='';
				if(inst=$('.common_select-link.opened + select').ikSelect().data('plugin_ikSelect')){
					inst.$dropdown.css('left', inst.$link.offset().left+'px');
				}
			}, 20);
		});
	}
}

if(!funcDefined('CheckTopMenuFullCatalogSubmenu')){
	CheckTopMenuFullCatalogSubmenu = function(){
		var $menu = $('.menu_top_block');
		var $wrapmenu = $menu.parents('.wrap_menu');
		var wrapMenuWidth = $wrapmenu.actual('outerWidth');
		var wrapMenuLeft = $wrapmenu.offset().left;
		var wrapMenuRight = wrapMenuLeft + wrapMenuWidth;
		var bCatalogFirst = $menu.hasClass('catalogfirst');
		var findMenuLi = $('.menu_top_block:visible li.full');
		var parentSubmenuWidth = $menu.actual('outerWidth');

		if($('.catalog_block.menu_top_block').length){
			if($('.catalog_block.menu_top_block').is(':visible'))
				findMenuLi=$('.menu_top_block.catalog_block li.full');
		}

		findMenuLi.each(function(){
			var $this = $(this);
			var $submenu = $this.find('>.dropdown');

			if($submenu.length){
				if(bCatalogFirst){
					$submenu.css({left: parentSubmenuWidth + 'px', width: (wrapMenuWidth - parentSubmenuWidth) + 'px', 'padding-left': '0px', 'padding-right': '0px'});
				}
				else{
					$submenu.css({left: ($this.offset().left * -1) + 'px', width: ($(window).width() - 1) + 'px', 'padding-left': wrapMenuLeft + 'px', 'padding-right': ($(window).width() - wrapMenuRight) + 'px'});
				}
				if(!isOnceInited && bCatalogFirst && arOptimusOptions["THEME"]["MENU_POSITION"]=="top"){
					$this.on('mouseenter', function(){
						$submenu.css('min-height', $this.closest('.dropdown').actual('outerHeight') + 'px');
					});
				}
			}
		});
	}
}

$.fn.getMaxHeights = function( outer, classNull, minHeight ){
	var maxHeight = this.map( function( i, e ){
		var calc_height=0;

		$(e).css('height', '');

		if( outer == true ){
			calc_height=$(e).actual('outerHeight');
		}else{
			calc_height=$(e).actual('height');
		}
		return calc_height;
	}).get();
	for(var i = 0, c = maxHeight.length; i < c; ++i){
		if(maxHeight[i] % 2){
			--maxHeight[i];
		}
	}
	return Math.max.apply( this, maxHeight );
}

$.fn.equalizeHeights = function( outer, classNull, minHeight ){
	var maxHeight = this.map( function( i, e ){
		var minus_height=0,
			calc_height=0;
		if(classNull!==false){
			minus_height=parseInt($(e).find(classNull).actual('outerHeight'));
		}
		if(minus_height)
			minus_height+=12;
		$(e).css('height', '');
		if( outer == true ){
			calc_height=$(e).actual('outerHeight')-minus_height;
		}else{
			calc_height=$(e).actual('height')-minus_height;
		}
		if(minHeight!==false){
			if(calc_height<minHeight){
				calc_height+=(minHeight-calc_height);
			}
			if(window.matchMedia('(max-width: 520px)').matches){
				calc_height=300;
			}
			if(window.matchMedia('(max-width: 400px)').matches){
				calc_height=200;
			}
		}
		return calc_height;
	}).get();

	for(var i = 0, c = maxHeight.length; i < c; ++i){
		if(maxHeight[i] % 2){
			--maxHeight[i];
		}
	}
	return this.height( Math.max.apply( this, maxHeight ) );
}

$.fn.getFloatWidth = function(){
	var width = 0

	if($(this).length){
		var rect = $(this)[0].getBoundingClientRect()
		if(!(width = rect.width)){
			width = rect.right - rect.left
		}
	}

	return width
}

$.fn.sliceHeight = function( options ){
	function _slice(el){

		el.each(function() {
			$(this).css('line-height', '');
			$(this).css('height', '');
		});
		if(typeof(options.autoslicecount) == 'undefined' || options.autoslicecount !== false){
			var row=(typeof(options.row) !== 'undefined' && options.row.length) ?  el.first().parents(options.row).getFloatWidth() : el.first().parents('.items').getFloatWidth(),
				elw=(typeof(options.item) !== 'undefined' && options.item.length) ? $(options.item).first().getFloatWidth() : (el.first().hasClass('item') ? el.first().getFloatWidth() : el.first().parents('.item').getFloatWidth());
			if(!row){
				row = el.first().parents('.row').getFloatWidth();
			}
			if(row && elw){
				options.slice = Math.floor(row / elw);
			}
		}

		if(options.slice){
			for(var i = 0; i < el.length; i += options.slice){
				$(el.slice(i, i + options.slice)).equalizeHeights(options.outer, options.classNull, options.minHeight);
			}
		}
		if(options.lineheight){
			var lineheightAdd = parseInt(options.lineheight);
			if(isNaN(lineheightAdd)){
				lineheightAdd = 0;
			}
			el.each(function() {
				$(this).css('line-height', ($(this).actual('height') + lineheightAdd) + 'px');
			});
		}

	}

	var options = $.extend({
		slice: null,
		outer: false,
		lineheight: false,
		autoslicecount: true,
		classNull: false,
		minHeight: false,
		options: false,
		resize: true,
		row:false,
		item:false
	}, options);

	var el = $(this);
	_slice(el);

	if(options.resize){
		BX.addCustomEvent('onWindowResize', function(eventdata) {
			ignoreResize.push(true);
			_slice(el);
			ignoreResize.pop();
		});
	}
}

$.fn.sliceHeightNoResize = function( options ){
	function _slice(el){

		el.each(function() {
			$(this).css('line-height', '');
			$(this).css('height', '');
		});
		if(typeof(options.autoslicecount) == 'undefined' || options.autoslicecount !== false){
			var elw = (el.first().hasClass('item') ? el.first().getFloatWidth() : el.first().parents('.item').getFloatWidth());
			var elsw = el.first().parents('.items').getFloatWidth();
			if(!elsw){
				elsw = el.first().parents('.row').getFloatWidth();
			}
			if(elsw && elw){
				options.slice = Math.floor(elsw / elw);
			}
		}

		if(options.slice){
			for(var i = 0; i < el.length; i += options.slice){

				$(el.slice(i, i + options.slice)).equalizeHeights(options.outer, options.classNull, options.minHeight);
			}
		}
		if(options.lineheight){
			var lineheightAdd = parseInt(options.lineheight);
			if(isNaN(lineheightAdd)){
				lineheightAdd = 0;
			}
			el.each(function() {
				$(this).css('line-height', ($(this).actual('height') + lineheightAdd) + 'px');
			});
		}
	}

	var options = $.extend({
		slice: null,
		outer: false,
		lineheight: false,
		autoslicecount: true,
		classNull: false,
		minHeight: false,
		options: false,
		resize: true,
	}, options);

	var el = $(this);
	_slice(el);
}

if(!funcDefined('initHoverBlock')){
	function initHoverBlock(target){
		$(target).find('.catalog_item.item_wrap').on('mouseenter', function(){
			$(this).addClass('hover');
		})
		$(target).find('.catalog_item.item_wrap').on('mouseleave', function(){
			$(this).removeClass('hover');
		})
	}
}

if(!funcDefined('setStatusButton')){
	function setStatusButton(){
		$.ajax({
			url: arOptimusOptions["SITE_DIR"]+'ajax/getAjaxBasket.php',
			type: 'POST',
			success: function(data){
				if(data.BASKET){
					for( var i in data.BASKET ){
						$('.to-cart[data-item='+data.BASKET[i]+']').hide();
						$('.counter_block[data-item='+data.BASKET[i]+']').hide();
						$('.in-cart[data-item='+data.BASKET[i]+']').show();
						$('.in-cart[data-item='+data.BASKET[i]+']').closest('.button_block').addClass('wide');
					}
				}
				if(data.DELAY){
					for( var i in data.DELAY ){
						$('.wish_item.to[data-item='+data.DELAY[i]+']').hide();
						$('.wish_item.in[data-item='+data.DELAY[i]+']').show();
						if ($('.wish_item[data-item='+data.DELAY[i]+']').find(".value.added").length) {
							$('.wish_item[data-item='+data.DELAY[i]+']').addClass("added");
							$('.wish_item[data-item='+data.DELAY[i]+']').find(".value").hide();
							$('.wish_item[data-item='+data.DELAY[i]+']').find(".value.added").show();
						}
					}
				}
				if(data.SUBSCRIBE){
					for( var i in data.SUBSCRIBE ){
						$('.to-subscribe[data-item='+data.SUBSCRIBE[i]+']').hide();
						$('.in-subscribe[data-item='+data.SUBSCRIBE[i]+']').show();
					}
				}
				if(data.COMPARE){
					for( var i in data.COMPARE ){
						$('.compare_item.to[data-item='+data.COMPARE[i]+']').hide();
						$('.compare_item.in[data-item='+data.COMPARE[i]+']').show();
						if ($('.compare_item[data-item='+data.COMPARE[i]+']').find(".value.added").length){
							$('.compare_item[data-item='+data.COMPARE[i]+']').find(".value").hide();
							$('.compare_item[data-item='+data.COMPARE[i]+']').find(".value.added").show();
						}
					}
				}
			}
		});
	}
}


if(!funcDefined('onLoadjqm')){
	var onLoadjqm = function(name, hash, requestData, selector, requestTitle, isButton, thButton){
		hash.w.addClass('show').css({
			'margin-left': ($(window).width() > hash.w.outerWidth() ? '-' + hash.w.outerWidth() / 2 + 'px' : '-' + $(window).width() / 2 + 'px'),
			'top': $(document).scrollTop() + (($(window).height() > hash.w.outerHeight() ? ($(window).height() - hash.w.outerHeight()) / 2 : 10))   + 'px',
			'opacity': 1
		});
		if(typeof(requestData) == 'undefined'){
			requestData = '';
		}
		if(typeof(selector) == 'undefined'){
			selector = false;
		}
		var width = $('.'+name+'_frame').width();
		$('.'+name+'_frame').css('margin-left', '-'+width/2+'px');

		if(name=='order-popup-call') {
		}
		else if(name=='order-button') {
			$(".order-button_frame").find("div[product_name]").find("input").val(hash.t.title).attr("readonly", "readonly").css({"overflow": "hidden", "text-overflow": "ellipsis"});
		}
		else if(name == "to-order" && selector){
			$(".to-order_frame").find('[data-sid="PRODUCT_NAME"]').val($(selector).data('name')).attr("readonly", "readonly").css({"overflow": "hidden", "text-overflow": "ellipsis"});
			$(".to-order_frame").find('[data-sid="PRODUCT_ID"]').val($(selector).attr('data-item'));
		}
		else if(name == "services" && selector) {
			$(".services_frame").find('[data-sid="SERVICE"]').val($(selector).attr('data-title'));
		}
		else if(name == "resume" && selector) {
			if($(selector).attr('data-jobs')){
				$(".resume_frame").find('[data-sid="POST"]').attr("readonly", "readonly").val($(selector).attr('data-jobs'));
			}
		}
		else if(name=='basket_error')
		{
			$(".basket_error_frame .pop-up-title").text(requestTitle);
			$(".basket_error_frame .ajax_text").html(requestData);
			// $('.basket_error_frame .ajax_text select').ikSelect('redraw');
			initSelects(document);
			if(isButton=="Y" && thButton){
				$("<div class='popup_button_basket_wr'><span class='popup_button_basket big_btn button' data-item="+thButton.data("item")+"><span>"+BX.message("ERROR_BASKET_BUTTON")+"</span></span></div>").insertAfter($(".basket_error_frame .ajax_text"));
			}
		}
		else if( name == 'one_click_buy') {
			$('#one_click_buy_form_button').on("click", function() {
				console.log('click');
				if(!$(this).hasClass("clicked")){
					if($('#one_click_buy_form').valid()){
						$(this).addClass("clicked");
						$("#one_click_buy_form").submit(); //otherwise don't works
					}
				}
			});

			$('#one_click_buy_form').submit( function() {
				if($('#one_click_buy_form').valid()){
					if($('.'+name+'_frame form input.error').length || $('.'+name+'_frame form textarea.error').length) {
						return false
					}
					else{
						$.ajax({
							url: $(this).attr('action'),
							data: $(this).serialize(),
							type: 'POST',
							dataType: 'json',
							error: function(data) {
								alert('Error connecting server');
							},
							success: function(data) {
								if(data.result == 'Y'){
									if(arOptimusOptions['COUNTERS']['USE_1CLICK_GOALS'] !== 'N'){
										var eventdata = {goal: 'goal_1click_success'};
										BX.onCustomEvent('onCounterGoals', [eventdata])
									}
									$('.one_click_buy_result').show();
									$('.one_click_buy_result_success').show();
									purchaseCounter(data.message, arOptimusOptions["COUNTERS"]["TYPE"]["ONE_CLICK"]);
								}
								else{
									$('.one_click_buy_result').show();
									$('.one_click_buy_result_fail').show();
									if(('err' in data) && data.err)
										data.message=data.message+' \n'+data.err;
									$('.one_click_buy_result_text').html(data.message);
								}
								$('.one_click_buy_modules_button', self).removeClass('disabled');
								$('#one_click_buy_form').hide();
								$('#one_click_buy_form_result').show();
							}
						});
					}
				}
				return false;
			});
		}
		else if( name == 'one_click_buy_basket') {
			$('#one_click_buy_form_button').on("click", function() {
				if(!$(this).hasClass("clicked")){
					if($('#one_click_buy_form').valid()){
						$(this).addClass("clicked");
						$("#one_click_buy_form").submit(); //otherwise don't works
					}
				}
			});

			$('#one_click_buy_form').on("submit", function(){
				if($('#one_click_buy_form').valid()){
					if($('.'+name+'_frame form input.error').length || $('.'+name+'_frame form textarea.error').length) {
						return false
					}
					else{
						$.ajax({
							url: $(this).attr('action'),
							data: $(this).serialize(),
							type: 'POST',
							dataType: 'json',
							error: function(data) {
								window.console&&console.log(data);
							},
							success: function(data) {
								if(data.result == 'Y') {
									if(arOptimusOptions['COUNTERS']['USE_FASTORDER_GOALS'] !== 'N'){
										var eventdata = {goal: 'goal_fastorder_success'};
										BX.onCustomEvent('onCounterGoals', [eventdata])
									}
									$('.one_click_buy_result').show();
									$('.one_click_buy_result_success').show();
									purchaseCounter(data.message, arOptimusOptions["COUNTERS"]["TYPE"]["QUICK_ORDER"]);
								}
								else{
									$('.one_click_buy_result').show();
									$('.one_click_buy_result_fail').show();
									if(('err' in data) && data.err)
										data.message=data.message+' \n'+data.err;
									$('.one_click_buy_result_text').text(data.message);
								}
								$('.one_click_buy_modules_button', self).removeClass('disabled');
								$('#one_click_buy_form').hide();
								$('#one_click_buy_form_result').show();
							}
						});
					}
				}
				return false;
			});
		}

		$('.'+name+'_frame').show();
	}
}

if(!funcDefined('onHidejqm')){
	var onHidejqm = function(name, hash){
		if (hash.w.find('.one_click_buy_result_success').is(':visible') && name=="one_click_buy_basket") {
			window.location.href = window.location.href;
		}
		hash.w.css('opacity', 0).hide();
		hash.w.empty();
		hash.o.remove();
		hash.w.removeClass('show');
	}
}

if(!funcDefined("oneClickBuy")) {
	var oneClickBuy = function (elementID, iblockID, that) {
		var name = 'one_click_buy';
		var elementQuantity = 1;
		var offerProps = false;
		var buy_btn=$(that).closest('.buy_block').find('.to-cart');
		var buy_btn2=$(that).closest('tr').find('.to-cart');

		if(typeof(that) !== 'undefined'){
			elementQuantity = $(that).attr('data-quantity');
			offerProps = $(that).attr('data-props');
		}

		if(elementQuantity < 0){
			elementQuantity = 1;
		}

		var tmp_props=buy_btn.data("props"),
			tmp_props2=buy_btn2.data("props"),
			props='',
			part_props='',
			add_props='N',
			fill_prop={},
			iblockid = buy_btn.data('iblockid'),
			item = buy_btn.attr('data-item');

		if(tmp_props){
			props=tmp_props.split(";");
		}else if(tmp_props2){
			props=tmp_props2.split(";");
		}
		if(buy_btn.data("part_props")){
			part_props=buy_btn.data("part_props");
		}
		if(buy_btn.data("add_props")){
			add_props=buy_btn.data("add_props");
		}

		fill_prop=fillBasketPropsExt(buy_btn, 'prop', buy_btn.data('bakset_div'));
		fill_prop.iblockID=iblockid;
		fill_prop.part_props=part_props;
		fill_prop.add_props=add_props;
		fill_prop.props=JSON.stringify(props);
		fill_prop.item=item;
		fill_prop.ocb_item="Y";

		$('body').find('.'+name+'_frame').remove();
		$('body').find('.'+name+'_trigger').remove();
		$('body').append('<div class="'+name+'_frame popup"></div>');
		$('body').append('<div class="'+name+'_trigger"></div>');
		$('.'+name+'_frame').jqm({trigger: '.'+name+'_trigger', onHide: function(hash) { onHidejqm(name,hash); }, toTop: false, onLoad: function( hash ){ onLoadjqm(name, hash ); }, ajax: arOptimusOptions["SITE_DIR"]+'ajax/one_click_buy.php?ELEMENT_ID='+elementID+'&IBLOCK_ID='+iblockID+'&ELEMENT_QUANTITY='+elementQuantity+'&OFFER_PROPS='+fill_prop.props});
		$('.'+name+'_trigger').click();
	}
}

if(!funcDefined("oneClickBuyBasket")) {
	var oneClickBuyBasket = function () {
		name = 'one_click_buy_basket'
		$('body').find('.'+name+'_frame').remove();
		$('body').find('.'+name+'_trigger').remove();
		$('body').append('<div class="'+name+'_frame popup"></div>');
		$('body').append('<div class="'+name+'_trigger"></div>');
		$('.'+name+'_frame').jqm({trigger: '.'+name+'_trigger', onHide: function(hash) { onHidejqm(name,hash) }, onLoad: function( hash ){ onLoadjqm( name, hash ); }, ajax: arOptimusOptions["SITE_DIR"]+'ajax/one_click_buy_basket.php'});
		$('.'+name+'_trigger').click();
	}
}

if(!funcDefined("scroll_block")) {
	function scroll_block(block){
		var topPos = block.offset().top,
			headerH = $('header').outerHeight(true,true);
		if($(".stores_tab").length){
			$(".stores_tab").addClass("current").siblings().removeClass("current");
		}else{
			$(".prices_tab").addClass("current").siblings().removeClass("current");
			if($(".prices_tab .opener").length && !$(".prices_tab .opener .opened").length){
				var item = $(".prices_tab .opener").first();
				item.find(".opener_icon").addClass("opened");
				item.parents("tr").addClass("nb")
				item.parents("tr").next(".offer_stores").find(".stores_block_wrap").slideDown(200);
			}
		}
		$('html,body').animate({'scrollTop':topPos-30},150);
	}
}

if(!funcDefined("jqmEd")) {
	var jqmEd = function (name, form_id, open_trigger, requestData, selector, requestTitle, isButton, thButton){
		if(typeof(requestData) == "undefined"){
			requestData = '';
		}
		if(typeof(selector) == "undefined"){
			selector = false;
		}
		$('body').find('.'+name+'_frame').remove();
		$('body').append('<div class="'+name+'_frame popup"></div>');
		if(typeof open_trigger == "undefined" ){
			$('.'+name+'_frame').jqm({trigger: '.'+name+'_frame.popup',onHide: function(hash) { onHidejqm(name,hash); }, onLoad: function( hash ){ onLoadjqm( name , hash , requestData, selector); }, ajax: arOptimusOptions["SITE_DIR"]+'ajax/form.php?form_id='+form_id+(requestData.length ? '&' + requestData : '')});
		}else{
			if(name == 'enter'){
				$('.'+name+'_frame').jqm({trigger: open_trigger,onHide: function(hash) { onHidejqm(name,hash); },  onLoad: function( hash ){ onLoadjqm( name , hash , requestData, selector); }, ajax: arOptimusOptions["SITE_DIR"]+'ajax/auth.php'});
			}else if(name=='basket_error'){
				$('.'+name+'_frame').jqm({trigger: open_trigger, onHide: function(hash) { onHidejqm(name,hash); }, onLoad: function( hash ){ onLoadjqm( name , hash , requestData, selector, requestTitle, isButton, thButton); }, ajax: arOptimusOptions["SITE_DIR"]+'ajax/basket_error.php'});
			}else{
				$('.'+name+'_frame').jqm({trigger: open_trigger, onHide: function(hash) { onHidejqm(name,hash); }, onLoad: function( hash ){ onLoadjqm( name , hash , requestData, selector); }, ajax: arOptimusOptions["SITE_DIR"]+'ajax/form.php?form_id='+form_id+(requestData.length ? '&' + requestData : '')});
			}
			$(open_trigger).dblclick(function(){return false;})
		}
		return true;
	}
}

if (!funcDefined("replaceBasketPopup")){
	function replaceBasketPopup (hash){
		if(typeof hash != "undefined"){
			hash.w.hide();
			hash.o.hide();
		}
	}
}

if(!funcDefined("waitLayer")){
	function waitLayer(delay, callback){
		if(typeof dataLayer != 'undefined'){
			if(typeof callback == 'function'){
				callback();
			}
		}
		else{
			setTimeout(function() {
				waitLayer(delay, callback);
			}, delay);
		}
	}
}

if(!funcDefined("waitCounter")){
	waitCounter = function(idCounter, delay, callback){
		var obCounter = window['yaCounter' + idCounter];
		if(typeof obCounter == 'object'){
			if(typeof callback == 'function'){
				callback();
			}
		}
		else{
			setTimeout(function(){
				waitCounter(idCounter, delay, callback);
			}, delay);
		}
	}
}

if(!funcDefined("InitTopestMenuGummi")){
	InitTopestMenuGummi = function(){
		if(!isOnceInited){
			function _init(){
				var arItems = $menuTopest.find('>li:not(.more)');
				var cntItems = arItems.length;
				if(cntItems){
					var itemsWidth = 0;
					for(var i = 0; i < cntItems; ++i){
						var item = arItems.eq(i);
						var itemWidth = item.actual('outerWidth',{includeMargin: true});
						arItemsHideWidth[i] = (itemsWidth += itemWidth) + (i !== (cntItems - 1) ? moreWidth : 0);
					}
				}
			}

			function _gummi(){
				var rowWidth = $menuTopest.actual('innerWidth');
				var arItems = $menuTopest.find('>li:not(.more),li.more>.dropdown>li');
				var cntItems = arItems.length;
				if(cntItems){
					var bMore = false;
					for(var i = cntItems - 1; i >= 0; --i){
						var item = arItems.eq(i);
						var bInMore = item.parents('.more').length > 0;
						if(!bInMore){
							if(arItemsHideWidth[i] > rowWidth){
								if(!bMore){
									bMore = true;
									more.removeClass('hidden');
								}
								var clone = item.clone();
								clone.find('>a').addClass('dark_font');
								clone.prependTo(moreDropdown);
								item.addClass('cloned');
							}
						}
					}
					for(var i = 0; i < cntItems; ++i){
						var item = arItems.eq(i);
						var bInMore = item.parents('.more').length > 0;
						if(bInMore){
							if(arItemsHideWidth[i] <= rowWidth){
								if(i === (cntItems - 1)){
									bMore = false;
									more.addClass('hidden');
								}
								var clone = item.clone();
								clone.find('>a').removeClass('dark_font');
								clone.insertBefore(more);
								item.addClass('cloned');
							}
						}
					}
					$menuTopest.find('li.cloned').remove();
				}
			}

			var $menuTopest = $('.menu.topest');
			var more = $menuTopest.find('>.more');
			var moreDropdown = more.find('>.dropdown');
			var moreWidth = more.actual('outerWidth',{includeMargin: true});
			var arItemsHideWidth = [];
			ignoreResize.push(true);
			_init();
			_gummi();
			ignoreResize.pop();

			$(window).resize(function(){
				ignoreResize.push(true);
				_gummi();
				ignoreResize.pop();
			});
		}
	}
}

if(!funcDefined("InitTopMenuGummi")){
	InitTopMenuGummi = function(){
		function _init(){
			var arItems = $topMenu.closest('.wrap_menu').find('.inc_menu .menu_top_block >li:not(.more)');
			var cntItems = arItems.length;
			if(cntItems){
				var itemsWidth = 0;
				for(var i = 0; i < cntItems; ++i){
					var item = arItems.eq(i);
						var itemWidth = item.actual('outerWidth');
						arItemsHideWidth[i] = (itemsWidth += itemWidth) + (i !== (cntItems - 1) ? moreWidth : 0);
				}
			}

		}

		function _gummi(){
			var rowWidth = $wrapMenu.actual('innerWidth') - $wrapMenuLeft.actual('innerWidth');
			var arItems = $topMenu.find('>li:not(.more):not(.catalog),li.more>.dropdown>li');
			var cntItems = arItems.length;

			if(cntItems){
				var bMore = false;
				for(var i = cntItems - 1; i >= 0; --i){
					var item = arItems.eq(i);
					var bInMore = item.parents('.more').length > 0;
					if(!bInMore){
						if(arItemsHideWidth[i] > rowWidth){
							if(!bMore){
								bMore = true;
								more.removeClass('hidden');
							}
							var clone = item.clone();
							clone.find('>.dropdown').removeAttr('style').removeClass('toleft');
							clone.find('>a').addClass('dark_font').removeAttr('style');
							clone.prependTo(moreDropdown);
							item.addClass('cloned');
						}
					}
				}
				for(var i = 0; i < cntItems; ++i){
					var item = arItems.eq(i);
					var bInMore = item.parents('.more').length > 0;
					if(bInMore){
						if(arItemsHideWidth[i] <= rowWidth){
							if(i === (cntItems - 1)){
								bMore = false;
								more.addClass('hidden');
							}
							var clone = item.clone();
							clone.find('>a').removeClass('dark_font');
							clone.insertBefore(more);
							item.addClass('cloned');
						}
					}
				}
				$topMenu.find('li.cloned').remove();

				var cntItemsVisible = $topMenu.find('>li:not(.more):not(.catalog)').length;
				var o = rowWidth - arItemsHideWidth[cntItemsVisible - 1];
				var itemsPaddingAdd = Math.floor(o / (cntItemsVisible + (more.hasClass('hidden') ? 0 : 1)));
				var itemsPadding_new = itemsPadding_min + itemsPaddingAdd;
				var itemsPadding_new_l = Math.floor(itemsPadding_new / 2);
				var itemsPadding_new_r = itemsPadding_new - itemsPadding_new_l;

				$topMenu.find('>li:not(.catalog):visible>a').each(function(){
					$(this).css({'padding-left': itemsPadding_new_l + 'px'});
					$(this).css({'padding-right': itemsPadding_new_r + 'px'});
				});

				var lastItemPadding_new = itemsPadding_new + o - (cntItemsVisible + (more.is(':visible') ? 1 : 0)) * itemsPaddingAdd;
				var lastItemPadding_new_l = Math.floor(lastItemPadding_new / 2);
				var lastItemPadding_new_r = lastItemPadding_new - lastItemPadding_new_l;
				$topMenu.find('>li:visible').last().find('>a').css({'padding-left': lastItemPadding_new_l + 'px'});
				$topMenu.find('>li:visible').last().find('>a').css({'padding-right': lastItemPadding_new_r + 'px'});
				CheckTopMenuFullCatalogSubmenu();
			}
		}

		var $topMenu = $('.menu_top_block');
		var $wrapMenu = $topMenu.parents('.wrap_menu');
		var $wrapMenuLeft = $wrapMenu.find('.catalog_menu_ext');
		var more = $topMenu.find('>.more');
		var moreWidth = more.actual('outerWidth',{includeMargin: true});
		more.addClass('hidden');
		var arItemsHideWidth = [];
		var moreDropdown = more.find('>.dropdown');
		var itemsPadding = parseInt(more.find('>a').css('padding-left')) * 2;
		var itemsPadding_min = itemsPadding;

		// setTimeout(function(){
			ignoreResize.push(true);
			_init();
			_gummi();
			ignoreResize.pop();
		// }, 100)

		$(window).resize(function(){
			ignoreResize.push(true);
			_gummi();
			ignoreResize.pop();
		});

		/*BX.addCustomEvent('onTopPanelFixUnfix', function(eventdata) {
			ignoreResize.push(true);
			_gummi();
			ignoreResize.pop();
		});*/
	}
}

if(!funcDefined("checkCounters")){
	function checkCounters(name){
		if(typeof name !== "undefined"){
			if(name == "google" && (arOptimusOptions["COUNTERS"]["GOOGLE_ECOMERCE"] == "Y" && arOptimusOptions["COUNTERS"]["GOOGLE_COUNTER"] > 0)){
				return true;
			}
			else if(name == "yandex" && (arOptimusOptions['COUNTERS']['USE_YA_COUNTER'] == 'Y' && arOptimusOptions["COUNTERS"]["YANDEX_ECOMERCE"] == "Y" && arOptimusOptions["COUNTERS"]["YANDEX_COUNTER"] > 0)){
				return true;
			}
			else{
				return false;
			}
		}
		else if((arOptimusOptions['COUNTERS']['USE_YA_COUNTER'] == 'Y' && arOptimusOptions["COUNTERS"]["YANDEX_ECOMERCE"] == "Y" && arOptimusOptions["COUNTERS"]["YANDEX_COUNTER"] > 0) || (arOptimusOptions["COUNTERS"]["GOOGLE_ECOMERCE"] == "Y" && arOptimusOptions["COUNTERS"]["GOOGLE_COUNTER"] > 0)) {
			return true;
		}
		else{
			return false;
		}
	}
}

if(!funcDefined("addBasketCounter")){
	function addBasketCounter(id){
		if(arOptimusOptions['COUNTERS']['USE_BASKET_GOALS'] !== 'N'){
			var eventdata = {goal: 'goal_basket_add', params: {id: id}};
			BX.onCustomEvent('onCounterGoals', [eventdata]);
		}
		if(checkCounters()){
			$.ajax({
				url:arOptimusOptions['SITE_DIR'] + "ajax/goals.php",
				dataType: "json",
				type: "POST",
				data: {"ID": id},
				success: function(item){
					if(!!item && !!item.ID){
						waitLayer(100, function() {
							dataLayer.push({
								"event": arOptimusOptions["COUNTERS"]['GOOGLE_EVENTS']['ADD2BASKET'],
							    "ecommerce": {
							    	"currencyCode": item.CURRENCY,
							        "add": {
							            "products": [{
						                    "id": item.ID,
						                    "name": item.NAME,
						                    "price": item.PRICE,
						                    "brand": item.BRAND,
						                    "category": item.CATEGORY,
						                    "quantity": item.QUANTITY
						                }]
							        }
							    }
							});
						});
					}
				}
			});
		}
	}
}

if(!funcDefined("purchaseCounter")){
	function purchaseCounter(order_id, type, callback){
		if(checkCounters()){
			$.ajax({
				url:arOptimusOptions['SITE_DIR'] + "ajax/goals.php",
				dataType: "json",
				type: "POST",
				data: {"ORDER_ID": order_id, "TYPE": type},
				success: function(order){
					var products = [];
					if(order.ITEMS){
						for(var i in order.ITEMS){
							products.push({
								"id": order.ITEMS[i].ID,
								"sku": order.ITEMS[i].ID,
			                    "name": order.ITEMS[i].NAME,
			                    "price": order.ITEMS[i].PRICE,
			                    "brand": order.ITEMS[i].BRAND,
			                    "category": order.ITEMS[i].CATEGORY,
			                    "quantity": order.ITEMS[i].QUANTITY
							});
						}
					}
					if(order.ID){
						waitLayer(100, function() {
							dataLayer.push({
							    "ecommerce": d = {
							    	"purchase": {
								    	"actionField":{
								    		"id": order.ACCOUNT_NUMBER,
								    		"shipping": order.PRICE_DELIVERY,
								    		"tax": order.TAX_VALUE,
								    		"list": type,
								    		"revenue": order.PRICE
								    	},
							            "products": products
							        }
							    }
							});

							if(typeof callback !== 'undefined'){
								callback(d);
							}
						});
					}
					else{
						if(typeof callback !== 'undefined'){
							callback(false);
						}
					}
				},
				error: function(){
					if(typeof callback !== 'undefined'){
						callback(false);
					}
				}
			});
		}
		else{
			if(typeof callback !== 'undefined'){
				callback(false);
			}
		}
	}
}

if(!funcDefined("viewItemCounter")){
	function viewItemCounter(id, price_id){
		if(checkCounters()){
			$.ajax({
				url:arOptimusOptions['SITE_DIR'] + "ajax/goals.php",
				dataType: "json",
				type: "POST",
				data: {"PRODUCT_ID": id, "PRICE_ID": price_id},
				success: function(item){
					if(item.ID){
						waitLayer(100, function() {
							dataLayer.push({
								//"event": "",
								"ecommerce": {
									"detail": {
										"products": [{
											"id": item.ID,
											"name": item.NAME,
											"price": item.PRICE,
											"brand": item.BRAND,
											"category": item.CATEGORY
										}]
									}
								}
							});
						});
					}
				}
			});
		}
	}
}

if(!funcDefined("checkoutCounter")){
	function checkoutCounter(step, option, callback){
		if(checkCounters('google')){
			$.ajax({
				url:arOptimusOptions['SITE_DIR'] + "ajax/goals.php",
				dataType: "json",
				type: "POST",
				data: {"BASKET": "Y"},
				success: function(basket){
					var products = [];
					if(basket.ITEMS){
						for(var i in basket.ITEMS){
							products.push({
								"id": basket.ITEMS[i].ID,
			                    "name": basket.ITEMS[i].NAME,
			                    "price": basket.ITEMS[i].PRICE,
			                    "brand": basket.ITEMS[i].BRAND,
			                    "category": basket.ITEMS[i].CATEGORY,
			                    "quantity": basket.ITEMS[i].QUANTITY
							});
						}
					}
					if(products){
						waitLayer(100, function() {
							dataLayer.push({
								"event": arOptimusOptions["COUNTERS"]['GOOGLE_EVENTS']['CHECKOUT_ORDER'],
							    "ecommerce": {
							    	"actionField":{
							    		"step": step,
							    		"option": option
							    	},
							        "products": products
							    },
							    /*"eventCallback": function() {
							    	if((typeof callback !== 'undefined') && (typeof callback === 'function')){
							    		callback();
							    	}
							   }*/
							});
						});
					}
				}
			});
		}
	}
}

if(!funcDefined("delFromBasketCounter")){
	function delFromBasketCounter(id, callback){
		if(checkCounters()){
			$.ajax({
				url:arOptimusOptions['SITE_DIR'] + "ajax/goals.php",
				dataType: "json",
				type: "POST",
				data: {"ID": id},
				success: function(item){
					if(item.ID){
						waitLayer(100, function() {
							dataLayer.push({
								"event": arOptimusOptions["COUNTERS"]['GOOGLE_EVENTS']['REMOVE_BASKET'],
							    "ecommerce": {
							        "remove": {
							            "products": [{
						                    "id": item.ID,
						                    "name": item.NAME,
						                    "category": item.CATEGORY
						                }]
							        }
							    }
							});
							if(typeof callback == 'function'){
								callback();
							}
						});
					}
				}
			});
		}
	}
}

if(!funcDefined("setHeightCompany")){
	function setHeightCompany(){
		$('.md-50.img').height($('.md-50.big').outerHeight()-35);
	}
}

if(!funcDefined("initSly")){
	function initSly(){
		var $frame  = $(document).find('.frame');
		var $slidee = $frame.children('ul').eq(0);
		var $wrap   = $frame.parent();

		if(arOptimusOptions["PAGES"]["CATALOG_PAGE"]){
			$frame.sly({
				horizontal: 1,
				itemNav: 'basic',
				smart: 1,
				mouseDragging: 0,
				touchDragging: 0,
				releaseSwing: 0,
				startAt: 0,
				scrollBar: $wrap.find('.scrollbar'),
				scrollBy: 1,
				speed: 300,
				elasticBounds: 0,
				easing: 'swing',
				dragHandle: 1,
				dynamicHandle: 1,
				clickBar: 1,

				// Buttons
				forward: $wrap.find('.forward'),
				backward: $wrap.find('.backward'),
			});
			$frame.sly('reload');
		}
	}
}

if(!funcDefined("createTableCompare")){
	function createTableCompare(originalTable, appendDiv, cloneTable){

		try{
			var clone = originalTable.clone().removeAttr('id').addClass('clone');
			if(cloneTable.length){
				cloneTable.remove();
				appendDiv.html('');
				appendDiv.html(clone);
			}else{
				appendDiv.append(clone);
			}
		}
		catch(e){}
		finally{

		}
	}
}

if(!funcDefined('fillBasketPropsExt')){
	fillBasketPropsExt = function(that, prop_code, basket_prop_div){
		var
			i = 0,
			propCollection = null,
			foundValues = false,
			basketParams = {},
			obBasketProps = null;

		// obBasketProps = that.closest('.catalog_detail').find('.basket_props_block');
		obBasketProps = BX(basket_prop_div);

		if (!!obBasketProps)
		{
			propCollection = obBasketProps.getElementsByTagName('select');
			if (!!propCollection && !!propCollection.length)
			{
				for (i = 0; i < propCollection.length; i++)
				{
					if (!propCollection[i].disabled)
					{
						switch(propCollection[i].type.toLowerCase())
						{
							case 'select-one':
								basketParams[propCollection[i].name] = propCollection[i].value;
								foundValues = true;
								break;
							default:
								break;
						}
					}
				}
			}
			propCollection = obBasketProps.getElementsByTagName('input');
			if (!!propCollection && !!propCollection.length)
			{
				for (i = 0; i < propCollection.length; i++)
				{
					if (!propCollection[i].disabled)
					{
						switch(propCollection[i].type.toLowerCase())
						{
							case 'hidden':
								basketParams[propCollection[i].name] = propCollection[i].value;
								foundValues = true;
								break;
							case 'radio':
								if (propCollection[i].checked)
								{
									basketParams[propCollection[i].name] = propCollection[i].value;
									foundValues = true;
								}
								break;
							default:
								break;
						}
					}
				}
			}
		}
		if (!foundValues)
		{
			basketParams[prop_code] = [];
			basketParams[prop_code][0] = 0;
		}
		return basketParams;
	}
}
if(!funcDefined('showBasketError')){
	showBasketError = function(mess, title, addButton, th){
		var title_set=(title ? title : BX.message("ERROR_BASKET_TITLE")),
			isButton="N",
			thButton="";
		if(typeof addButton!==undefined){
			isButton="Y";
		}
		if(typeof th!==undefined){
			thButton=th;
		}
		$("body").append("<span class='add-error-bakset' style='display:none;'></span>");
		jqmEd('basket_error', 'error-bakset', '.add-error-bakset', mess, this, title_set, isButton, thButton);
		$("body .add-error-bakset").click();
		$("body .add-error-bakset").remove();
	}
}

if(!funcDefined("isRealValue")){
	function isRealValue(obj){
		return obj && obj !== "null" && obj!== "undefined";
	}
}

if(!funcDefined("rightScroll")){
	function rightScroll(prop, id){
		var el = BX('prop_' + prop + '_' + id);
		if (el) {
			var curVal = parseInt(el.style.marginLeft);
			if (curVal >= 0) el.style.marginLeft = curVal - 20 + '%';
		}
	}
}

if(!funcDefined("leftScroll")){
	function leftScroll(prop, id){
		var el = BX('prop_' + prop + '_' + id);
		if (el) {
			var curVal = parseInt(el.style.marginLeft);
			if (curVal < 0) el.style.marginLeft = curVal + 20 + '%';
		}
	}
}

if(!funcDefined("InitOrderCustom")){
	InitOrderCustom = function () {
		$('.ps_logo img').wrap('<div class="image"></div>');

		$('#bx-soa-order .radio-inline').each(function() {
			if ($(this).find('input').attr('checked') == 'checked') {
				$(this).addClass('checked');
			}
		});

		$('#bx-soa-order .checkbox input[type=checkbox]').each(function() {
			if ($(this).attr('checked') == 'checked')
				$(this).parent().addClass('checked');
		});

		$('#bx-soa-order .bx-authform-starrequired').each(function() {
			var html = $(this).html();
			$(this).closest('label').append('<span class="bx-authform-starrequired"> '+ html + '</span>');
			$(this).detach();
		});
		$('.bx_ordercart_coupon').each(function() {
			if ($(this).find('.bad').length)
				$(this).addClass('bad');
			else if ($(this).find('.good').length)
				$(this).addClass('good');
		});
		/*if (typeof(propsMap) !== 'undefined') {
			$(propsMap).on('click', function () {
				var value = $('#orderDescription').val();
				if ($('#orderDescription')) {
					if (value != '') {
						$('#orderDescription').closest('.form-group').addClass('value_y');
					}
				}
			});
		}*/
	}
}

if(!funcDefined("InitLabelAnimation")){
	InitLabelAnimation = function(className) {
		// Fix order labels
		if (!$(className).length) {
			return;
		}
		$(className).find('.form-group').each(function() {
			if ($(this).find('input[type=text], textarea').length && !$(this).find('.dropdown-block').length && $(this).find('input[type=text], textarea').val() != '') {
				$(this).addClass('value_y');
			}
		});

		$(document).on('click', className+' .form-group:not(.bx-soa-pp-field) label', function() {
			$(this).parent().find('input, textarea').focus();
		});

		$(document).on('focusout', className+' .form-group:not(.bx-soa-pp-field) input, '+className+' .form-group:not(.bx-soa-pp-field) textarea', function() {
			var value = $(this).val();
			if (value != '' && !$(this).closest('.form-group').find('.dropdown-block').length && !$(this).closest('.form-group').find('#profile_change').length) {
				$(this).closest('.form-group').addClass('value_y');
			}else{
				$(this).closest('.form-group').removeClass('value_y');
			}
		});

		$(document).on('focus', className+' .form-group:not(.bx-soa-pp-field) input, '+className+' .form-group:not(.bx-soa-pp-field) textarea', function() {
			if (!$(this).closest('.form-group').find('.dropdown-block').length && !$(this).closest('.form-group').find('#profile_change').length && !$(this).closest('.form-group').find('[name=PERSON_TYPE_OLD]').length ) {
				$(this).closest('.form-group').addClass('value_y');
			}
		});
	};
}

checkPopupWidth = function(){
	$('.popup.show').each(function() {
		var width_form = $(this).actual('width');
		$(this).css({
			'margin-left': ($(window).width() > width_form ? '-' + width_form / 2 + 'px' : '-' + $(window).width() / 2 + 'px'),
		});
	});
}

checkCaptchaWidth = function(){
	$('.captcha-row').each(function() {
		var width = $(this).actual('width');
		if($(this).hasClass('b')){
			if(width > 320){
				$(this).removeClass('b');
			}
		}
		else{
			if(width <= 320){
				$(this).addClass('b');
			}
		}
	});
}

checkFormWidth = function(){
	$('.form .form_left').each(function() {
		var form = $(this).parents('.form');
		var width = form.actual('width');
		if(form.hasClass('b')){
			if(width > 417){
				form.removeClass('b');
			}
		}
		else{
			if(width <= 417){
				form.addClass('b');
			}
		}
	});
}

checkFormControlWidth = function(){
	$('.form-control').each(function() {
		var width = $(this).actual('width');
		var labelWidth = $(this).find('label:not(.error) > span').actual('width');
		var errorWidth = $(this).find('label.error').actual('width');
		if(errorWidth > 0){
			if($(this).hasClass('h')){
				if(width > (labelWidth + errorWidth + 5)){
					$(this).removeClass('h');
				}
			}
			else{
				if(width <= (labelWidth + errorWidth + 5)){
					$(this).addClass('h');
				}
			}
		}
		else{
			$(this).removeClass('h');
		}
	});
}

scrollToTop = function(){
	if(arOptimusOptions['THEME']['SCROLLTOTOP_TYPE'] !== 'NONE'){
		var _isScrolling = false;
		// Append Button
		$('body').append($('<a />').addClass('scroll-to-top ' + arOptimusOptions['THEME']['SCROLLTOTOP_TYPE'] + ' ' + arOptimusOptions['THEME']['SCROLLTOTOP_POSITION']).attr({'href': '#', 'id': 'scrollToTop'}));
		$('#scrollToTop').click(function(e){
			e.preventDefault();
			$('body, html').animate({scrollTop : 0}, 500);
			return false;
		});
		// Show/Hide Button on Window Scroll event.
		$(window).scroll(function(){
			if(!_isScrolling) {
				_isScrolling = true;
				if($(window).scrollTop() > 150){
					$('#scrollToTop').stop(true, true).addClass('visible');
					_isScrolling = false;
				}
				else{
					$('#scrollToTop').stop(true, true).removeClass('visible');
					_isScrolling = false;
				}
				checkScrollToTop();
			}
		});
	}
}

checkScrollToTop = function(){
	var bottom = 55,
		scrollVal = $(window).scrollTop(),
		windowHeight = $(window).height(),
		footerOffset = $('footer').offset().top +70;

	if(arOptimusOptions['THEME']['SCROLLTOTOP_POSITION'] == 'CONTENT'){
		warpperWidth = $('body > .wrapper > .wrapper_inner').width();
		$('#scrollToTop').css('margin-left', Math.ceil(warpperWidth / 2) + 23);
	}

	if(scrollVal + windowHeight > footerOffset){
		$('#scrollToTop').css('bottom', bottom  + scrollVal + windowHeight - footerOffset - 0);
	}
	else if(parseInt($('#scrollToTop').css('bottom')) > bottom){
		$('#scrollToTop').css('bottom', bottom);
	}
}

CheckObjectsSizes = function() {
	$('.container iframe,.container object,.container video').each(function() {
		var height_attr = $(this).attr('height');
		var width_attr = $(this).attr('width');
		if (height_attr && width_attr) {
			$(this).css('height', $(this).outerWidth() * height_attr / width_attr);
		}
	});
}

if(!funcDefined('reloadTopBasket')){
	var reloadTopBasket = function reloadTopBasket(action, basketWindow, speed, delay, slideDown, item){
		var obj={
				"PARAMS": $('#top_basket_params').val(),
				"ACTION": action
			};
		if(typeof item !== "undefined" ){
			obj.delete_top_item='Y';
			obj.delete_top_item_id=item.data('id');
		}
		$.post( arOptimusOptions['SITE_DIR']+"ajax/show_basket_popup.php", obj, $.proxy(function( data ){
			$(basketWindow).html(data);

			getActualBasket();

			if(arOptimusOptions['THEME']['SHOW_BASKET_ONADDTOCART'] !== 'N'){
				if($(window).outerWidth() > 520){
					if(slideDown=="Y")
						$(basketWindow).find('.basket_popup_wrapp').stop(true,true).slideDown(speed);
					clearTimeout(basketTimeoutSlide);
					basketTimeoutSlide = setTimeout(function() {
						var _this = $('#basket_line').find('.basket_popup_wrapp');
						if (_this.is(':hover')) {
							_this.show();
						}else{
							$('#basket_line').find('.basket_popup_wrapp').slideUp(speed);
						}
					},delay);
				}
			}
		}))
	}
}

/*countdown start*/
if(!funcDefined('initCountdown')){
	var initCountdown = function initCountdown(){
		if( $('.view_sale_block').size() ){
			$('.view_sale_block').each(function(){
				var activeTo=$(this).find('.active_to').text(),
					dateTo= new Date(activeTo.replace(/(\d+)\.(\d+)\.(\d+)/, '$3/$2/$1'));
				$(this).find('.countdown').countdown({until: dateTo, format: 'dHMS', padZeroes: true, layout: '{d<}<span class="days item">{dnn}<div class="text">{dl}</div></span>{d>} <span class="hours item">{hnn}<div class="text">{hl}</div></span> <span class="minutes item">{mnn}<div class="text">{ml}</div></span> <span class="sec item">{snn}<div class="text">{sl}</div></span>'}, $.countdown.regionalOptions['ru']);
			})
		}
	}
}
/*countdown end*/

var isOnceInited = insertFilter = false;
var animationTime = 200;
var delayTime = 200;
var topMenuEnterTimer = false;
var isMobile = jQuery.browser.mobile;

if(isMobile){
	document.documentElement.className += ' mobile';
}

/*filter start*/
if(!funcDefined('checkVerticalMobileFilter')){
	var checkVerticalMobileFilter = function checkVerticalMobileFilter(){
		if($('.right_block1.catalog.vertical').length){
			if(typeof window['trackBarOptions'] !== 'undefined'){
				window['trackBarValues'] = {}
				for(key in window['trackBarOptions']){
					window['trackBarValues'][key] = {
						'leftPercent': window['trackBar' + key].leftPercent,
						'leftValue': window['trackBar' + key].minInput.value,
						'rightPercent': window['trackBar' + key].rightPercent,
						'rightValue': window['trackBar' + key].maxInput.value,
					}
				}
			}

			if(window.matchMedia('(max-width: 950px)').matches){
				if(!insertFilter){
					$('.js_filter .bx_filter.bx_filter_vertical').html($('.left_block .bx_filter.bx_filter_vertical').html());
					$('.left_block .bx_filter.bx_filter_vertical .bx_filter_section').remove();
					insertFilter=true;
				}
			}else{
				if(insertFilter){
					$('.left_block .bx_filter.bx_filter_vertical').html($('.js_filter .bx_filter.bx_filter_vertical').html());
					$('.js_filter .bx_filter.bx_filter_vertical .bx_filter_section').remove();
					insertFilter=false;
				}
			}

			if(typeof window['trackBarOptions'] !== 'undefined'){
				for(key in window['trackBarOptions']){
					window['trackBarOptions'][key].leftPercent = window['trackBarValues'][key].leftPercent;
					window['trackBarOptions'][key].rightPercent = window['trackBarValues'][key].rightPercent;
					window['trackBarOptions'][key].curMinPrice = window['trackBarValues'][key].leftValue;
					window['trackBarOptions'][key].curMaxPrice = window['trackBarValues'][key].rightValue;
					window['trackBar' + key] = new BX.Iblock.SmartFilter(window['trackBarOptions'][key]);
					window['trackBar' + key].minInput.value = window['trackBarValues'][key].leftValue;
					window['trackBar' + key].maxInput.value = window['trackBarValues'][key].rightValue;
				}
			}
		}
	}
}
/*filter end*/

// TOP MENU ANIMATION
$(document).on('click', '.menu_top_block>li .more a', function(){
	$this = $(this);
	$this.parents('.dropdown').first().find('>.hidden').removeClass('hidden');
	$this.parent().addClass('hidden');
	setTimeout(function(){
		$this.parent().remove();
	}, 500);
});

$(document).on('mouseenter', '.menu_top_block.catalogfirst>li>.dropdown>li.full', function(){
	var $submenu = $(this).find('>.dropdown');

	if($submenu.length){
		if(topMenuEnterTimer){
			clearTimeout(topMenuEnterTimer);
			topMenuEnterTimer = false;
		}
	}
});

$(document).on('mouseenter', '.menu_top_block>li:not(.full)', function(){
	var $submenu = $(this).find('>.dropdown');

	if($submenu.length && !$submenu.hasClass('visible')){
		var $menu = $(this).parents('.menu');
		var $wrapmenu = $menu.parents('.wrap_menu');
		var wrapMenuWidth = $wrapmenu.actual('outerWidth');
		var wrapMenuLeft = $wrapmenu.offset().left;
		var wrapMenuRight = wrapMenuLeft + wrapMenuWidth;
		var left = wrapMenuRight - ($(this).offset().left + $submenu.actual('outerWidth'));
		if(window.matchMedia('(min-width: 951px)').matches && $(this).hasClass('catalog') && ( $('.banner_auto').hasClass('catalog_page') || $('.banner_auto').hasClass('front_page'))){
			return;
		}
		if(left < 0){
			$submenu.css({left: left + 'px'});
		}
		$submenu.stop().slideDown(animationTime, function(){
			$submenu.css({height: '', 'overflow':'visible'});
		});


		$(this).on('mouseleave', function(){
			var leaveTimer = setTimeout(function(){
				$submenu.stop().slideUp(animationTime, function(){
					$submenu.css({left: ''});
				});
			}, delayTime);

			$(this).on('mouseenter', function(){
				if(leaveTimer){
					clearTimeout(leaveTimer);
					leaveTimer = false;
				}
			});
		});
	}

});

$(document).on('mouseenter', '.menu_top_block>li .dropdown>li', function(){
	var $this = $(this);
	var $submenu = $this.find('>.dropdown');

	if($submenu.length && ((!$this.parents('.full').length && !$this.hasClass('full')) || $this.parents('.more').length)){
		var $menu = $this.parents('.menu');
		var $wrapmenu = $menu.parents('.wrap_menu');
		var arParentSubmenuForOpacity = [];
		topMenuEnterTimer = setTimeout(function(){

			var wrapMenuWidth = $wrapmenu.actual('outerWidth');
			var wrapMenuLeft = $wrapmenu.offset().left;
			var wrapMenuRight = wrapMenuLeft + wrapMenuWidth;
			var $parentSubmenu = $this.parent();
			var bToLeft = $parentSubmenu.hasClass('toleft') ? true : false;
			if(!bToLeft){
				bToLeft = $this.offset().left + $this.actual('outerWidth') + $submenu.actual('outerWidth') > wrapMenuRight;
			}
			else{
				bToLeft = $this.offset().left + $this.actual('outerWidth') - $submenu.actual('outerWidth') < wrapMenuLeft;
			}

			if(bToLeft){
				$this.find('>.dropdown').addClass('toleft').show();
			}
			else{
				$this.find('>.dropdown').removeClass('toleft').show();
			}
			var submenuLeft = $submenu.offset().left;
			var submenuRight = submenuLeft + $submenu.actual('outerWidth');

			$this.parents('.dropdown').each(function(){
				var $this = $(this);
				var leftOffset = $this.offset().left;
				var rightOffset = leftOffset + $this.actual('outerWidth');
				if(leftOffset >= submenuLeft  && leftOffset < (submenuRight - 1) || (rightOffset > (submenuLeft + 1) && rightOffset <= submenuRight)){
					arParentSubmenuForOpacity.push($this);
					$this.find('>li>a').css({opacity: '0.1'});
				}
			});
		}, delayTime);

		$this.unbind('mouseleave');
		$this.on('mouseleave', function(){
			var leaveTimer = setTimeout(function(){
				$this.find('.dropdown').removeClass('toleft').hide();
				if(arParentSubmenuForOpacity.length){
					for(i in arParentSubmenuForOpacity){
						arParentSubmenuForOpacity[i].find('>li>a').css({opacity: ''});
					}
				}
			}, delayTime);

			$this.unbind('mouseenter');
			$this.on('mouseenter', function(){
				if(leaveTimer){
					clearTimeout(leaveTimer);
					leaveTimer = false;
				}
			});
		});
	}
});

getGridSize = function(counts) {
	var counts_item=1;
		//wide
		if(window.matchMedia('(min-width: 1200px)').matches){
			counts_item=counts[0];
		}

		//large
		if(window.matchMedia('(max-width: 1200px)').matches){
			counts_item=counts[1];
		}

		//middle
		if(window.matchMedia('(max-width: 992px)').matches){
			counts_item=counts[2];
		}

		//small
		if(counts[3]){
			if(window.matchMedia('(max-width: 600px)').matches){
				counts_item=counts[3];
			}
		}

		//exsmall
		if(counts[4]){
			if(window.matchMedia('(max-width: 400px)').matches){
				counts_item=counts[4];
			}
		}
	return counts_item;
}

CheckFlexSlider = function(){
	$('.flexslider:not(.thmb)').each(function(){
		var slider = $(this);
		slider.resize();
		var counts = slider.data('flexslider').vars.counts;
		if(typeof(counts) != 'undefined'){
			var cnt = getGridSize(counts);
			var to0 = (cnt != slider.data('flexslider').vars.minItems || cnt != slider.data('flexslider').vars.maxItems || cnt != slider.data('flexslider').vars.move);
			if(to0){
				slider.data('flexslider').vars.minItems = cnt;
				slider.data('flexslider').vars.maxItems = cnt;
				slider.data('flexslider').vars.move = cnt;
				slider.flexslider(0);
				slider.resize();
				slider.resize(); // twise!
			}
		}
	});
}

InitFlexSlider = function() {
	$('.flexslider:not(.thmb):not(.flexslider-init)').each(function(){
		var slider = $(this);
		var options;
		var defaults = {
			animationLoop: false,
			controlNav: false,
			directionNav: true,
			animation: "slide"
		}
		var config = $.extend({}, defaults, options, slider.data('plugin-options'));
		if(!slider.parent().hasClass('top_slider_wrapp')){
			if(typeof(config.counts) != 'undefined' && config.direction !== 'vertical'){
				config.maxItems =  getGridSize(config.counts);
				config.minItems = getGridSize(config.counts);
				config.move = getGridSize(config.counts);
				config.itemWidth = 200;
			}

			config.after = config.start = function(slider){
				var eventdata = {slider: slider};
				BX.onCustomEvent('onSlide', [eventdata]);
			}

			config.end = function(slider){
				var eventdata = {slider: slider};
				BX.onCustomEvent('onSlideEnd', [eventdata]);
			}

			slider.flexslider(config).addClass('flexslider-init');
			if(config.controlNav)
				slider.addClass('flexslider-control-nav');
			if(config.directionNav)
				slider.addClass('flexslider-direction-nav');
		}
	});
}

InitZoomPict = function() {
	if($('.zoom_picture').length){
		var slide=$('.zoom_picture').closest('.slides');
		var zoomer = $('.zoom_picture'),
			options,
			defaults = {
				zoomWidth: 200,
				zoomHeight: 200,
				adaptive: false,
				title: true,
				Xoffset: 15,

			};
		var config = $.extend({}, defaults, options, zoomer.data('plugin-options'));
			zoomer.xzoom(config);
	}
}

var arBasketAsproCounters = {}
SetActualBasketFlyCounters = function(){
	if(arBasketAsproCounters.DEFAULT == true){
		$.ajax({
			url: arOptimusOptions['SITE_DIR'] + 'ajax/basket_fly.php',
			type: 'post',
			success: function(html){
				$('#basket_line .basket_fly').addClass('loaded').html(html);
			}
		});
	}
	else{
		$('#header .basket_fly .opener .basket_count .count').attr('class', 'count' + (arBasketAsproCounters.READY.COUNT > 0 ? '' : ' empty_items')).find('.items span').text(arBasketAsproCounters.READY.COUNT)
		$('#header .basket_fly .opener .basket_count + a').attr('href', arBasketAsproCounters['READY']['HREF'])
		$('#header .basket_fly .opener .basket_count').attr('title', arBasketAsproCounters.READY.TITLE).attr('class', 'basket_count small clicked' + (arBasketAsproCounters.READY.COUNT > 0 ? '' : ' empty'))

		$('#header .basket_fly .opener .wish_count .count').attr('class', 'count' + (arBasketAsproCounters.DELAY.COUNT > 0 ? '' : ' empty_items')).find('.items span').text(arBasketAsproCounters.DELAY.COUNT)
		$('#header .basket_fly .opener .wish_count + a').attr('href', arBasketAsproCounters.DELAY.HREF)
		$('#header .basket_fly .opener .wish_count').attr('title', arBasketAsproCounters.DELAY.TITLE).attr('class', 'wish_count small clicked' + (arBasketAsproCounters.DELAY.COUNT > 0 ? '' : ' empty'))

		$('#header .basket_fly .opener .compare_count .count').attr('class', 'count' + (arBasketAsproCounters.COMPARE.COUNT > 0 ? '' : ' empty_items')).find('.items span').text(arBasketAsproCounters.COMPARE.COUNT)
		$('#header .basket_fly .opener .compare_count + a').attr('href', arBasketAsproCounters.COMPARE.HREF)

		$('#header .basket_fly .opener .user_block').attr('title', arBasketAsproCounters.PERSONAL.TITLE).find('+ a').attr('href', arBasketAsproCounters.PERSONAL.HREF)
		$('#header .basket_fly .opener .user_block .wraps_icon_block').attr('class', 'wraps_icon_block' + (arBasketAsproCounters.PERSONAL.ID > 0 ? ' user_auth' : ' user_reg') + (arBasketAsproCounters.PERSONAL.SRC ? ' w_img' : ' no_img')).attr('style', (arBasketAsproCounters.PERSONAL.SRC ? 'background:url("' + arBasketAsproCounters.PERSONAL.SRC + '") center center no-repeat;' : ''))
	}
}

$(document).ready(function(){
	//ecommerce order
	if(arOptimusOptions["PAGES"]["ORDER_PAGE"]){
		var arUrl = parseUrlQuery();
		if("ORDER_ID" in arUrl){
			var _id = arUrl["ORDER_ID"];
			if(arOptimusOptions['COUNTERS']['USE_FULLORDER_GOALS'] !== 'N'){
				var eventdata = {goal: 'goal_order_success', result: _id};
				BX.onCustomEvent('onCounterGoals', [eventdata])
			}

			if(checkCounters()){
				if(typeof BX.localStorage !== 'undefined'){
					var d = BX.localStorage.get('gtm_e_' + _id);
					if(typeof d === 'object'){
						dataLayer.push({"ecommerce": d});
					}

					if(typeof localStorage !== 'undefined'){
						localStorage.removeItem('gtm_e_' + _id);
					}
				}
			}
		}
	}

	// ya.metrika debug
	if(arOptimusOptions['COUNTERS']['USE_DEBUG_GOALS'] === 'Y'){
		$.cookie('_ym_debug', 1, {path: '/',});
	}
	else{
		$.cookie('_ym_debug', null, {path: '/',});
	}

	scrollToTop();
	checkVerticalMobileFilter();
	checkFormWidth();

	setTimeout(function(){
		InitTopestMenuGummi();
		InitTopMenuGummi();
		isOnceInited = true;

		InitFlexSlider();

		try{
			// SHOW TOP MENU ON READY AFTER GUMMI
			$('header .wrap_menu').css({overflow: 'visible'});
			$('.visible_on_ready').removeClass('visible_on_ready');
		}
		catch(e){console.error(e);}
	},100);



	InitZoomPict();

	$('body').on( 'click', '.captcha_reload', function(e){
		var captcha = $(this).parents('.captcha-row');
		e.preventDefault();
		$.ajax({
			url: arOptimusOptions['SITE_DIR'] + 'ajax/captcha.php'
		}).done(function(text){
			captcha.find('input[name=captcha_sid]').val(text);
			captcha.find('img').attr('src', '/bitrix/tools/captcha.php?captcha_sid=' + text);
			captcha.find('input[name=captcha_word]').val('').removeClass('error');
			captcha.find('.captcha_input').removeClass('error').find('.error').remove();
		});
	});

	setTimeout(function(){
		$('.bg_image_site').css({
			'opacity':1
		})
	},200);

	if(window.matchMedia('(min-width: 768px)').matches){
		$('.wrapper_middle_menu.wrap_menu').removeClass('mobile');
	}

	if(window.matchMedia('(max-width: 767px)').matches){
		$('.wrapper_middle_menu.wrap_menu').addClass('mobile');
	}

	setTimeout(function() {
		$(window).scroll();
	}, 400);

	$(".show_props").live('click', function(){
		$(this).prev(".props_list_wrapp").stop().slideToggle(333);
		$(this).find(".char_title").toggleClass("opened");
	});

	$('.see_more').live('click', function(e) {
		e.preventDefault();
		var see_more = ($(this).is('.see_more') ? $(this) : $(this).parents('.see_more').first());
		var see_moreText = (see_more.find('> a').length ? see_more.find('> a') : see_more);
		var see_moreHiden = see_more.parent().find('> .d');
		if(see_more.hasClass('open')){
			see_moreText.text(BX.message('CATALOG_VIEW_MORE'));
			see_more.removeClass('open');
			see_moreHiden.hide();
		}
		else{
			see_moreText.text(BX.message('CATALOG_VIEW_LESS'));
			see_more.addClass('open');
			see_moreHiden.show();
		}
		return false;
	});

	$('.button.faq_button').click(function(e){
		e.preventDefault();
		$(this).toggleClass('opened');
		$('.faq_ask .form').slideToggle();
	});

	$('.staff.list .staff_section .staff_section_title a').click(function(e) {
		e.preventDefault();
		$(this).parents('.staff_section').toggleClass('opened');
		$(this).parents('.staff_section').find('.staff_section_items').stop().slideToggle(600);
		$(this).parents('.staff_section_title').find('.opener_icon').toggleClass('opened');
	});

	$('.jobs_wrapp .item .name').click(function(e) {
		$(this).closest('.item').toggleClass('opened');
		$(this).closest('.item').find('.description_wrapp').stop().slideToggle(600);
		$(this).closest('.item').find('.opener_icon').toggleClass('opened');
	});

	$('.faq.list .item .q a').live('click', function(e){
		e.preventDefault();
		$(this).parents('.item').toggleClass('opened');
		$(this).parents('.item').find('.a').stop().slideToggle();
		$(this).parents('.item').find('.q .opener_icon').toggleClass('opened');
	});

	$('.opener_icon').click(function(e) {
		e.preventDefault();
		$(this).parent().find('a').trigger('click');
	});

	$('.to-order').live('click', function(e){
		e.preventDefault();
		$("body").append("<span class='evb-toorder' style='display:none;'></span>");
		jqmEd('to-order', arOptimusOptions['FORM']['TOORDER_FORM_ID'], '.evb-toorder', '', this);
		$("body .evb-toorder").click();
		$("body .evb-toorder").remove();
	});

	$('.dotdot').dotdotdot();

	$('.more_block span').live('click', function() {
		var content_offset=$('.catalog_detail .tabs_section').offset();
		$('html, body').animate({scrollTop: content_offset.top-23}, 400);
	});

	$(".counter_block:not(.basket) .plus").live("click", function(){
		if(!$(this).parents('.basket_wrapp').length){
			if($(this).parent().data("offers")!="Y"){
				var isDetailSKU2 = $(this).parents('.counter_block_wr').length;
					input = $(this).parents(".counter_block").find("input[type=text]")
					tmp_ratio = !isDetailSKU2 ? $(this).parents(".counter_wrapp").find(".to-cart").data('ratio') : $(this).parents('tr').first().find("td.buy .to-cart").data('ratio'),
					isDblQuantity = !isDetailSKU2 ? $(this).parents(".counter_wrapp").find(".to-cart").data('float_ratio') : $(this).parents('tr').first().find("td.buy .to-cart").data('float_ratio'),
					ratio=( isDblQuantity ? parseFloat(tmp_ratio) : parseInt(tmp_ratio, 10)),
					max_value='';
					currentValue = input.val();


				if(isDblQuantity)
					ratio = Math.round(ratio*arOptimusOptions.JS_ITEM_CLICK.precisionFactor)/arOptimusOptions.JS_ITEM_CLICK.precisionFactor;

				curValue = (isDblQuantity ? parseFloat(currentValue) : parseInt(currentValue, 10));

				curValue += ratio;
				if (isDblQuantity){
					curValue = Math.round(curValue*arOptimusOptions.JS_ITEM_CLICK.precisionFactor)/arOptimusOptions.JS_ITEM_CLICK.precisionFactor;
				}
				if(parseFloat($(this).data('max'))>0){
					if(input.val() < $(this).data('max')){
						if(curValue>$(this).data('max')){
							input.val($(this).data('max'));
						}else{
							input.val(curValue);
						}
						input.change();
					}
				}else{
					input.val(curValue);
					input.change();
				}
			}
		}
	});

	$(".counter_block:not(.basket) .minus").live("click", function(){
		if(!$(this).parents('.basket_wrapp').length){
			if($(this).parent().data("offers")!="Y"){
				var isDetailSKU2 = $(this).parents('.counter_block_wr').length;
					input = $(this).parents(".counter_block").find("input[type=text]")
					tmp_ratio = !isDetailSKU2 ? $(this).parents(".counter_wrapp").find(".to-cart").data('ratio') : $(this).parents('tr').first().find("td.buy .to-cart").data('ratio'),
					isDblQuantity = !isDetailSKU2 ? $(this).parents(".counter_wrapp").find(".to-cart").data('float_ratio') : $(this).parents('tr').first().find("td.buy .to-cart").data('float_ratio'),
					ratio=( isDblQuantity ? parseFloat(tmp_ratio) : parseInt(tmp_ratio, 10)),
					max_value='';
					currentValue = input.val();

				if(isDblQuantity)
					ratio = Math.round(ratio*arOptimusOptions.JS_ITEM_CLICK.precisionFactor)/arOptimusOptions.JS_ITEM_CLICK.precisionFactor;

				curValue = (isDblQuantity ? parseFloat(currentValue) : parseInt(currentValue, 10));

				curValue -= ratio;
				if (isDblQuantity){
					curValue = Math.round(curValue*arOptimusOptions.JS_ITEM_CLICK.precisionFactor)/arOptimusOptions.JS_ITEM_CLICK.precisionFactor;
				}

				if(parseFloat($(this).parents(".counter_block").find(".plus").data('max'))>0){
					if(currentValue > ratio){
						if(curValue<ratio){
							input.val(ratio);
						}else{
							input.val(curValue);
						}
						input.change();
					}
				}else{
					if(curValue > ratio){
						input.val(curValue);
					}else{
						if(ratio){
							input.val(ratio);
						}else if(currentValue > 1){
							input.val(curValue);
						}
					}
					input.change();
				}
			}
		}
	});

	$('.counter_block input[type=text]').numeric({allow:"."});
	$('.counter_block input[type=text]').live('focus', function(){
		$(this).addClass('focus');
	})
	$('.counter_block input[type=text]').live('blur', function(){
		$(this).removeClass('focus');
	})
	$('.counter_block input[type=text]').live('change', function(e){
		if(!$(this).parents('.basket_wrapp').length){
			var val = $(this).val(),
				tmp_ratio = $(this).parents(".counter_wrapp").find(".to-cart").data('ratio') ? $(this).parents(".counter_wrapp").find(".to-cart").data('ratio') : $(this).parents('tr').first().find("td.buy .to-cart").data('ratio'),
				isDblQuantity = $(this).parents(".counter_wrapp").find(".to-cart").data('float_ratio') ? $(this).parents(".counter_wrapp").find(".to-cart").data('float_ratio') : $(this).parents('tr').first().find("td.buy .to-cart").data('float_ratio'),
				ratio=( isDblQuantity ? parseFloat(tmp_ratio) : parseInt(tmp_ratio, 10));

			if(isDblQuantity)
				ratio = Math.round(ratio*arOptimusOptions.JS_ITEM_CLICK.precisionFactor)/arOptimusOptions.JS_ITEM_CLICK.precisionFactor;

			if($(this).hasClass('focus'))
				val -= (val % ratio);

			if(parseFloat($(this).parents(".counter_block").find(".plus").data('max'))>0){
				if(val>parseFloat($(this).parents(".counter_block").find(".plus").data('max'))){
					val=parseFloat($(this).parents(".counter_block").find(".plus").data('max'));
					val -= (val % ratio);
				}
			}
			if(val<ratio){
				val=ratio;
			}else if(!parseFloat(val)){
				val=1;
			}

			$(this).parents('.counter_block').parent().parent().find('.to-cart').attr('data-quantity', val);
			$(this).parents('.counter_block').parent().parent().find('.one_click').attr('data-quantity', val);
			$(this).val(val);
		}
	});

	/*slide cart*/
	$(document).on('mouseenter', '#basket_line .basket_normal:not(.empty_cart):not(.bcart) .basket_block ', function() {
		$(this).closest('.basket_normal').find('.popup').addClass('block');
		$(this).closest('.basket_normal').find('.basket_popup_wrapp').stop(true,true).slideDown(150);
	});
	$(document).on('mouseleave', '#basket_line .basket_normal .basket_block ', function() {
		var th=$(this);
		$(this).closest('.basket_normal').find('.basket_popup_wrapp').stop(true,true).slideUp(150, function(){
			th.closest('.basket_normal').find('.popup').removeClass('block');
		});
	});

	$(document).on('click', '.popup_button_basket', function(){
		var th=$(".to-cart[data-item="+$(this).data("item")+"]");

		var val = th.attr('data-quantity');

		if(!val) $val = 1;

		var tmp_props=th.data("props"),
			props='',
			part_props='',
			add_props='N',
			fill_prop={},
			iblockid = th.data('iblockid'),
			offer = th.data('offers'),
			rid='',
			basket_props='',
			item = th.attr('data-item');

		if(offer!="Y"){
			offer = "N";
		}else{
			basket_props=th.closest('.prices_tab').find('.bx_sku_props input').val();
		}
		if(tmp_props){
			props=tmp_props.split(";");
		}
		if(th.data("part_props")){
			part_props=th.data("part_props");
		}
		if(th.data("add_props")){
			add_props=th.data("add_props");
		}
		if($('.rid_item').length){
			rid=$('.rid_item').data('rid');
		}else if(th.data('rid')){
			rid=th.data('rid');
		}

		fill_prop=fillBasketPropsExt(th, 'prop', 'bx_ajax_text');

		fill_prop.quantity=val;
		fill_prop.add_item='Y';
		fill_prop.rid=rid;
		fill_prop.offers=offer;
		fill_prop.iblockID=iblockid;
		fill_prop.part_props=part_props;
		fill_prop.add_props=add_props;
		fill_prop.props=JSON.stringify(props);
		fill_prop.item=item;
		fill_prop.basket_props=basket_props;

		$.ajax({
			type:"POST",
			url:arOptimusOptions['SITE_DIR']+"ajax/item.php",
			data:fill_prop,
			dataType:"json",
			success:function(data){
				$('.basket_error_frame').jqmHide();
				if("STATUS" in data){
					getActualBasket(fill_prop.iblockID);
					if(data.STATUS === 'OK'){
						th.hide();
						th.closest('.counter_wrapp').find('.counter_block').hide();
						th.parents('tr').find('.counter_block_wr .counter_block').hide();
						th.closest('.button_block').addClass('wide');
						th.parent().find('.in-cart').show();

						addBasketCounter(item);
						$('.wish_item[data-item='+item+']').removeClass("added");
						$('.wish_item[data-item='+item+']').find(".value").show();
						$('.wish_item[data-item='+item+']').find(".value.added").hide();
						if($("#basket_line .cart").length)
						{
							if($("#basket_line .cart").is(".empty_cart"))
							{
								$("#basket_line .cart").removeClass("empty_cart").find(".cart_wrapp a.basket_link").removeAttr("href").addClass("cart-call");
								$("#basket_line .cart").removeClass("ecart");
								touchBasket('.cart:not(.empty_cart) .basket_block .link');
							}

							reloadTopBasket('add', $('#basket_line'), 200, 5000, 'Y');

						}else if($("#basket_line .basket_fly").length){
							if($(window).outerWidth()>768){
								basketFly('open');
							}else{
								basketFly('refresh');
							}
						}
					}else{
						showBasketError(BX.message(data.MESSAGE));
					}
				}else{
					showBasketError(BX.message("CATALOG_PARTIAL_BASKET_PROPERTIES_ERROR"));
				}
			}
		});
	})

	$(document).on( 'click', '.to-cart:not(.read_more)', function(e){
		e.preventDefault();
		var th=$(this);

		var val = $(this).attr('data-quantity');

		if(!val) $val = 1;

		var tmp_props=$(this).data("props"),
			props='',
			part_props='',
			add_props='N',
			fill_prop={},
			iblockid = $(this).data('iblockid'),
			offer = $(this).data('offers'),
			rid='',
			basket_props='',
			item = $(this).attr('data-item');

		if(offer!="Y"){
			offer = "N";
		}else{
			basket_props=$(this).closest('.prices_tab').find('.bx_sku_props input').val();
		}
		if(tmp_props){
			props=tmp_props.split(";");
		}
		if($(this).data("part_props")){
			part_props=$(this).data("part_props");
		}
		if($(this).data("add_props")){
			add_props=$(this).data("add_props");
		}
		if($('.rid_item').length){
			rid=$('.rid_item').data('rid');
		}else if($(this).data('rid')){
			rid=$(this).data('rid');
		}

		fill_prop=fillBasketPropsExt(th, 'prop', th.data('bakset_div'));

		fill_prop.quantity=val;
		fill_prop.add_item='Y';
		fill_prop.rid=rid;
		fill_prop.offers=offer;
		fill_prop.iblockID=iblockid;
		fill_prop.part_props=part_props;
		fill_prop.add_props=add_props;
		fill_prop.props=JSON.stringify(props);
		fill_prop.item=item;
		fill_prop.basket_props=basket_props;

		if(th.data("empty_props")=="N"){
			showBasketError($("#"+th.data("bakset_div")).html(), BX.message("ERROR_BASKET_PROP_TITLE"), "Y", th);
		}else{
			$.ajax({
				type:"POST",
				url:arOptimusOptions['SITE_DIR']+"ajax/item.php",
				data:fill_prop,
				dataType:"json",
				success:function(data){
					getActualBasket(fill_prop.iblockID);
					if(data !==null){
						if("STATUS" in data){
							if(data.MESSAGE_EXT===null)
								data.MESSAGE_EXT='';
							if(data.STATUS === 'OK'){
								th.hide();
								th.closest('.counter_wrapp').find('.counter_block').hide();
								th.parents('tr').find('.counter_block_wr .counter_block').hide();
								th.closest('.button_block').addClass('wide');
								th.parent().find('.in-cart').show();

								addBasketCounter(item);
								$('.wish_item[data-item='+item+']').removeClass("added");
								$('.wish_item[data-item='+item+']').find(".value").show();
								$('.wish_item[data-item='+item+']').find(".value.added").hide();
								if($("#basket_line .cart").length)
								{
									if($("#basket_line .cart").is(".empty_cart"))
									{
										$("#basket_line .cart").removeClass("empty_cart").find(".cart_wrapp a.basket_link").removeAttr("href").addClass("cart-call");
										$("#basket_line .cart").removeClass("ecart");
										touchBasket('.cart:not(.empty_cart) .basket_block .link');
									}

									reloadTopBasket('add', $('#basket_line'), 200, 5000, 'Y');

								}else if($("#basket_line .basket_fly").length){
									if($(window).outerWidth()>768){
										basketFly('open');
									}else{
										basketFly('refresh');
									}
								}
							}else{
								showBasketError(BX.message(data.MESSAGE)+' <br/>'+data.MESSAGE_EXT);
							}
						}else{
							showBasketError(BX.message("CATALOG_PARTIAL_BASKET_PROPERTIES_ERROR"));
						}
					}else{
						th.hide();
						th.closest('.counter_wrapp').find('.counter_block').hide();
						th.parents('tr').find('.counter_block_wr .counter_block').hide();
						th.closest('.button_block').addClass('wide');
						th.parent().find('.in-cart').show();

						addBasketCounter(item);
						$('.wish_item[data-item='+item+']').removeClass("added");
						$('.wish_item[data-item='+item+']').find(".value").show();
						$('.wish_item[data-item='+item+']').find(".value.added").hide();
						if($("#basket_line .cart").length)
						{
							if($("#basket_line .cart").is(".empty_cart"))
							{
								$("#basket_line .cart").removeClass("empty_cart").find(".cart_wrapp a.basket_link").removeAttr("href").addClass("cart-call");
								$("#basket_line .cart").removeClass("ecart");
								touchBasket('.cart:not(.empty_cart) .basket_block .link');
							}

							reloadTopBasket('add', $('#basket_line'), 200, 5000, 'Y');
						}else if($("#basket_line .basket_fly").length && $(window).outerWidth()>768){
							basketFly('open');
						}
					}
				}
			});
		}
	})

	$(document).on('click', '.to-subscribe', function(e){
		e.preventDefault();
		if($(this).is('.auth')){
			location.href=arOptimusOptions['SITE_DIR']+'auth/?backurl='+location.pathname;
		}
		else{
			var item = $(this).attr('data-item'),
				iblockid = $(this).attr('data-iblockid');
			$(this).hide();
			$(this).parent().find('.in-subscribe').show();
			$.get(arOptimusOptions['SITE_DIR'] + 'ajax/item.php?item=' + item + '&subscribe_item=Y',
				$.proxy(function(data){
					$('.wish_item[data-item=' + item + ']').removeClass('added');
					getActualBasket(iblockid);
				})
			);
		}
	})

	$(document).on('click', '.in-subscribe', function(e){
		e.preventDefault();
		var item = $(this).attr('data-item'),
			iblockid = $(this).attr('data-iblockid');;
		$(this).hide();
		$(this).parent().find('.to-subscribe').show();
		$.get(arOptimusOptions['SITE_DIR'] + 'ajax/item.php?item=' + item + '&subscribe_item=Y',
			$.proxy(function(data){
				getActualBasket(iblockid);
			})
		);
	})

	$(document).on('click', '.wish_item', function(e){
		e.preventDefault();
		var val = $(this).attr('data-quantity'),
			offer = $(this).data('offers'),
			iblockid = $(this).data('iblock'),
			tmp_props=$(this).data("props"),
			props='',
			item = $(this).data('item');
			item2 = $(this).attr('data-item');
		if(!val) $val = 1;
		if(offer!="Y") offer = "N";
		if(tmp_props){
			props=tmp_props.split(";");
		}
		if(!$(this).hasClass('text')){
			if($(this).hasClass('added')){
				$(this).hide();
				$(this).closest('.wish_item_button').find('.to').show();

				$('.like_icons').each(function(){
					if($(this).find('.wish_item.text[data-item="'+item+'"]').length){
						$(this).find('.wish_item.text[data-item="'+item+'"]').removeClass('added');
						$(this).find('.wish_item.text[data-item="'+item+'"]').find('.value').show();
						$(this).find('.wish_item.text[data-item="'+item+'"]').find('.value.added').hide();
					}
					if($(this).find('.wish_item_button').length){
						$(this).find('.wish_item_button').find('.wish_item[data-item="'+item+'"]').removeClass('added');
						$(this).find('.wish_item_button').find('.wish_item[data-item="'+item+'"]').find('.value').show();
						$(this).find('.wish_item_button').find('.wish_item[data-item="'+item+'"]').find('.value.added').hide();
					}
				})
			}
			else{
				$(this).hide();
				$(this).closest('.wish_item_button').find('.in').addClass('added').show();

				$('.like_icons').each(function(){
					if($(this).find('.wish_item.text[data-item="'+item+'"]').length){
						$(this).find('.wish_item.text[data-item="'+item+'"]').addClass('added');
						$(this).find('.wish_item.text[data-item="'+item+'"]').find('.value').hide();
						$(this).find('.wish_item.text[data-item="'+item+'"]').find('.value.added').css({"display":"block"})
					}
					if($(this).find('.wish_item_button').length){
						$(this).find('.wish_item_button').find('.wish_item[data-item="'+item+'"]').addClass('added');
						$(this).find('.wish_item_button').find('.wish_item[data-item="'+item+'"]').find('.value').hide();
						$(this).find('.wish_item_button').find('.wish_item[data-item="'+item+'"]').find('.value.added').show();
					}
				})
			}
		}else{
			if(!$(this).hasClass('added')){
				$('.wish_item[data-item=' + item + ']').addClass('added');
				$('.wish_item[data-item=' + item + ']').find('.value').hide();
				$('.wish_item[data-item=' + item + ']').find('.value.added').css('display','block');

				$('.like_icons').each(function(){
					if($(this).find('.wish_item_button').length){
						$(this).find('.wish_item_button').find('.wish_item[data-item="'+item+'"]').addClass('added');
						$(this).find('.wish_item_button').find('.wish_item[data-item="'+item+'"]').find('.value').hide();
						$(this).find('.wish_item_button').find('.wish_item[data-item="'+item+'"]').find('.value.added').show();
					}
				})
			}else{
				$('.wish_item[data-item=' + item + ']').removeClass('added');
				$('.wish_item[data-item=' + item + ']').find('.value').show();
				$('.wish_item[data-item=' + item + ']').find('.value.added').hide();

				$('.like_icons').each(function(){
					if($(this).find('.wish_item_button').length){
						$(this).find('.wish_item_button').find('.wish_item[data-item="'+item+'"]').removeClass('added');
						$(this).find('.wish_item_button').find('.wish_item[data-item="'+item+'"]').find('.value').show();
						$(this).find('.wish_item_button').find('.wish_item[data-item="'+item+'"]').find('.value.added').hide();
					}
				})
			}
		}

		$('.in-cart[data-item=' + item + ']').hide();
		$('.to-cart[data-item=' + item + ']').parent().removeClass('wide');
		$('.to-cart[data-item=' + item + ']').show();
		$('.counter_block[data-item=' + item + ']').show();
		if(!$(this).closest('.module-cart').size()){
			$.ajax({
				type:"GET",
				url:arOptimusOptions['SITE_DIR']+"ajax/item.php",
				data:"item="+item2+"&quantity="+val+"&wish_item=Y"+"&offers="+offer+"&iblockID="+iblockid+"&props="+JSON.stringify(props),
				dataType:"json",
				success: function(data){
					getActualBasket(iblockid);
					if(data !==null){
						if(data.MESSAGE_EXT===null)
							data.MESSAGE_EXT='';
						if("STATUS" in data){
							if(data.STATUS === 'OK'){
								if(arOptimusOptions['COUNTERS']['USE_BASKET_GOALS'] !== 'N'){
									var eventdata = {goal: 'goal_wish_add', params: {id: item2}};
									BX.onCustomEvent('onCounterGoals', [eventdata]);
								}
								if($("#basket_line .cart").size()){
									reloadTopBasket('wish', $('#basket_line'), 200, 5000, 'N');
								}else{
									basketFly('wish');
								}
							}else{
								showBasketError(BX.message(data.MESSAGE)+' <br/>'+data.MESSAGE_EXT, BX.message("ERROR_ADD_DELAY_ITEM"));
							}
						}else{
							showBasketError(BX.message(data.MESSAGE)+' <br/>'+data.MESSAGE_EXT, BX.message("ERROR_ADD_DELAY_ITEM"));
						}
					}else{
						if($("#basket_line .cart").size()){
							reloadTopBasket('wish', $('#basket_line'), 200, 5000, 'N');
						}else{
							basketFly('wish');
						}
					}
				}
			});
		}
	})

	// $('.compare_item').live('click', function(e){
	$(document).on('click', '.compare_item', function(e){
		e.preventDefault();
		var item = $(this).attr('data-item');
		var iblockID = $(this).attr('data-iblock');
		if(!$(this).hasClass('text')){
			if($(this).hasClass('added')){
				$(this).hide();
				$(this).closest('.compare_item_button').find('.to').show();

				/*sync other button*/
				$('.like_icons').each(function(){
					if($(this).find('.compare_item.text[data-item="'+item+'"]').length){
						$(this).find('.compare_item.text[data-item="'+item+'"]').removeClass('added');
						$(this).find('.compare_item.text[data-item="'+item+'"]').find('.value').show();
						$(this).find('.compare_item.text[data-item="'+item+'"]').find('.value.added').hide();
					}
					if($(this).find('.compare_item_button').length){
						$(this).find('.compare_item_button').find('.compare_item[data-item="'+item+'"]').removeClass('added');
						$(this).find('.compare_item_button').find('.compare_item[data-item="'+item+'"]').find('.value').show();
						$(this).find('.compare_item_button').find('.compare_item[data-item="'+item+'"]').find('.value.added').hide();
					}
				})
			}
			else{
				$(this).hide();
				$(this).closest('.compare_item_button').find('.in').show();

				/*sync other button*/
				$('.like_icons').each(function(){
					if($(this).find('.compare_item.text[data-item="'+item+'"]').length){
						$(this).find('.compare_item.text[data-item="'+item+'"]').addClass('added');;
						$(this).find('.compare_item.text[data-item="'+item+'"]').find('.value').hide();
						$(this).find('.compare_item.text[data-item="'+item+'"]').find('.value.added').css({"display":"block"});
					}
					if($(this).find('.compare_item_button').length){
						$(this).find('.compare_item_button').find('.compare_item[data-item="'+item+'"]').addClass('added');
						$(this).find('.compare_item_button').find('.compare_item[data-item="'+item+'"]').find('.value.added').show();
						$(this).find('.compare_item_button').find('.compare_item[data-item="'+item+'"]').find('.value').hide();
					}
				})
			}
		}else{
			if(!$(this).hasClass('added')){
				$('.compare_item[data-item=' + item + ']').addClass('added');
				$('.compare_item[data-item=' + item + ']').find('.value').hide();
				$('.compare_item[data-item=' + item + ']').find('.value.added').css('display','block');

				/*sync other button*/
				$('.like_icons').each(function(){
					if($(this).find('.compare_item_button').length){
						$(this).find('.compare_item_button').find('.compare_item[data-item="'+item+'"]').addClass('added');
						$(this).find('.compare_item_button').find('.compare_item[data-item="'+item+'"]').find('.value.added').show();
						$(this).find('.compare_item_button').find('.compare_item[data-item="'+item+'"]').find('.value').hide();
					}
				})
			}else{
				$('.compare_item[data-item=' + item + ']').removeClass('added');
				$('.compare_item[data-item=' + item + ']').find('.value').show();
				$('.compare_item[data-item=' + item + ']').find('.value.added').hide();

				/*sync other button*/
				$('.like_icons').each(function(){
					if($(this).find('.compare_item_button').length){
						$(this).find('.compare_item_button').find('.compare_item[data-item="'+item+'"]').removeClass('added');
						$(this).find('.compare_item_button').find('.compare_item[data-item="'+item+'"]').find('.value').show();
						$(this).find('.compare_item_button').find('.compare_item[data-item="'+item+'"]').find('.value.added').hide();
					}
				})
			}
		}

		$.get(arOptimusOptions['SITE_DIR'] + 'ajax/item.php?item=' + item + '&compare_item=Y&iblock_id=' + iblockID,
			$.proxy(function(data){
				getActualBasket(iblockID);
				jsAjaxUtil.InsertDataToNode(arOptimusOptions['SITE_DIR'] + 'ajax/show_compare_preview_top.php', 'compare_line', false);
				if($('#compare_fly').length){
					jsAjaxUtil.InsertDataToNode(arOptimusOptions['SITE_DIR'] + 'ajax/show_compare_preview_fly.php', 'compare_fly', false);
				}
			})
		);
	});

	$('.fancy').fancybox({
		openEffect  : 'fade',
		closeEffect : 'fade',
		nextEffect : 'fade',
		prevEffect : 'fade',
		tpl:{
			closeBtn : '<a title="'+BX.message('FANCY_CLOSE')+'" class="fancybox-item fancybox-close" href="javascript:;"></a>',
			next     : '<a title="'+BX.message('FANCY_NEXT')+'" class="fancybox-nav fancybox-next" href="javascript:;"><span></span></a>',
			prev     : '<a title="'+BX.message('FANCY_PREV')+'" class="fancybox-nav fancybox-prev" href="javascript:;"><span></span></a>'
		},
	});

	$('.tabs>li').on('click', function(){
		if(!$(this).hasClass('active')){
			var sliderIndex = $(this).index(),
				curLiNav=$(this).closest('.top_blocks').find('.slider_navigation').find('>li:eq(' + sliderIndex + ')'),
				curLi=$(this).closest('.top_blocks').siblings('.tabs_content').find('>li:eq(' + sliderIndex + ')');
			$(this).addClass('active').addClass('cur').siblings().removeClass('active').removeClass('cur');
			curLi.addClass('cur').siblings().removeClass('cur');
			curLiNav.addClass('cur').siblings().removeClass('cur');

			/*equal height*/
			curLi.find('.catalog_block .catalog_item_wrapp .catalog_item .item_info:visible .item-title').sliceHeight({item:'.catalog_item:visible'});
			curLi.find('.catalog_block .catalog_item_wrapp .catalog_item .item_info:visible').sliceHeight({classNull: '.footer_button', item:'.catalog_item:visible'});
			curLi.find('.catalog_block .catalog_item_wrapp .catalog_item:visible').sliceHeight({classNull: '.footer_button', item:'.catalog_item:visible'});
		}
	})

	/*search click*/
	$('.search_block .icon').on('click', function(){
		var th=$(this);
		if($(this).hasClass('open')){
			$(this).closest('.center_block').find('.search_middle_block').removeClass('active');
			$(this).removeClass('open');
			$(this).closest('.center_block').find('.search_middle_block').find('.noborder').hide();
		}else{
			setTimeout(function(){
				th.closest('.center_block').find('.search_middle_block').find('.noborder').show();
			},100);
			$(this).closest('.center_block').find('.search_middle_block').addClass('active');
			$(this).addClass('open');
		}
	})
	$(document).on('mouseenter', '.display_list .item_wrap', function(){
		$(this).prev().addClass('prev');
	});
	$(document).on('mouseleave', '.display_list .item_wrap', function(){
		$(this).prev().removeClass('prev');
	});
	$(document).on('mouseenter', '.catalog_block .item_wrap', function(){
		$(this).addClass('shadow_delay');
	});
	$(document).on('mouseleave', '.catalog_block .item_wrap', function(){
		$(this).removeClass('shadow_delay');
	});
	$(document).on('click', '.no_goods .button', function(){
		$('.bx_filter .smartfilter .bx_filter_search_reset').trigger('click');
	});

	$(document).on('click', '.ajax_load_btn', function(){
		var url=$(this).closest('.right_block').find('.module-pagination .flex-direction-nav .flex-next').attr('href'),
			th=$(this).find('.more_text_ajax');
		th.addClass('loading');

		$.ajax({
			url: url,
			data: {"ajax_get": "Y"},
			success: function(html){
				var new_html=$.parseHTML(html);
				th.removeClass('loading');
				if($('.display_list').length){
					$('.display_list').append(html);
				}else if($('.block_list').length){
					$('.block_list').append(html);
					touchItemBlock('.catalog_item a');
				}else if($('.module_products_list').length){
					$('.module_products_list > tbody').append(html);
				}
				setStatusButton();
				initCountdown();
				BX.onCustomEvent('onAjaxSuccess');
				$('.bottom_nav').html($(html).find('.bottom_nav').html());
			}
		})
	})

	$(document).on('click', '.bx_compare .tabs-head li', function(){
		var url=$(this).find('.sortbutton').data('href');
		BX.showWait(BX("bx_catalog_compare_block"));
		$.ajax({
			url: url,
			data: {'ajax_action': 'Y'},
			success: function(html){
				history.pushState(null, null, url);
				$('#bx_catalog_compare_block').html(html);
				BX.closeWait();
			}
		})
	})
	var hoveredTrs;
	$(document).on({
		mouseover: function(e){
			var _ = $(this);
			var tbodyIndex = _.closest('tbody').index()+1; //+1 for nth-child
			var trIndex = _.index()+1; // +1 for nth-child
			hoveredTrs = $(e.delegateTarget).find('.data_table_props')
				.children(':nth-child('+tbodyIndex+')')
				.children(':nth-child('+trIndex+')').addClass('hovered');
		},
		mouseleave: function(e){
			if(hoveredTrs)
				hoveredTrs.removeClass('hovered');
		}
	}, '.bx_compare .data_table_props tbody>tr');
	$(document).on('click', '.fancy_offer', function(e){
		e.preventDefault();
		var arPict=[];
		$('.sliders .slides_block li').each(function(){
			var obImg = {};
			obImg = {
				'title': $(this).find('img').attr('alt'),
				'href': $(this).data('big')
			}
			if($(this).hasClass('current')){
				arPict.unshift(obImg);
			}else{
				arPict.push(obImg);
			}
		})
		console.log(arPict);
		$.fancybox(arPict, {
			openEffect  : 'fade',
			closeEffect : 'fade',
			nextEffect : 'fade',
			prevEffect : 'fade',
			type : 'image',
			tpl:{
				closeBtn : '<a title="'+BX.message('FANCY_CLOSE')+'" class="fancybox-item fancybox-close" href="javascript:;"></a>',
				next     : '<a title="'+BX.message('FANCY_NEXT')+'" class="fancybox-nav fancybox-next" href="javascript:;"><span></span></a>',
				prev     : '<a title="'+BX.message('FANCY_PREV')+'" class="fancybox-nav fancybox-prev" href="javascript:;"><span></span></a>'
			},
		});
	})

	/*tabs*/
	$(".tabs_section .tabs-head li").live("click", function(){
		if(!$(this).is(".current")){
			$(".tabs_section .tabs-head li").removeClass("current");
			$(this).addClass("current");
			$(".tabs_section ul.tabs_content li").removeClass("current");
			if($(this).attr("id") == "product_reviews_tab"){
				$(".shadow.common").hide(); $("#reviews_content").show();
			}
			else{
				$(".shadow.common").show();
				$("#reviews_content").hide();
				$(".tabs_section ul.tabs_content > li:eq("+$(this).index()+")").addClass("current");
			}
		}
	});
	/*open first section slide*/
	setTimeout(function() {
		$('.jobs_wrapp .item:first .name tr').trigger('click');
	}, 300);

	$('.buy_block .slide_offer').on('click', function(){
		scroll_block($('.tabs_section'));
	});
	$('.share_wrapp .text').on('click', function(){
		$(this).parent().find('.shares').fadeToggle();
	})
	$('html, body').live('mousedown', function(e) {
		e.stopPropagation();
		$('.shares').fadeOut();
		$('.search_middle_block').removeClass('active_wide');
	})
	$('.share_wrapp').find('*').live('mousedown', function(e) {
		e.stopPropagation();
	});
	$(document).on('click', '.reviews-collapse-link', function(){
		$('.reviews-reply-form').slideToggle();
	})

	initCountdown();

	/*adaptive menu start*/
	$('.menu.adaptive').on('click', function(){
		$(this).toggleClass('opened');
		if($(this).hasClass('opened')){
			$('.mobile_menu').toggleClass('opened').slideDown();
		}else{
			$('.mobile_menu').toggleClass('opened').slideUp();
		}
	});
	$('.mobile_menu .has-child >a').on('click', function(e){
		var parentLi=$(this).parent();
		e.preventDefault();
		parentLi.toggleClass('opened');
		parentLi.find('.dropdown').slideToggle();
	})

	$('.mobile_menu .search-input-div input').live('keyup', function(e) {
		var inputValue = $(this).val();
		$('.center_block .stitle_form input').val(inputValue);
		if(e.keyCode == 13){
			$('.center_block .stitle_form form').submit();
		}
	});

	$('.center_block .stitle_form input').live('keyup', function(e) {
		var inputValue = $(this).val();
		$('.mobile_menu .search-input-div input').val(inputValue);
		if(e.keyCode == 13){
			$('.center_block .stitle_form form').submit();
		}
	});

	$('.mobile_menu .search-button-div button').live('click', function(e) {
		e.preventDefault();
		var inputValue = $(this).parents().find('input').val();
		$('.center_block .stitle_form input').val(inputValue);
		$('.center_block .stitle_form form').submit();
	});
	/*adaptive menu end*/

	$('.btn.btn-add').on('click', function(){
		$.ajax({
			type:"GET",
			url:arOptimusOptions['SITE_DIR']+"ajax/clearBasket.php",
			success: function(data){
			}
		});
	})

	/*detail order show payments*/
	$('.sale-order-detail-payment-options-methods-info-change-link').on('click', function(){
		$(this).closest('.sale-order-detail-payment-options-methods-info').addClass('opened').siblings().addClass('opened');
	})

	/*expand/hide filter values*/
	$(document).on('click', '.expand_block', function(){
		togglePropBlock($(this));
	})

	/*touch event*/
	document.addEventListener('touchend', function(event) {
		if(!$(event.target).closest('.menu_item_l1').length){
			$('.menu .menu_item_l1 .child').css({'display':'none'});
			$('.menu_item_l1').removeClass('hover');
		}
		if(!$(event.target).closest('.basket_block').length){
			$('.basket_block .link').removeClass('hover');
			$('.basket_block .basket_popup_wrapp').slideUp();
		}
		if(!$(event.target).closest('.catalog_item').length){
			var tabsContentUnhoverHover = $('.tab:visible').attr('data-unhover') * 1;
			$('.tab:visible').stop().animate({'height': tabsContentUnhoverHover}, 100);
			$('.tab:visible').find('.catalog_item').removeClass('hover');
			$('.tab:visible').find('.catalog_item .buttons_block').stop().fadeOut(233);
			if($('.catalog_block').length){
				$('.catalog_block').find('.catalog_item').removeClass('hover');
				//$('.catalog_block').find('.catalog_item').blur();
			}
		}
		//togglePropBlock($(event.target));

	}, false);

	//touchItemBlock('.catalog_item a');

	$(document).on('keyup', '.coupon .input_coupon input', function(){
		if($(this).val().length){
			$(this).removeClass('error');
			$(this).closest('.input_coupon').find('.error').remove();
		}else{
			$(this).addClass('error');
			$("<label class='error'>"+BX.message("INPUT_COUPON")+"</label>").insertBefore($(this));
		}
	})
	// showPhoneMask('input[autocomplete=tel]');
	BX.addCustomEvent(window, "onAjaxSuccess", function(){
		initSelects(document);
		// InitLabelAnimation('#bx-soa-order-form');
		InitOrderCustom();
		// showPhoneMask('input[autocomplete=tel]');
		if($('.catalog_detail').length){
			$('.bx_filter').remove();
			InitFlexSlider();
		}

		if(arOptimusOptions["PAGES"]["ORDER_PAGE"]){
			orderActions();
		}
	});
	BX.addCustomEvent(window, "onFrameDataRequestFail", function(response){
		console.log(response);
	});
});

if(!funcDefined('togglePropBlock')){
	togglePropBlock=function(className){
		var all_props_block = className.closest('.bx_filter_parameters_box_container').find('.hidden_values');
		if(all_props_block.length && (className.hasClass('inner_text') || className.hasClass('expand_block')))
		{
			if(all_props_block.is(':visible'))
			{
				className.text(BX.message('FILTER_EXPAND_VALUES'));
				all_props_block.hide();
			}
			else
			{
				className.text(BX.message('FILTER_HIDE_VALUES'));
				all_props_block.show();
			}
		}
	}
}

if(!funcDefined('showPhoneMask')){
	showPhoneMask=function(className){
		$(className).inputmask('mask', {'mask': arOptimusOptions['THEME']['PHONE_MASK'], 'showMaskOnHover':false });
	}
}

if(!funcDefined('parseUrlQuery')){
	parseUrlQuery=function() {
	    var data = {};
	    if(location.search) {
	        var pair = (location.search.substr(1)).split('&');
	        for(var i = 0; i < pair.length; i ++) {
	            var param = pair[i].split('=');
	            data[param[0]] = param[1];
	        }
	    }
	    return data;
	}
}

if(!funcDefined('getActualBasket')){
	getActualBasket=function(iblockID){
		var data='';
		if(typeof iblockID !=="undefined"){
			data={"iblockID":iblockID}
		}
		$.ajax({
			type:"GET",
			url:arOptimusOptions['SITE_DIR']+"ajax/actualBasket.php",
			data:data,
			success: function(data){
				if(!$('.js_ajax').length)
					$('body').append('<div class="js_ajax"></div>');
				$('.js_ajax').html(data);
			}
		});
	}
}

function touchMenu(selector){
	if($(window).outerWidth()>600){
		$(selector).each(function(){
			var th=$(this);
			th.on('touchend', function(e) {
				if (th.find('.child').length && !th.hasClass('hover')) {
					e.preventDefault();
					e.stopPropagation();
					th.siblings().removeClass('hover');
					th.addClass('hover');
					$('.menu .child').css({'display':'none'});
					th.find('.child').css({'display':'block'});
				}
			})
		})
	}else{
		$(selector).off();
	}
}
function touchItemBlock(selector){
	$(selector).each(function(){
		var th=$(this),
			item=th.closest('.catalog_item');
		th.on('touchend', function(e) {
			if (!item.hasClass('hover')) {
				e.preventDefault();
				e.stopPropagation();
				item.siblings().removeClass('hover');
				item.siblings().blur();
				item.closest('.catalog_block').find('.catalog_item').removeClass('hover');
				item.addClass('hover');
				item.addClass('touch');

				var tabsContentHover = th.closest('.tab').attr('data-hover') * 1,
					tabsContentUnhoverHover = th.closest('.tab').attr('data-unhover') * 1;

				th.closest('.tab').stop().animate({'height': tabsContentUnhoverHover}, 100);
				th.closest('.catalog_item').siblings().find('.buttons_block').stop().fadeOut(233)

				th.closest('.tab').fadeTo(100, 1);
				th.closest('.tab').stop().css({'height': tabsContentHover});
				th.closest('.catalog_item').find('.buttons_block').fadeIn(450, 'easeOutCirc');
			}
		})
	})
}
function touchBasket(selector){
	if(arOptimusOptions['THEME']['SHOW_BASKET_ONADDTOCART'] !== 'N'){
		if($(window).outerWidth()>600){
			$(document).find(selector).on('touchend', function(e) {
				if ($(this).parent().find('.basket_popup_wrapp').length && !$(this).hasClass('hover')) {
					e.preventDefault();
					e.stopPropagation();
					$(this).addClass('hover');
					$(this).parent().find('.basket_popup_wrapp').slideDown();
				}
			})
		}else{
			$(selector).off();
		}
	}
}
function initFull(){
	initSelects(document);
	initHoverBlock(document);
	touchItemBlock('.catalog_item a');
	// InitLabelAnimation('#bx-soa-order-form');
	InitOrderCustom();
	if(!$('html.print').length)
		checkStickyFooter();
	else
		window.print();

	basketActions();
	orderActions();
}
if(!funcDefined('orderActions')){
	orderActions = function(){
		if(arOptimusOptions["PAGES"]["ORDER_PAGE"]){
			if($('.bx-soa-cart-total').length){
				if(!$('.change_basket').length)
					$('.bx-soa-cart-total').prepend('<div class="change_basket">'+BX.message("BASKET_CHANGE_TITLE")+'<a href="'+arOptimusOptions["SITE_DIR"]+'basket/" class="change_link">'+BX.message("BASKET_CHANGE_LINK")+'</a></div>');
				if(typeof (BX.Sale.OrderAjaxComponent) == "object"){
					if(arOptimusOptions['COUNTERS']['USE_FULLORDER_GOALS'] !== 'N'){
						if(typeof BX.Sale.OrderAjaxComponent.reachgoalbegin === 'undefined'){
							BX.Sale.OrderAjaxComponent.reachgoalbegin = true;
							var eventdata = {goal: 'goal_order_begin'};
							BX.onCustomEvent('onCounterGoals', [eventdata])
						}
					}
					if($('.bx-soa-cart-total-line-total').length && !$('.bx-soa-cart-total .licence_block').length && arOptimusOptions["THEME"]["SHOW_LICENCE"] == "Y"){
						$('<div class="form"><div class="licence_block filter label_block"><label data-for="licenses_order" class="hidden error">'+BX.message('JS_REQUIRED_LICENSES')+'</label><input type="checkbox" name="licenses_order" required value="Y"><label data-for="licenses_order" class="license">'+BX.message('LICENSES_TEXT')+'</label></div></div>').insertAfter($('#bx-soa-total .bx-soa-cart-total-line-total'));
						$('#bx-soa-orderSave, .bx-soa-cart-total-button-container').addClass('lic_condition');

						if(typeof (BX.Sale.OrderAjaxComponent.oldClickOrderSaveAction) === "undefined" && typeof (BX.Sale.OrderAjaxComponent.clickOrderSaveAction) !== 'undefined'){
							BX.Sale.OrderAjaxComponent.oldClickOrderSaveAction = BX.Sale.OrderAjaxComponent.clickOrderSaveAction;
							BX.Sale.OrderAjaxComponent.clickOrderSaveAction = function(event){
								if($('input[name="licenses_order"]').prop('checked')){
									$('.bx-soa-cart-total .licence_block label.error').addClass('hidden');
									BX.Sale.OrderAjaxComponent.oldClickOrderSaveAction(event);
								}
								else{
									$('.bx-soa-cart-total .licence_block label.error').removeClass('hidden');
								}
							}
							BX.unbindAll(BX.Sale.OrderAjaxComponent.totalInfoBlockNode.querySelector('a.btn-order-save'));
							BX.unbindAll(BX.Sale.OrderAjaxComponent.mobileTotalBlockNode.querySelector('a.btn-order-save'));
							BX.unbindAll(BX.Sale.OrderAjaxComponent.orderSaveBlockNode.querySelector('a'));
							BX.bind(BX.Sale.OrderAjaxComponent.totalInfoBlockNode.querySelector('a.btn-order-save'), 'click', BX.proxy(BX.Sale.OrderAjaxComponent.clickOrderSaveAction, BX.Sale.OrderAjaxComponent));
							BX.bind(BX.Sale.OrderAjaxComponent.mobileTotalBlockNode.querySelector('a.btn-order-save'), 'click', BX.proxy(BX.Sale.OrderAjaxComponent.clickOrderSaveAction, BX.Sale.OrderAjaxComponent));
							BX.bind(BX.Sale.OrderAjaxComponent.orderSaveBlockNode.querySelector('a'), 'click', BX.proxy(BX.Sale.OrderAjaxComponent.clickOrderSaveAction, BX.Sale.OrderAjaxComponent));
						}
						$('.bx-soa-cart-total .licence_block label.license').on('click', function(){
							var id = $(this).data('for');
							$('.bx-soa-cart-total .licence_block label.error').addClass('hidden');
							if(!$('input[name='+id+']').prop('checked')){
								$('input[name='+id+']').prop('checked', 'checked');
							}
							else{
								$('input[name='+id+']').prop('checked', '');
							}
						})
					}
					if(BX.Sale.OrderAjaxComponent.hasOwnProperty("params")){
						$('.bx-soa-cart-total .change_link').attr('href', BX.Sale.OrderAjaxComponent.params.PATH_TO_BASKET);
						if(arOptimusOptions["PRICES"]["MIN_PRICE"]){
							if(arOptimusOptions["PRICES"]["MIN_PRICE"]>Number(BX.Sale.OrderAjaxComponent.result.TOTAL.ORDER_PRICE)){
								$('<div class="fademask_ext"></div>').appendTo($('body'));
								location.href=BX.Sale.OrderAjaxComponent.params.PATH_TO_BASKET;
							}
						}
					}
					if(checkCounters() && typeof (BX.Sale.OrderAjaxComponent.oldSaveOrder) === "undefined" && typeof (BX.Sale.OrderAjaxComponent.saveOrder) !== 'undefined'){
						BX.Sale.OrderAjaxComponent.oldSaveOrder = BX.Sale.OrderAjaxComponent.saveOrder;
						BX.Sale.OrderAjaxComponent.saveOrder = function(result){
							var res = BX.parseJSON(result);
							if (res && res.order){
								if (!res.order.SHOW_AUTH){
									if (res.order.REDIRECT_URL && res.order.REDIRECT_URL.length && (!res.order.ERROR || BX.util.object_keys(res.order.ERROR).length < 1)){
										if((arMatch = res.order.REDIRECT_URL.match(/ORDER_ID\=[^&=]*/g)) && arMatch.length && (_id = arMatch[0].replace(/ORDER_ID\=/g, '', arMatch[0]))){
											$.ajax({
												url:arOptimusOptions['SITE_DIR']+"ajax/check_order.php",
												dataType: "json",
												type: "POST",
												data: { "ID": _id },
												success: function(id){
													if(parseInt(id)){
														purchaseCounter(parseInt(id), BX.message('FULL_ORDER'), function(d){
															if(typeof d == 'object'){
																if(typeof BX.localStorage !== 'undefined'){
																	BX.localStorage.set('gtm_e_' + _id, d, 60);
																}
															}
															BX.Sale.OrderAjaxComponent.oldSaveOrder(result);
														});
													}
													else{
														BX.Sale.OrderAjaxComponent.oldSaveOrder(result);
													}
												},
												error: function(){
													BX.Sale.OrderAjaxComponent.oldSaveOrder(result);
												}
											})
										}
										else{
											BX.Sale.OrderAjaxComponent.oldSaveOrder(result);
										}
									}
									else{
										BX.Sale.OrderAjaxComponent.oldSaveOrder(result);
									}
								}
								else{
									BX.Sale.OrderAjaxComponent.oldSaveOrder(result);
								}
							}
							else{
								BX.Sale.OrderAjaxComponent.oldSaveOrder(result);
							}
						}
					}
				}
				$('.bx-ui-sls-quick-locations.quick-locations').on('click', function(){
					$(this).siblings().removeClass('active');
					$(this).addClass('active');
				})
			}
		}
	}
}

if(!funcDefined('basketActions')){
	basketActions = function(){
		if(arOptimusOptions["PAGES"]["BASKET_PAGE"]){
			checkMinPrice();

			if(location.hash)
			{
				var hash = location.hash.substring(1);
				if($('#basket_toolbar_button_'+hash).length)
				{
					$('#basket_toolbar_button_'+hash).trigger('click');
				}
			}

			$('.bx_sort_container').append('<div class="top_control basket_sort"><span class="delete_all button grey_br transparent remove_all_basket">'+BX.message("BASKET_CLEAR_ALL_BUTTON")+'</span></div>');
			if(arOptimusOptions["THEME"]["SHOW_BASKET_PRINT"]=="Y"){
				$('.bx_sort_container .top_control').prepend('<span class="basket_print button grey_br transparent">'+BX.message("BASKET_PRINT_BUTTON")+'</span>');
			}
			$('.bx_sort_container .top_control .delete_all').data("type",$('.bx_sort_container a.current').index());
			$('.bx_ordercart .bx_ordercart_coupon #coupon').wrap('<div class="input"></div>');

			$('.bx_sort_container > a').on('click', function() {
				$('.bx_sort_container .top_control .delete_all').data("type", $(this).index());
			});

			$('.basket_print').on('click', function() {
				 // window.open(location.pathname+"?print=Y",'_blank');
				 window.print();
			});

			$('.delete_all').on('click', function() {
				if(arOptimusOptions['COUNTERS']['USE_BASKET_GOALS'] !== 'N'){
					var eventdata = {goal: 'goal_basket_clear', params: {type: $(this).data('type')}};
					BX.onCustomEvent('onCounterGoals', [eventdata]);
				}
				$.post( arOptimusOptions['SITE_DIR']+"ajax/action_basket.php", "TYPE="+$(this).data('type')+"&CLEAR_ALL=Y", $.proxy(function( data ) {
					location.reload();
				}));
			});

			$('.bx_item_list_section .bx_catalog_item').sliceHeight({row:'.bx_item_list_slide', item:'.bx_catalog_item'});

			BX.addCustomEvent('onAjaxSuccess', function() {
				checkMinPrice();

				var errorText = $.trim($('#warning_message').text());
				$('#basket_items_list .error_text').detach();
				if (errorText != '') {
					$('#warning_message').hide().text('');
					$('#basket_items_list').prepend('<div class="error_text">' +errorText+ '</div>');
				}
			});
		}
	}
}

if(!funcDefined('checkMinPrice')){
	checkMinPrice = function(){
		if(arOptimusOptions["PAGES"]["BASKET_PAGE"]){
			var summ_raw=$('#allSum_FORMATED').text().replace(/[^0-9\.]/g,''),
				summ=parseFloat(summ_raw);
			if(!$('.catalog_back').length)
				$('.bx_ordercart_order_pay_center').prepend('<a href="/catalog/" class="catalog_back button transparent big_btn grey_br">'+BX.message("BASKET_CONTINUE_BUTTON")+'</a>');

			if(arOptimusOptions["PRICES"]["MIN_PRICE"]){
				if(arOptimusOptions["PRICES"]["MIN_PRICE"]>summ){
					if(!$('.icon_error_wrapper').length){
						$('.bx_ordercart_order_pay_center').prepend('<div class="icon_error_wrapper"><div class="icon_error_block">'+BX.message("MIN_ORDER_PRICE_TEXT").replace("#PRICE#", jsPriceFormat(arOptimusOptions["PRICES"]["MIN_PRICE"]))+'</div></div>');
					}

					if($('.oneclickbuy.fast_order').length)
						$('.oneclickbuy.fast_order').remove();

					if($('.bx_ordercart_order_pay .checkout').length)
						$('.bx_ordercart_order_pay .checkout').remove();
				}else{
					if($('.icon_error_wrapper').length)
						$('.icon_error_wrapper').remove();

					if($('.bx_ordercart_order_pay .checkout').length)
						$('.bx_ordercart .bx_ordercart_order_pay .checkout').css('opacity','1');
					else
						$('.bx_ordercart_order_pay_center').append('<a href="javascript:void(0)" onclick="checkOut();" class="checkout" style="opacity: 1;">'+BX.message("BASKET_ORDER_BUTTON")+'</a>');
					if(!$('.oneclickbuy.fast_order').length && arOptimusOptions["THEME"]["SHOW_ONECLICKBUY_ON_BASKET_PAGE"] == "Y")
						$('.bx_ordercart_order_pay_center').append('<span class="oneclickbuy button big_btn fast_order" onclick="oneClickBuyBasket()">'+BX.message("BASKET_QUICK_ORDER_BUTTON")+'</span>');


				}
			}else{
				$('.bx_ordercart .bx_ordercart_order_pay .checkout').css('opacity','1');
				if(!$('.oneclickbuy.fast_order').length && arOptimusOptions["THEME"]["SHOW_ONECLICKBUY_ON_BASKET_PAGE"] == "Y")
					$('.bx_ordercart_order_pay_center').append('<span class="oneclickbuy button big_btn fast_order" onclick="oneClickBuyBasket()">'+BX.message("BASKET_QUICK_ORDER_BUTTON")+'</span>');
			}
		}
	}
}

var isFrameDataReceived = false;
if (typeof window.frameCacheVars !== "undefined"){
	BX.addCustomEvent("onFrameDataReceived", function (json){
		initFull();
		isFrameDataReceived = true;
	});
}else{
	$( document ).ready(initFull);
}

if(!funcDefined('setHeightBlockSlider')){
	setHeightBlockSlider = function(){
		var sliderWidth = $(document).find('.specials.tab_slider_wrapp').outerWidth();

		$(document).find('.specials.tab_slider_wrapp .tabs_content > li.cur').css('height', '');
		$(document).find('.specials.tab_slider_wrapp .tabs_content .tab.cur .tabs_slider .buttons_block').hide();
		$(document).find('.specials.tab_slider_wrapp .tabs_content > li.cur').equalize({children: '.item-title'});
		$(document).find('.specials.tab_slider_wrapp .tabs_content > li.cur').equalize({children: '.item_info'});
		$(document).find('.specials.tab_slider_wrapp .tabs_content > li.cur').equalize({children: '.catalog_item'});
		var itemsButtonsHeight = $(document).find('.specials.tab_slider_wrapp .tabs_content .tab.cur .tabs_slider li .buttons_block').height();
		var tabsContentUnhover = $(document).find('.specials.tab_slider_wrapp .tabs_content .tab.cur').height() * 1;
		var tabsContentHover = tabsContentUnhover + itemsButtonsHeight+50;
		$(document).find('.specials.tab_slider_wrapp .tabs_content .tab.cur').attr('data-unhover', tabsContentUnhover);
		$(document).find('.specials.tab_slider_wrapp .tabs_content .tab.cur').attr('data-hover', tabsContentHover);
		$(document).find('.specials.tab_slider_wrapp .tabs_content').height(tabsContentUnhover);
	}
}

if(!funcDefined('checkStickyFooter')){
	checkStickyFooter = function() {
		try{
			ignoreResize.push(true);
			$('#content').css('min-height', '');
			var contentTop = $('#content').offset().top;
			var contentBottom = contentTop + $('#content').outerHeight();
			var footerTop = $('footer').offset().top;
			$('#content').css('min-height', $(window).height() - contentTop - (footerTop - contentBottom) - $('footer').outerHeight() + 'px');
			ignoreResize.pop();
		}
		catch(e){console.error(e);}
	}
}

/* EVENTS */
var timerResize = false, ignoreResize = [];
$(window).resize(function(){
	if(!$('html.print').length)
		checkStickyFooter();

	// here immediate functions
	if(!ignoreResize.length){
		if(timerResize){
			clearTimeout(timerResize);
			timerResize = false;
		}
		timerResize = setTimeout(function(){
			// here delayed functions in event
			BX.onCustomEvent('onWindowResize', false);
		}, 50);
	}
});

var timerScroll = false, ignoreScroll = [], documentScrollTopLast = $(document).scrollTop();
$(window).scroll(function(){
	// here immediate functions
	documentScrollTopLast = $(document).scrollTop();
	if(!ignoreScroll.length){
		if(timerScroll){
			clearTimeout(timerScroll);
			timerScroll = false;
		}
		timerScroll = setTimeout(function(){
			// here delayed functions in event
			BX.onCustomEvent('onWindowScroll', false);
		}, 50);
	}
});

BX.addCustomEvent('onWindowResize', function(eventdata){
	try{
		ignoreResize.push(true);

		// CheckTopMenuFullCatalogSubmenu();

		checkScrollToTop();
		checkPopupWidth();
		checkCaptchaWidth();
		checkFormWidth();
		checkFormControlWidth();
		touchMenu('ul.menu:not(.opened) > li.menu_item_l1');
		touchBasket('.cart:not(.empty_cart) .basket_block .link');
		CheckObjectsSizes();

		CheckFlexSlider();
		// InitZoomPict();
		initSly();

		checkVerticalMobileFilter();

		if(window.matchMedia('(max-width: 768px)').matches){
			if($('.group_description_block.top').length){
				var top_pos=$('.adaptive_filter').position().top;
				$('.bx_filter.bx_filter_vertical').css({'top':top_pos+20});
			}

		}

		if(window.matchMedia('(min-width: 767px)').matches){
			$('.wrapper_middle_menu.wrap_menu').removeClass('mobile');
		}
		if(window.matchMedia('(max-width: 767px)').matches){
			$('.wrapper_middle_menu.wrap_menu').addClass('mobile');
		}

		if($(window).outerWidth()>600){
			$("#header ul.menu").removeClass("opened").css("display", "");

			if($(".authorization-cols").length){
				$('.authorization-cols').equalize({children: '.col .auth-title', reset: true});
				$('.authorization-cols').equalize({children: '.col .form-block', reset: true});
			}
		} else {
			$('.authorization-cols .auth-title').css("height", "");
			$('.authorization-cols .form-block').css("height", "");
		}


		if($("#basket_form").length && $(window).outerWidth()<=600){
			$("#basket_form .tabs_content.basket > li.cur td").each(function() { $(this).css("width","");});
		}

		if($(".front_slider_wrapp").length){
			$(".extended_pagination li i").each(function(){
				$(this).css({"borderBottomWidth": ($(this).parent("li").outerHeight()/2), "borderTopWidth": ($(this).parent("li").outerHeight()/2)});
			});
		}

		setHeightCompany();
		$(".bx_filter_section .bx_filter_select_container").each(function(){
			var prop_id=$(this).closest('.bx_filter_parameters_box').attr('property_id');
			if($('#smartFilterDropDown'+prop_id).length){
				$('#smartFilterDropDown'+prop_id).css("max-width", $(this).width());
			}
		})
	}
	catch(e){}
	finally{
		ignoreResize.pop();
	}
});

BX.addCustomEvent('onWindowScroll', function(eventdata){
	try{
		ignoreScroll.push(true);
	}
	catch(e){}
	finally{
		ignoreScroll.pop();
	}
});

BX.addCustomEvent('onCounterGoals', function(eventdata){
	if(arOptimusOptions['COUNTERS']['USE_YA_COUNTER'] === 'Y'){
		var idCounter = arOptimusOptions['COUNTERS']['YA_COUNTER_ID'];
		idCounter = parseInt(idCounter);

		if(typeof eventdata != 'object'){
			eventdata = {goal: 'undefined'};
		}
		if(typeof eventdata.goal != 'string'){
			eventdata.goal = 'undefined';
		}

		if(idCounter){
			try{
				waitCounter(idCounter, 50, function(){
					var obCounter = window['yaCounter' + idCounter];
					if(typeof obCounter == 'object'){
						obCounter.reachGoal(eventdata.goal);
					}
				});
			}
			catch(e){
				console.error(e)
			}
		}
		else{
			console.info('Bad counter id!', idCounter);
		}
	}
})RTIBE